{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/eky/client/src/components/ChatApp.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport '../css/chat-app.css';\nimport '../styles/chatAppNotification.css';\nimport io from 'socket.io-client';\nimport { useAuth } from '../contexts/AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst getApiUrl = () => {\n  if (process.env.REACT_APP_API_URL) return process.env.REACT_APP_API_URL;\n  if (window.location.protocol === 'https:') {\n    // Use same host, but https\n    return `https://${window.location.hostname}`;\n  }\n  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n    return `http://${window.location.hostname}:3001`;\n  }\n  // For mobile/network access, use the network IP (dev only)\n  return `http://172.20.10.2:3001`;\n};\nconst ChatApp = () => {\n  _s();\n  const {\n    t,\n    i18n\n  } = useTranslation();\n  // Force language to Croatian for debugging\n  React.useEffect(() => {\n    i18n.changeLanguage('hr');\n    // Debug log for translation lookup\n    console.log('[i18n] Current language:', i18n.language);\n    console.log('[i18n] t(deleteConversation):', t('deleteConversation'));\n    console.log('[i18n] t(confirmAdoption):', t('confirmAdoption'));\n    console.log('[i18n] t(send):', t('send'));\n  }, [i18n]);\n  // Helper to refresh online users from server\n  const refreshOnlineUsers = useCallback(() => {\n    if (socketRef.current) {\n      socketRef.current.emit('getOnlineUsers');\n    }\n  }, []);\n  const {\n    user,\n    token,\n    updateUser\n  } = useAuth();\n  const selectedConvoRef = useRef(null);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const userWithBlocks = user;\n  // Profile picture logic\n  const getProfilePictureUrl = () => {\n    if (user && user.profilePicture) {\n      return `${getApiUrl()}${user.profilePicture}`;\n    }\n    return '../img/androcolored-80x80.jpg'; // Default profile picture\n  };\n  const [conversations, setConversations] = useState([]);\n  const [convoUsernames, setConvoUsernames] = useState({});\n  const [selectedConvo, setSelectedConvo] = useState(null);\n  useEffect(() => {\n    selectedConvoRef.current = selectedConvo;\n  }, [selectedConvo]);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  // Remove otherUserId, use only user search and searchResults\n  const [typing, setTyping] = useState(false);\n  const [notification, setNotification] = useState(null);\n  const [userSearch, setUserSearch] = useState('');\n  const [searchResults, setSearchResults] = useState([]);\n  const [pendingAdoptions, setPendingAdoptions] = useState([]);\n  useEffect(() => {\n    console.log('[ChatApp] onlineUsers state updated:', onlineUsers);\n  }, [onlineUsers]);\n  const socketRef = useRef(null);\n\n  // Refetch system messages and update UI labels when language changes\n  useEffect(() => {\n    if (selectedConvo && token) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }).then(res => res.json()).then(setMessages);\n    }\n    setNotification(null);\n  }, [i18n.language, selectedConvo, token]);\n  const fetchPendingAdoptions = useCallback(async () => {\n    if (!token) return;\n    console.log('[ChatApp] Fetching pending adoptions...');\n    try {\n      const res = await fetch(`${getApiUrl()}/api/dogs/pending-adoptions`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      if (res.ok) {\n        const data = await res.json();\n        console.log('[ChatApp] Current user:', user === null || user === void 0 ? void 0 : user._id);\n        console.log('[ChatApp] Pending adoptions:', data);\n        setPendingAdoptions(data);\n      } else {\n        console.error('[ChatApp] Failed to fetch pending adoptions:', res.status);\n      }\n    } catch (err) {\n      console.error('[ChatApp] Error fetching pending adoptions:', err);\n    }\n  }, [token]);\n\n  // Setup socket connection and listeners only once per user/token\n  useEffect(() => {\n    if (user !== null && user !== void 0 && user._id && token) {\n      console.log('[ChatApp] useEffect: user._id and token present.');\n      console.log('[ChatApp] Connecting socket for user:', user._id);\n      fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }).then(res => {\n        if (!res.ok) {\n          throw new Error(`HTTP ${res.status}: ${res.statusText}`);\n        }\n        return res.json();\n      }).then(async data => {\n        console.log('[ChatApp] Conversations fetched:', data);\n        setConversations(Array.isArray(data) ? data : []);\n        // Fetch usernames for each conversation's other participant\n        const usernames = {};\n        for (const convo of Array.isArray(data) ? data : []) {\n          const otherId = convo.participants.find(id => id !== user._id);\n          if (otherId) {\n            try {\n              const res = await fetch(`${getApiUrl()}/api/users/${otherId}`, {\n                headers: {\n                  'Authorization': `Bearer ${token}`\n                }\n              });\n              if (res.status === 404) {\n                usernames[convo._id] = '[Deleted User]';\n              } else if (res.ok) {\n                const u = await res.json();\n                usernames[convo._id] = u.username || u.name || otherId;\n              } else {\n                usernames[convo._id] = otherId;\n              }\n            } catch (err) {\n              usernames[convo._id] = '[Error]';\n            }\n          }\n        }\n        setConvoUsernames(usernames);\n        await fetchPendingAdoptions();\n      });\n      if (!socketRef.current) {\n        socketRef.current = io(getApiUrl());\n        console.log('[ChatApp] Socket.IO connecting to', getApiUrl());\n        socketRef.current.on('connect', () => {\n          console.log('[ChatApp] Socket connected');\n        });\n        socketRef.current.on('connect_error', error => {\n          console.error('[ChatApp] Socket connection error:', error);\n        });\n        socketRef.current.on('receiveMessage', msg => {\n          console.log('[ChatApp] receiveMessage event:', msg);\n        });\n        socketRef.current.on('refreshConversations', () => {\n          console.log('[ChatApp] refreshConversations event received');\n        });\n        socketRef.current.on('connect', () => {\n          console.log('[ChatApp] Socket connected successfully');\n        });\n        socketRef.current.on('connect_error', error => {\n          console.error('[ChatApp] Socket connection error:', error);\n        });\n        socketRef.current.emit('join', user._id);\n        console.log('[ChatApp] Emitted join for user:', user._id);\n        socketRef.current.emit('getOnlineUsers');\n        socketRef.current.on('onlineUsers', users => {\n          console.log('[ChatApp] Received onlineUsers:', users);\n          setOnlineUsers(users.filter(u => u._id !== user._id));\n        });\n        socketRef.current.on('userOnline', userOnline => {\n          console.log('[ChatApp] userOnline event:', userOnline);\n          setOnlineUsers(prev => {\n            if (prev.some(u => u._id === userOnline._id)) return prev;\n            return [...prev, userOnline].filter(u => u._id !== user._id);\n          });\n        });\n        socketRef.current.on('userOffline', userOffline => {\n          console.log('[ChatApp] userOffline event:', userOffline);\n          setOnlineUsers(prev => prev.filter(u => u._id !== userOffline._id));\n        });\n        socketRef.current.on('receiveMessage', msg => {\n          console.log('[ChatApp] receiveMessage event:', msg);\n          // Always refresh conversations list\n          fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n            headers: {\n              'Authorization': `Bearer ${token}`\n            }\n          }).then(res => res.json()).then(async data => {\n            setConversations(Array.isArray(data) ? data : []);\n            // Fetch usernames for each conversation's other participant\n            const usernames = {};\n            for (const convo of Array.isArray(data) ? data : []) {\n              const otherId = convo.participants.find(id => id !== user._id);\n              if (otherId) {\n                const res = await fetch(`${getApiUrl()}/api/users/${otherId}`);\n                if (res.ok) {\n                  const u = await res.json();\n                  usernames[convo._id] = u.username || u.name || otherId;\n                } else {\n                  usernames[convo._id] = otherId;\n                }\n              }\n            }\n            setConvoUsernames(usernames);\n            // Always refresh messages for the relevant conversation\n            if (msg.conversationId) {\n              fetch(`${getApiUrl()}/api/chat/messages/${msg.conversationId}`, {\n                headers: {\n                  'Authorization': `Bearer ${token}`\n                }\n              }).then(res => res.json()).then(messages => {\n                setMessages(messages);\n                // Show notification for system messages\n                if (msg.sender === null && msg.message) {\n                  setNotification(msg.message);\n                  setTimeout(() => setNotification(null), 4000);\n                  // Auto-select the conversation if not already selected\n                  if (!selectedConvo || selectedConvo._id !== msg.conversationId) {\n                    const foundConvo = (Array.isArray(data) ? data : []).find(c => c._id === msg.conversationId);\n                    if (foundConvo) setSelectedConvo(foundConvo);\n                  }\n                  // Mark conversation as having a new system message (badge)\n                  setConvoUsernames(prev => ({\n                    ...prev,\n                    [msg.conversationId]: (prev[msg.conversationId] || '') + ' â€¢'\n                  }));\n                }\n              });\n            }\n            // Always refresh pending adoptions on receiveMessage (for adoption events)\n            fetchPendingAdoptions();\n          });\n        });\n        socketRef.current.on('typing', ({\n          from\n        }) => {\n          setTyping(true);\n          setTimeout(() => setTyping(false), 1500);\n        });\n        socketRef.current.on('notification', ({\n          from,\n          message\n        }) => {\n          setNotification(`New message from ${from}: ${message}`);\n          setTimeout(() => setNotification(null), 3000);\n        });\n        socketRef.current.on('refreshConversations', () => {\n          console.log('[ChatApp] refreshConversations event received');\n          fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n            headers: {\n              'Authorization': `Bearer ${token}`\n            }\n          }).then(res => {\n            if (!res.ok) {\n              throw new Error(`HTTP ${res.status}: ${res.statusText}`);\n            }\n            return res.json();\n          }).then(data => {\n            console.log('[ChatApp] Conversations refreshed:', data);\n            setConversations(Array.isArray(data) ? data : []);\n          }).catch(err => {\n            console.error('[ChatApp] Error refreshing conversations:', err);\n          });\n          fetchPendingAdoptions();\n        });\n      }\n    }\n    return () => {\n      var _socketRef$current;\n      (_socketRef$current = socketRef.current) === null || _socketRef$current === void 0 ? void 0 : _socketRef$current.disconnect();\n      socketRef.current = null;\n    };\n  }, [user, token, selectedConvo, fetchPendingAdoptions]);\n  useEffect(() => {\n    if (selectedConvo && token) {\n      console.log('[ChatApp] Fetching messages for selectedConvo:', selectedConvo._id);\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }).then(res => res.json()).then(setMessages);\n    }\n  }, [selectedConvo, token]);\n  useEffect(() => {\n    if (selectedConvo && token) {\n      console.log('[ChatApp] Fetching messages for selectedConvo (user/token change):', selectedConvo._id);\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }).then(res => res.json()).then(setMessages);\n    }\n  }, [user, token, selectedConvo]);\n  const startConversation = async otherUserId => {\n    if (!otherUserId || !token) return;\n    const res = await fetch(`${getApiUrl()}/api/chat/conversation`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        userId: user._id,\n        otherUserId\n      })\n    });\n    const convo = await res.json();\n    setSelectedConvo(convo);\n    setConversations(prev => [...prev, convo]);\n    setUserSearch('');\n    setSearchResults([]);\n  };\n  const sendMessage = async () => {\n    var _socketRef$current2;\n    if (!input || !selectedConvo || !token) return;\n    const recipient = selectedConvo.participants.find(id => id !== user._id);\n    (_socketRef$current2 = socketRef.current) === null || _socketRef$current2 === void 0 ? void 0 : _socketRef$current2.emit('sendMessage', {\n      conversationId: selectedConvo._id,\n      sender: user._id,\n      recipient,\n      message: input\n    });\n    await fetch(`${getApiUrl()}/api/chat/message`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        conversationId: selectedConvo._id,\n        sender: user._id,\n        recipient,\n        message: input\n      })\n    });\n    // Do not update messages here; wait for real-time event\n    setInput('');\n  };\n\n  // Typing indicator\n  const handleInputChange = e => {\n    setInput(e.target.value);\n    if (selectedConvo) {\n      var _socketRef$current3;\n      const recipient = selectedConvo.participants.find(id => id !== user._id);\n      (_socketRef$current3 = socketRef.current) === null || _socketRef$current3 === void 0 ? void 0 : _socketRef$current3.emit('typing', {\n        recipient,\n        sender: user._id\n      });\n    }\n  };\n\n  // User search\n  const handleUserSearch = async e => {\n    setUserSearch(e.target.value);\n    if (e.target.value.length > 1) {\n      try {\n        const res = await fetch(`${getApiUrl()}/api/users/search?query=${encodeURIComponent(e.target.value)}`, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        if (!res.ok) {\n          console.error('User search failed:', res.status, await res.text());\n          setSearchResults([]);\n          return;\n        }\n        const results = await res.json();\n        setSearchResults(results);\n      } catch (err) {\n        console.error('User search error:', err);\n        setSearchResults([]);\n      }\n    } else {\n      setSearchResults([]);\n    }\n  };\n\n  // Handler for deleting conversation\n  const handleDeleteConversation = async () => {\n    if (!selectedConvo || !token) return;\n    if (!window.confirm('Delete this conversation? This cannot be undone.')) return;\n    await fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n      method: 'DELETE',\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n    setConversations(conversations.filter(c => c._id !== selectedConvo._id));\n    setSelectedConvo(null);\n    setMessages([]);\n  };\n\n  // Handler for block/unblock user\n  const isBlocked = selectedConvo && userWithBlocks && userWithBlocks.blockedUsers && selectedConvo.participants.some(id => id !== userWithBlocks._id && userWithBlocks.blockedUsers.includes(id));\n  const otherUserId = selectedConvo && userWithBlocks ? selectedConvo.participants.find(id => id !== userWithBlocks._id) : null;\n  const handleBlockUnblock = async () => {\n    if (!otherUserId || !token) return;\n    const url = isBlocked ? '/api/chat/unblock' : '/api/chat/block';\n    await fetch(`${getApiUrl()}${url}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        userId: user._id,\n        blockId: otherUserId\n      })\n    });\n    // Fetch updated user and update AuthContext state\n    const userRes = await fetch(`${getApiUrl()}/api/users/${user._id}`, {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n    if (userRes.ok) {\n      const updatedUser = await userRes.json();\n      updateUser(updatedUser);\n    }\n    // Emit a socket event to update both users' conversations in real time\n    if (socketRef.current) {\n      socketRef.current.emit('refreshConversations', {\n        userId: user._id,\n        otherUserId\n      });\n    }\n    // Refetch conversations for this user\n    fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    }).then(res => res.json()).then(data => setConversations(Array.isArray(data) ? data : []));\n    // Optionally, refetch selected conversation if still valid\n    if (selectedConvo) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }).then(res => res.json()).then(setMessages);\n    }\n  };\n\n  // Handler for confirming adoption\n  const handleConfirmAdoption = async (dogId, isOwner) => {\n    if (!token) return;\n    try {\n      const res = await fetch(`${getApiUrl()}/api/dogs/confirm-adoption`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          dogId,\n          isOwner\n        })\n      });\n      if (res.ok) {\n        await fetchPendingAdoptions();\n        setNotification(t('adoptionConfirmed'));\n        // Always refresh conversations\n        fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        }).then(res => res.json()).then(data => {\n          setConversations(Array.isArray(data) ? data : []);\n          // If selected convo is gone, clear selection and messages\n          if (selectedConvo && !data.find(c => c._id === selectedConvo._id)) {\n            setSelectedConvo(null);\n            setMessages([]);\n            setNotification(t('adoptionCompletedClosed'));\n          } else if (selectedConvo) {\n            // Refresh messages if convo still exists\n            fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n              headers: {\n                'Authorization': `Bearer ${token}`\n              }\n            }).then(res => res.json()).then(setMessages);\n          }\n        });\n      }\n    } catch (err) {\n      console.error('Confirm adoption error:', err);\n    }\n  };\n\n  // Handler for canceling adoption\n  const handleCancelAdoption = async dogId => {\n    if (!token) return;\n    try {\n      const res = await fetch(`${getApiUrl()}/api/dogs/${dogId}/adopt-cancel`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          reason: ''\n        })\n      });\n      if (res.ok) {\n        await fetchPendingAdoptions();\n        setNotification(t('adoptionCanceled'));\n        fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        }).then(res => res.json()).then(data => {\n          setConversations(Array.isArray(data) ? data : []);\n          if (selectedConvo && !data.find(c => c._id === selectedConvo._id)) {\n            setSelectedConvo(null);\n            setMessages([]);\n            setNotification(t('adoptionCanceledClosed'));\n          } else if (selectedConvo) {\n            fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n              headers: {\n                'Authorization': `Bearer ${token}`\n              }\n            }).then(res => res.json()).then(setMessages);\n          }\n        });\n      }\n    } catch (err) {\n      console.error('Cancel adoption error:', err);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-app-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-app-sidebar\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"chat-app-search\",\n        type: \"text\",\n        value: userSearch,\n        onChange: e => setUserSearch(e.target.value),\n        placeholder: t('searchUsersPlaceholder')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 521,\n        columnNumber: 13\n      }, this), searchResults.length > 0 && /*#__PURE__*/_jsxDEV(\"ul\", {\n        style: {\n          listStyle: 'none',\n          padding: 0,\n          marginBottom: 4\n        },\n        children: searchResults.map(u => /*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"chat-app-convo-btn\",\n            onClick: () => startConversation(u._id),\n            children: u.userName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 532,\n            columnNumber: 17\n          }, this)\n        }, u._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 531,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 529,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-app-online-users\",\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          style: {\n            fontSize: 13,\n            color: '#43b581'\n          },\n          children: \"Online Users\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 540,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-app-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-app-sidebar\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"chat-app-search\",\n              type: \"text\",\n              value: userSearch,\n              onChange: e => setUserSearch(e.target.value),\n              placeholder: t('searchUsersPlaceholder')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 543,\n              columnNumber: 15\n            }, this), searchResults.length > 0 && /*#__PURE__*/_jsxDEV(\"ul\", {\n              style: {\n                listStyle: 'none',\n                padding: 0,\n                marginBottom: 4\n              },\n              children: searchResults.map(u => /*#__PURE__*/_jsxDEV(\"li\", {\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"chat-app-convo-btn\",\n                  onClick: () => startConversation(u._id),\n                  children: u.userName\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 554,\n                  columnNumber: 23\n                }, this)\n              }, u._id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 553,\n                columnNumber: 21\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 551,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-app-online-users\",\n              children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                style: {\n                  fontSize: 13,\n                  color: '#43b581'\n                },\n                children: \"Online Users\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 560,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n                style: {\n                  listStyle: 'none',\n                  padding: 0,\n                  minHeight: 40\n                },\n                children: [onlineUsers.filter(u => {\n                  const id = typeof u === 'string' ? u : u._id;\n                  return String(id) !== String(user._id);\n                }).length === 0 && /*#__PURE__*/_jsxDEV(\"li\", {\n                  style: {\n                    color: '#aaa',\n                    fontSize: 12\n                  },\n                  children: t('noUsersOnline')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 566,\n                  columnNumber: 21\n                }, this), onlineUsers.filter(u => {\n                  const id = typeof u === 'string' ? u : u._id;\n                  return String(id) !== String(user._id);\n                }).map(u => {\n                  let displayName = '';\n                  let profileImg = '../img/androcolored-80x80.jpg';\n                  if (typeof u === 'string') {\n                    displayName = u;\n                  } else if (u && typeof u === 'object') {\n                    displayName = u.userName || u._id || 'Unknown';\n                    if (u.profilePicture) {\n                      profileImg = `${getApiUrl()}${u.profilePicture}`;\n                    }\n                  }\n                  return /*#__PURE__*/_jsxDEV(\"li\", {\n                    style: {\n                      display: 'flex',\n                      flexDirection: 'column',\n                      alignItems: 'center',\n                      gap: 4,\n                      marginBottom: 8\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"chat-app-online-dot\",\n                      style: {\n                        position: 'absolute',\n                        left: 8,\n                        top: 8\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 584,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n                      src: profileImg,\n                      alt: displayName,\n                      style: {\n                        width: 40,\n                        height: 40,\n                        borderRadius: '50%',\n                        objectFit: 'cover',\n                        border: '2px solid #ddd',\n                        minWidth: '40px',\n                        minHeight: '40px',\n                        maxWidth: '60px',\n                        maxHeight: '60px',\n                        marginBottom: 4\n                      },\n                      onError: e => {\n                        e.target.src = '../img/androcolored-80x80.jpg';\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 585,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                      className: \"chat-app-convo-btn\",\n                      style: {\n                        fontSize: 13,\n                        fontWeight: 500,\n                        marginTop: 2\n                      },\n                      onClick: () => startConversation(typeof u === 'string' ? u : u._id),\n                      children: displayName\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 591,\n                      columnNumber: 25\n                    }, this)]\n                  }, typeof u === 'string' ? u : u._id, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 583,\n                    columnNumber: 23\n                  }, this);\n                })]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 561,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 559,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 542,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-app-main\",\n            children: [selectedConvo && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-app-actions-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"chat-app-action-btn delete\",\n                onClick: handleDeleteConversation,\n                children: t('deleteConversation')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 601,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `chat-app-action-btn ${isBlocked ? 'unblock' : 'block'}`,\n                onClick: handleBlockUnblock,\n                children: isBlocked ? t('unblock') : t('block')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 602,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 600,\n              columnNumber: 17\n            }, this), selectedConvo && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-app-messages\",\n              children: [messages.map(msg => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `chat-app-message${user && msg.sender === user._id ? ' self' : ''}${msg.sender === null ? ' system' : ''}`,\n                style: msg.sender === null ? {\n                  textAlign: 'center',\n                  color: '#888',\n                  fontStyle: 'italic',\n                  background: '#f9f9f9',\n                  border: 'none',\n                  margin: '8px 0'\n                } : {},\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: `chat-app-bubble${user && msg.sender === user._id ? ' self' : ''}`,\n                  children: (() => {\n                    const m = msg.message;\n                    if (m && typeof m === 'object' && m.key) {\n                      const translated = t(m.key, m);\n                      return typeof translated === 'string' ? translated : '';\n                    }\n                    if (typeof m === 'string') {\n                      return m;\n                    }\n                    return '';\n                  })()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 613,\n                  columnNumber: 23\n                }, this)\n              }, msg._id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 608,\n                columnNumber: 21\n              }, this)), typing && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chat-app-typing\",\n                children: t('typing')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 628,\n                columnNumber: 30\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 606,\n              columnNumber: 17\n            }, this), selectedConvo && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-app-input-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                className: \"chat-app-input\",\n                type: \"text\",\n                value: input,\n                onChange: handleInputChange,\n                onKeyDown: e => {\n                  if (e.key === 'Enter') sendMessage();\n                },\n                placeholder: t('typeMessagePlaceholder')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 633,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"chat-app-send-btn\",\n                onClick: sendMessage,\n                disabled: !input.trim(),\n                children: t('send')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 641,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 632,\n              columnNumber: 17\n            }, this), notification && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-app-notification\",\n              children: notification\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 649,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => window.dispatchEvent(new CustomEvent('closeChatModal')),\n              style: {\n                position: 'absolute',\n                top: 10,\n                right: 10,\n                width: 56,\n                height: 56,\n                backgroundColor: '#e74c3c',\n                color: '#fff',\n                border: 'none',\n                borderRadius: '50%',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                boxShadow: '0 4px 12px rgba(0,0,0,0.3)',\n                cursor: 'pointer',\n                zIndex: 2147483647,\n                padding: 0\n              },\n              title: \"Close\",\n              \"aria-label\": \"Close\",\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                style: {\n                  fontSize: 40,\n                  fontWeight: 900,\n                  lineHeight: '56px',\n                  width: '100%',\n                  textAlign: 'center',\n                  display: 'block',\n                  userSelect: 'none',\n                  letterSpacing: 2\n                },\n                children: \"\\xD7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 674,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 651,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 598,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 541,\n          columnNumber: 11\n        }, this), \"); }\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 539,\n        columnNumber: 9\n      }, this), \")}\", selectedConvo && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-app-messages\",\n        children: [messages.map(msg => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `chat-app-message${user && msg.sender === user._id ? ' self' : ''}${msg.sender === null ? ' system' : ''}`,\n          style: msg.sender === null ? {\n            textAlign: 'center',\n            color: '#888',\n            fontStyle: 'italic',\n            background: '#f9f9f9',\n            border: 'none',\n            margin: '8px 0'\n          } : {},\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: `chat-app-bubble${user && msg.sender === user._id ? ' self' : ''}`,\n            children: (() => {\n              const m = msg.message;\n              if (m && typeof m === 'object' && m.key) {\n                const translated = t(m.key, m);\n                return typeof translated === 'string' ? translated : '';\n              }\n              if (typeof m === 'string') {\n                return m;\n              }\n              return '';\n            })()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 699,\n            columnNumber: 27\n          }, this)\n        }, msg._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 694,\n          columnNumber: 25\n        }, this)), typing && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-app-typing\",\n          children: t('typing')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 714,\n          columnNumber: 34\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 692,\n        columnNumber: 21\n      }, this), selectedConvo && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-app-input-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"chat-app-input\",\n          type: \"text\",\n          value: input,\n          onChange: handleInputChange,\n          onKeyDown: e => {\n            if (e.key === 'Enter') sendMessage();\n          },\n          placeholder: t('typeMessagePlaceholder')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 719,\n          columnNumber: 23\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"chat-app-send-btn\",\n          onClick: sendMessage,\n          disabled: !input.trim(),\n          children: t('send')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 727,\n          columnNumber: 23\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 718,\n        columnNumber: 21\n      }, this), notification && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-app-notification\",\n        children: notification\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 735,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => window.dispatchEvent(new CustomEvent('closeChatModal')),\n        style: {\n          position: 'absolute',\n          top: 10,\n          right: 10,\n          width: 56,\n          height: 56,\n          backgroundColor: '#e74c3c',\n          color: '#fff',\n          border: 'none',\n          borderRadius: '50%',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          boxShadow: '0 4px 12px rgba(0,0,0,0.3)',\n          cursor: 'pointer',\n          zIndex: 2147483647,\n          padding: 0\n        },\n        title: \"Close\",\n        \"aria-label\": \"Close\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontSize: 40,\n            fontWeight: 900,\n            lineHeight: '56px',\n            width: '100%',\n            textAlign: 'center',\n            display: 'block',\n            userSelect: 'none',\n            letterSpacing: 2\n          },\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 760,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 737,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 520,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 519,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatApp, \"7l7I1hk1rt3J5hNhfC7M1jH8LuQ=\", false, function () {\n  return [useTranslation, useAuth];\n});\n_c = ChatApp;\nvar _c;\n$RefreshReg$(_c, \"ChatApp\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useTranslation","io","useAuth","jsxDEV","_jsxDEV","getApiUrl","process","env","REACT_APP_API_URL","window","location","protocol","hostname","ChatApp","_s","t","i18n","changeLanguage","console","log","language","refreshOnlineUsers","socketRef","current","emit","user","token","updateUser","selectedConvoRef","onlineUsers","setOnlineUsers","userWithBlocks","getProfilePictureUrl","profilePicture","conversations","setConversations","convoUsernames","setConvoUsernames","selectedConvo","setSelectedConvo","messages","setMessages","input","setInput","typing","setTyping","notification","setNotification","userSearch","setUserSearch","searchResults","setSearchResults","pendingAdoptions","setPendingAdoptions","fetch","_id","headers","then","res","json","fetchPendingAdoptions","ok","data","error","status","err","Error","statusText","Array","isArray","usernames","convo","otherId","participants","find","id","u","username","name","on","msg","users","filter","userOnline","prev","some","userOffline","conversationId","sender","message","setTimeout","foundConvo","c","from","catch","_socketRef$current","disconnect","startConversation","otherUserId","method","body","JSON","stringify","userId","sendMessage","_socketRef$current2","recipient","handleInputChange","e","target","value","_socketRef$current3","handleUserSearch","length","encodeURIComponent","text","results","handleDeleteConversation","confirm","isBlocked","blockedUsers","includes","handleBlockUnblock","url","blockId","userRes","updatedUser","handleConfirmAdoption","dogId","isOwner","handleCancelAdoption","reason","className","children","type","onChange","placeholder","fileName","_jsxFileName","lineNumber","columnNumber","style","listStyle","padding","marginBottom","map","onClick","userName","fontSize","color","minHeight","String","displayName","profileImg","display","flexDirection","alignItems","gap","position","left","top","src","alt","width","height","borderRadius","objectFit","border","minWidth","maxWidth","maxHeight","onError","fontWeight","marginTop","textAlign","fontStyle","background","margin","m","key","translated","onKeyDown","disabled","trim","dispatchEvent","CustomEvent","right","backgroundColor","justifyContent","boxShadow","cursor","zIndex","title","lineHeight","userSelect","letterSpacing","_c","$RefreshReg$"],"sources":["/Applications/MAMP/htdocs/eky/client/src/components/ChatApp.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport '../css/chat-app.css';\nimport '../styles/chatAppNotification.css';\nimport io from 'socket.io-client';\nimport { useAuth } from '../contexts/AuthContext';\n\ninterface UserWithBlocks {\n  _id: string;\n  blockedUsers?: string[];\n}\n\ninterface Message {\n  _id: string;\n  sender: string;\n  recipient: string;\n  message: string;\n  sentAt: string;\n}\n\ninterface Conversation {\n  _id: string;\n  participants: string[];\n}\n\nconst getApiUrl = () => {\n  if (process.env.REACT_APP_API_URL) return process.env.REACT_APP_API_URL;\n  if (window.location.protocol === 'https:') {\n    // Use same host, but https\n    return `https://${window.location.hostname}`;\n}\n  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n    return `http://${window.location.hostname}:3001`;\n}\n  // For mobile/network access, use the network IP (dev only)\n  return `http://172.20.10.2:3001`;\n};\n\nconst ChatApp: React.FC = () => {\n  const { t, i18n } = useTranslation();\n  // Force language to Croatian for debugging\n  React.useEffect(() => {\n    i18n.changeLanguage('hr');\n    // Debug log for translation lookup\n    console.log('[i18n] Current language:', i18n.language);\n    console.log('[i18n] t(deleteConversation):', t('deleteConversation'));\n    console.log('[i18n] t(confirmAdoption):', t('confirmAdoption'));\n    console.log('[i18n] t(send):', t('send'));\n  }, [i18n]);\n  // Helper to refresh online users from server\n  const refreshOnlineUsers = useCallback(() => {\n    if (socketRef.current) {\n      socketRef.current.emit('getOnlineUsers');\n    }\n  }, []);\n  const { user, token, updateUser } = useAuth();\n  const selectedConvoRef = useRef<Conversation | null>(null);\n  const [onlineUsers, setOnlineUsers] = useState<{_id: string, userName: string, profilePicture?: string}[]>([]);\n  const userWithBlocks = user as UserWithBlocks | null;\n  // Profile picture logic\n  const getProfilePictureUrl = () => {\n    if (user && (user as any).profilePicture) {\n      return `${getApiUrl()}${(user as any).profilePicture}`;\n    }\n    return '../img/androcolored-80x80.jpg'; // Default profile picture\n  };\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [convoUsernames, setConvoUsernames] = useState<{[key: string]: string}>({});\n  const [selectedConvo, setSelectedConvo] = useState<Conversation | null>(null);\n  useEffect(() => {\n    selectedConvoRef.current = selectedConvo;\n  }, [selectedConvo]);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  // Remove otherUserId, use only user search and searchResults\n  const [typing, setTyping] = useState(false);\n  const [notification, setNotification] = useState<string | null>(null);\n  const [userSearch, setUserSearch] = useState('');\n  const [searchResults, setSearchResults] = useState<{_id: string, userName: string}[]>([]);\n  const [pendingAdoptions, setPendingAdoptions] = useState<any[]>([]);\n  useEffect(() => {\n    console.log('[ChatApp] onlineUsers state updated:', onlineUsers);\n  }, [onlineUsers]);\n  const socketRef = useRef<ReturnType<typeof io> | null>(null);\n\n  // Refetch system messages and update UI labels when language changes\n  useEffect(() => {\n    if (selectedConvo && token) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n    setNotification(null);\n  }, [i18n.language, selectedConvo, token]);\n\n  const fetchPendingAdoptions = useCallback(async () => {\n    if (!token) return;\n    console.log('[ChatApp] Fetching pending adoptions...');\n    try {\n      const res = await fetch(`${getApiUrl()}/api/dogs/pending-adoptions`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      if (res.ok) {\n        const data = await res.json();\n        console.log('[ChatApp] Current user:', user?._id);\n        console.log('[ChatApp] Pending adoptions:', data);\n        setPendingAdoptions(data);\n      } else {\n        console.error('[ChatApp] Failed to fetch pending adoptions:', res.status);\n      }\n    } catch (err) {\n      console.error('[ChatApp] Error fetching pending adoptions:', err);\n    }\n  }, [token]);\n\n  // Setup socket connection and listeners only once per user/token\n  useEffect(() => {\n    if (user?._id && token) {\n      console.log('[ChatApp] useEffect: user._id and token present.');\n      console.log('[ChatApp] Connecting socket for user:', user._id);\n      fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => {\n          if (!res.ok) {\n            throw new Error(`HTTP ${res.status}: ${res.statusText}`);\n          }\n          return res.json();\n        })\n        .then(async data => {\n          console.log('[ChatApp] Conversations fetched:', data);\n          setConversations(Array.isArray(data) ? data : []);\n          // Fetch usernames for each conversation's other participant\n          const usernames: {[key: string]: string} = {};\n         for (const convo of Array.isArray(data) ? data : []) {\n  const otherId = convo.participants.find((id: string) => id !== user._id);\n  if (otherId) {\n    try {\n      const res = await fetch(`${getApiUrl()}/api/users/${otherId}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      if (res.status === 404) {\n        usernames[convo._id] = '[Deleted User]';\n      } else if (res.ok) {\n        const u = await res.json();\n        usernames[convo._id] = u.username || u.name || otherId;\n      } else {\n        usernames[convo._id] = otherId;\n      }\n    } catch (err) {\n      usernames[convo._id] = '[Error]';\n    }\n  }\n}\n          setConvoUsernames(usernames);\n          await fetchPendingAdoptions();\n        })\n      if (!socketRef.current) {\n        socketRef.current = io(getApiUrl());\n        console.log('[ChatApp] Socket.IO connecting to', getApiUrl());\n        socketRef.current.on('connect', () => {\n          console.log('[ChatApp] Socket connected');\n        });\n        socketRef.current.on('connect_error', (error) => {\n          console.error('[ChatApp] Socket connection error:', error);\n        });\n        socketRef.current.on('receiveMessage', (msg) => {\n          console.log('[ChatApp] receiveMessage event:', msg);\n        });\n        socketRef.current.on('refreshConversations', () => {\n          console.log('[ChatApp] refreshConversations event received');\n        });\n        \n        socketRef.current.on('connect', () => {\n          console.log('[ChatApp] Socket connected successfully');\n        });\n        \n        socketRef.current.on('connect_error', (error) => {\n          console.error('[ChatApp] Socket connection error:', error);\n        });\n        \n        socketRef.current.emit('join', user._id);\n        console.log('[ChatApp] Emitted join for user:', user._id);\n        socketRef.current.emit('getOnlineUsers');\n        socketRef.current.on('onlineUsers', (users) => {\n          console.log('[ChatApp] Received onlineUsers:', users);\n          setOnlineUsers(users.filter((u: any) => u._id !== user._id));\n        });\n        socketRef.current.on('userOnline', (userOnline) => {\n          console.log('[ChatApp] userOnline event:', userOnline);\n          setOnlineUsers(prev => {\n            if (prev.some(u => u._id === userOnline._id)) return prev;\n            return [...prev, userOnline].filter(u => u._id !== user._id);\n          });\n        });\n        socketRef.current.on('userOffline', (userOffline) => {\n          console.log('[ChatApp] userOffline event:', userOffline);\n          setOnlineUsers(prev => prev.filter(u => u._id !== userOffline._id));\n        });\n        socketRef.current.on('receiveMessage', (msg) => {\n          console.log('[ChatApp] receiveMessage event:', msg);\n          // Always refresh conversations list\n          fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n          })\n            .then(res => res.json())\n            .then(async data => {\n              setConversations(Array.isArray(data) ? data : []);\n              // Fetch usernames for each conversation's other participant\n              const usernames: {[key: string]: string} = {};\n              for (const convo of Array.isArray(data) ? data : []) {\n                const otherId = convo.participants.find((id: string) => id !== user._id);\n                if (otherId) {\n                  const res = await fetch(`${getApiUrl()}/api/users/${otherId}`);\n                  if (res.ok) {\n                    const u = await res.json();\n                    usernames[convo._id] = u.username || u.name || otherId;\n                  } else {\n                    usernames[convo._id] = otherId;\n                  }\n                }\n              }\n              setConvoUsernames(usernames);\n              // Always refresh messages for the relevant conversation\n              if (msg.conversationId) {\n                fetch(`${getApiUrl()}/api/chat/messages/${msg.conversationId}`, {\n                  headers: { 'Authorization': `Bearer ${token}` }\n                })\n                  .then(res => res.json())\n                  .then(messages => {\n                    setMessages(messages);\n                    // Show notification for system messages\n                    if (msg.sender === null && msg.message) {\n                      setNotification(msg.message);\n                      setTimeout(() => setNotification(null), 4000);\n                      // Auto-select the conversation if not already selected\n                      if (!selectedConvo || selectedConvo._id !== msg.conversationId) {\n                        const foundConvo = (Array.isArray(data) ? data : []).find((c: any) => c._id === msg.conversationId);\n                        if (foundConvo) setSelectedConvo(foundConvo);\n                      }\n                      // Mark conversation as having a new system message (badge)\n                      setConvoUsernames(prev => ({ ...prev, [msg.conversationId]: (prev[msg.conversationId] || '') + ' â€¢' }));\n                    }\n                  });\n              }\n              // Always refresh pending adoptions on receiveMessage (for adoption events)\n              fetchPendingAdoptions();\n            });\n        });\n        socketRef.current.on('typing', ({ from }) => {\n          setTyping(true);\n          setTimeout(() => setTyping(false), 1500);\n        });\n        socketRef.current.on('notification', ({ from, message }) => {\n          setNotification(`New message from ${from}: ${message}`);\n          setTimeout(() => setNotification(null), 3000);\n        });\n        socketRef.current.on('refreshConversations', () => {\n          console.log('[ChatApp] refreshConversations event received');\n          fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n          })\n            .then(res => {\n              if (!res.ok) {\n                throw new Error(`HTTP ${res.status}: ${res.statusText}`);\n              }\n              return res.json();\n            })\n            .then(data => {\n              console.log('[ChatApp] Conversations refreshed:', data);\n              setConversations(Array.isArray(data) ? data : []);\n            })\n            .catch(err => {\n              console.error('[ChatApp] Error refreshing conversations:', err);\n            });\n          fetchPendingAdoptions();\n        });\n      }\n    }\n    return () => {\n      socketRef.current?.disconnect();\n      socketRef.current = null;\n    };\n  }, [user, token, selectedConvo, fetchPendingAdoptions]);\n\n  useEffect(() => {\n    if (selectedConvo && token) {\n      console.log('[ChatApp] Fetching messages for selectedConvo:', selectedConvo._id);\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  }, [selectedConvo, token]);\n  useEffect(() => {\n    if (selectedConvo && token) {\n      console.log('[ChatApp] Fetching messages for selectedConvo (user/token change):', selectedConvo._id);\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  }, [user, token, selectedConvo]);\n\n  const startConversation = async (otherUserId: string) => {\n    if (!otherUserId || !token) return;\n    const res = await fetch(`${getApiUrl()}/api/chat/conversation`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({ userId: user._id, otherUserId })\n    });\n    const convo = await res.json();\n    setSelectedConvo(convo);\n    setConversations(prev => [...prev, convo]);\n    setUserSearch('');\n    setSearchResults([]);\n  };\n\n  const sendMessage = async () => {\n    if (!input || !selectedConvo || !token) return;\n    const recipient = selectedConvo.participants.find(id => id !== user._id);\n    socketRef.current?.emit('sendMessage', {\n      conversationId: selectedConvo._id,\n      sender: user._id,\n      recipient,\n      message: input\n    });\n    await fetch(`${getApiUrl()}/api/chat/message`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        conversationId: selectedConvo._id,\n        sender: user._id,\n        recipient,\n        message: input\n      })\n    });\n    // Do not update messages here; wait for real-time event\n    setInput('');\n  };\n\n  // Typing indicator\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setInput(e.target.value);\n    if (selectedConvo) {\n      const recipient = selectedConvo.participants.find(id => id !== user._id);\n      socketRef.current?.emit('typing', { recipient, sender: user._id });\n    }\n  };\n\n  // User search\n  const handleUserSearch = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    setUserSearch(e.target.value);\n    if (e.target.value.length > 1) {\n      try {\n        const res = await fetch(`${getApiUrl()}/api/users/search?query=${encodeURIComponent(e.target.value)}`, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        if (!res.ok) {\n          console.error('User search failed:', res.status, await res.text());\n          setSearchResults([]);\n          return;\n        }\n        const results = await res.json();\n        setSearchResults(results);\n      } catch (err) {\n        console.error('User search error:', err);\n        setSearchResults([]);\n      }\n    } else {\n      setSearchResults([]);\n    }\n  };\n\n  // Handler for deleting conversation\n  const handleDeleteConversation = async () => {\n    if (!selectedConvo || !token) return;\n    if (!window.confirm('Delete this conversation? This cannot be undone.')) return;\n    await fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n      method: 'DELETE',\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    setConversations(conversations.filter(c => c._id !== selectedConvo._id));\n    setSelectedConvo(null);\n    setMessages([]);\n  };\n\n  // Handler for block/unblock user\n  const isBlocked = selectedConvo && userWithBlocks && userWithBlocks.blockedUsers && selectedConvo.participants.some(\n    id => id !== userWithBlocks._id && userWithBlocks.blockedUsers!.includes(id)\n  );\n  const otherUserId = selectedConvo && userWithBlocks ? selectedConvo.participants.find(id => id !== userWithBlocks._id) : null;\n  const handleBlockUnblock = async () => {\n    if (!otherUserId || !token) return;\n    const url = isBlocked ? '/api/chat/unblock' : '/api/chat/block';\n    await fetch(`${getApiUrl()}${url}`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n      body: JSON.stringify({ userId: user._id, blockId: otherUserId })\n    });\n    // Fetch updated user and update AuthContext state\n    const userRes = await fetch(`${getApiUrl()}/api/users/${user._id}`, {\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    if (userRes.ok) {\n      const updatedUser = await userRes.json();\n      updateUser(updatedUser);\n    }\n    // Emit a socket event to update both users' conversations in real time\n    if (socketRef.current) {\n      socketRef.current.emit('refreshConversations', { userId: user._id, otherUserId });\n    }\n    // Refetch conversations for this user\n    fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n      headers: { 'Authorization': `Bearer ${token}` }\n    })\n      .then(res => res.json())\n      .then(data => setConversations(Array.isArray(data) ? data : []));\n    // Optionally, refetch selected conversation if still valid\n    if (selectedConvo) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  };\n\n  // Handler for confirming adoption\n  const handleConfirmAdoption = async (dogId: string, isOwner: boolean) => {\n    if (!token) return;\n    try {\n      const res = await fetch(`${getApiUrl()}/api/dogs/confirm-adoption`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n        body: JSON.stringify({ dogId, isOwner })\n      });\n      if (res.ok) {\n        await fetchPendingAdoptions();\n        setNotification(t('adoptionConfirmed'));\n        // Always refresh conversations\n        fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        })\n          .then(res => res.json())\n          .then(data => {\n            setConversations(Array.isArray(data) ? data : []);\n            // If selected convo is gone, clear selection and messages\n            if (selectedConvo && !data.find((c: any) => c._id === selectedConvo._id)) {\n              setSelectedConvo(null);\n              setMessages([]);\n              setNotification(t('adoptionCompletedClosed'));\n            } else if (selectedConvo) {\n              // Refresh messages if convo still exists\n              fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n                headers: { 'Authorization': `Bearer ${token}` }\n              })\n                .then(res => res.json())\n                .then(setMessages);\n            }\n          });\n      }\n    } catch (err) {\n      console.error('Confirm adoption error:', err);\n    }\n  };\n\n  // Handler for canceling adoption\n  const handleCancelAdoption = async (dogId: string) => {\n    if (!token) return;\n    try {\n      const res = await fetch(`${getApiUrl()}/api/dogs/${dogId}/adopt-cancel`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n        body: JSON.stringify({ reason: '' })\n      });\n      if (res.ok) {\n        await fetchPendingAdoptions();\n        setNotification(t('adoptionCanceled'));\n        fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        })\n          .then(res => res.json())\n          .then(data => {\n            setConversations(Array.isArray(data) ? data : []);\n            if (selectedConvo && !data.find((c: any) => c._id === selectedConvo._id)) {\n              setSelectedConvo(null);\n              setMessages([]);\n              setNotification(t('adoptionCanceledClosed'));\n            } else if (selectedConvo) {\n              fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n                headers: { 'Authorization': `Bearer ${token}` }\n              })\n                .then(res => res.json())\n                .then(setMessages);\n            }\n          });\n      }\n    } catch (err) {\n      console.error('Cancel adoption error:', err);\n    }\n  };\n\n  return (\n    <div className=\"chat-app-container\">\n      <div className=\"chat-app-sidebar\">\n            <input\n              className=\"chat-app-search\"\n              type=\"text\"\n              value={userSearch}\n              onChange={e => setUserSearch(e.target.value)}\n              placeholder={t('searchUsersPlaceholder')}\n            />\n        {searchResults.length > 0 && (\n          <ul style={{ listStyle: 'none', padding: 0, marginBottom: 4 }}>\n            {searchResults.map(u => (\n              <li key={u._id}>\n                <button className=\"chat-app-convo-btn\" onClick={() => startConversation(u._id)}>{u.userName}</button>\n              </li>\n            ))}\n          </ul>\n        )}\n\n        {/* Active/Online Users List */}\n        <div className=\"chat-app-online-users\">\n          <b style={{ fontSize: 13, color: '#43b581' }}>Online Users</b>\n          <div className=\"chat-app-container\">\n            <div className=\"chat-app-sidebar\">\n              <input\n                className=\"chat-app-search\"\n                type=\"text\"\n                value={userSearch}\n                onChange={e => setUserSearch(e.target.value)}\n                placeholder={t('searchUsersPlaceholder')}\n              />\n              {searchResults.length > 0 && (\n                <ul style={{ listStyle: 'none', padding: 0, marginBottom: 4 }}>\n                  {searchResults.map(u => (\n                    <li key={u._id}>\n                      <button className=\"chat-app-convo-btn\" onClick={() => startConversation(u._id)}>{u.userName}</button>\n                    </li>\n                  ))}\n                </ul>\n              )}\n              <div className=\"chat-app-online-users\">\n                <b style={{ fontSize: 13, color: '#43b581' }}>Online Users</b>\n                <ul style={{ listStyle: 'none', padding: 0, minHeight: 40 }}>\n                  {onlineUsers.filter(u => {\n                    const id = typeof u === 'string' ? u : u._id;\n                    return String(id) !== String(user._id);\n                  }).length === 0 && (\n                    <li style={{ color: '#aaa', fontSize: 12 }}>{t('noUsersOnline')}</li>\n                  )}\n                  {onlineUsers.filter(u => {\n                    const id = typeof u === 'string' ? u : u._id;\n                    return String(id) !== String(user._id);\n                  }).map(u => {\n                    let displayName = '';\n                    let profileImg = '../img/androcolored-80x80.jpg';\n                    if (typeof u === 'string') {\n                      displayName = u;\n                    } else if (u && typeof u === 'object') {\n                      displayName = u.userName || u._id || 'Unknown';\n                      if (u.profilePicture) {\n                        profileImg = `${getApiUrl()}${u.profilePicture}`;\n                      }\n                    }\n                    return (\n                      <li key={typeof u === 'string' ? u : u._id} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 4, marginBottom: 8 }}>\n                        <span className=\"chat-app-online-dot\" style={{ position: 'absolute', left: 8, top: 8 }} />\n                        <img\n                          src={profileImg}\n                          alt={displayName}\n                          style={{ width: 40, height: 40, borderRadius: '50%', objectFit: 'cover', border: '2px solid #ddd', minWidth: '40px', minHeight: '40px', maxWidth: '60px', maxHeight: '60px', marginBottom: 4 }}\n                          onError={e => { (e.target as HTMLImageElement).src = '../img/androcolored-80x80.jpg'; }}\n                        />\n                        <button className=\"chat-app-convo-btn\" style={{ fontSize: 13, fontWeight: 500, marginTop: 2 }} onClick={() => startConversation(typeof u === 'string' ? u : u._id)}>{displayName}</button>\n                      </li>\n                    );\n                  })}\n                </ul>\n              </div>\n            </div>\n            <div className=\"chat-app-main\">\n              {selectedConvo && (\n                <div className=\"chat-app-actions-row\">\n                  <button className=\"chat-app-action-btn delete\" onClick={handleDeleteConversation}>{t('deleteConversation')}</button>\n                  <button className={`chat-app-action-btn ${isBlocked ? 'unblock' : 'block'}`} onClick={handleBlockUnblock}>{isBlocked ? t('unblock') : t('block')}</button>\n                </div>\n              )}\n              {selectedConvo && (\n                <div className=\"chat-app-messages\">\n                  {messages.map(msg => (\n                    <div\n                      key={msg._id}\n                      className={`chat-app-message${user && msg.sender === user._id ? ' self' : ''}${msg.sender === null ? ' system' : ''}`}\n                      style={msg.sender === null ? { textAlign: 'center', color: '#888', fontStyle: 'italic', background: '#f9f9f9', border: 'none', margin: '8px 0' } : {}}\n                    >\n                      <span className={`chat-app-bubble${user && msg.sender === user._id ? ' self' : ''}`}>{\n                        (() => {\n                          const m: any = msg.message;\n                          if (m && typeof m === 'object' && m.key) {\n                            const translated = t(m.key, m);\n                            return typeof translated === 'string' ? translated : '';\n                          }\n                          if (typeof m === 'string') {\n                            return m;\n                          }\n                          return '';\n                        })()\n                      }</span>\n                    </div>\n                  ))}\n                  {typing && <div className=\"chat-app-typing\">{t('typing')}</div>}\n                </div>\n              )}\n              {selectedConvo && (\n                <div className=\"chat-app-input-row\">\n                  <input\n                    className=\"chat-app-input\"\n                    type=\"text\"\n                    value={input}\n                    onChange={handleInputChange}\n                    onKeyDown={e => { if (e.key === 'Enter') sendMessage(); }}\n                    placeholder={t('typeMessagePlaceholder')}\n                  />\n                  <button\n                    className=\"chat-app-send-btn\"\n                    onClick={sendMessage}\n                    disabled={!input.trim()}\n                  >{t('send')}</button>\n                </div>\n              )}\n              {notification && (\n                <div className=\"chat-app-notification\">{notification}</div>\n              )}\n              <button\n                onClick={() => window.dispatchEvent(new CustomEvent('closeChatModal'))}\n                style={{\n                  position: 'absolute',\n                  top: 10,\n                  right: 10,\n                  width: 56,\n                  height: 56,\n                  backgroundColor: '#e74c3c',\n                  color: '#fff',\n                  border: 'none',\n                  borderRadius: '50%',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  boxShadow: '0 4px 12px rgba(0,0,0,0.3)',\n                  cursor: 'pointer',\n                  zIndex: 2147483647,\n                  padding: 0\n                }}\n                title=\"Close\"\n                aria-label=\"Close\"\n              >\n                <span style={{\n                  fontSize: 40,\n                  fontWeight: 900,\n                  lineHeight: '56px',\n                  width: '100%',\n                  textAlign: 'center',\n                  display: 'block',\n                  userSelect: 'none',\n                  letterSpacing: 2\n                }}>Ã—</span>\n              </button>\n            </div>\n          </div>\n        );\n      }\n                    </div>\n                  )}\n                  {selectedConvo && (\n                    <div className=\"chat-app-messages\">\n                      {messages.map(msg => (\n                        <div\n                          key={msg._id}\n                          className={`chat-app-message${user && msg.sender === user._id ? ' self' : ''}${msg.sender === null ? ' system' : ''}`}\n                          style={msg.sender === null ? { textAlign: 'center', color: '#888', fontStyle: 'italic', background: '#f9f9f9', border: 'none', margin: '8px 0' } : {}}\n                        >\n                          <span className={`chat-app-bubble${user && msg.sender === user._id ? ' self' : ''}`}>{\n                            (() => {\n                              const m: any = msg.message;\n                              if (m && typeof m === 'object' && m.key) {\n                                const translated = t(m.key, m);\n                                return typeof translated === 'string' ? translated : '';\n                              }\n                              if (typeof m === 'string') {\n                                return m;\n                              }\n                              return '';\n                            })()\n                          }</span>\n                        </div>\n                      ))}\n                      {typing && <div className=\"chat-app-typing\">{t('typing')}</div>}\n                    </div>\n                  )}\n                  {selectedConvo && (\n                    <div className=\"chat-app-input-row\">\n                      <input\n                        className=\"chat-app-input\"\n                        type=\"text\"\n                        value={input}\n                        onChange={handleInputChange}\n                        onKeyDown={e => { if (e.key === 'Enter') sendMessage(); }}\n                        placeholder={t('typeMessagePlaceholder')}\n                      />\n                      <button\n                        className=\"chat-app-send-btn\"\n                        onClick={sendMessage}\n                        disabled={!input.trim()}\n                      >{t('send')}</button>\n                    </div>\n                  )}\n                  {notification && (\n                    <div className=\"chat-app-notification\">{notification}</div>\n                  )}\n                  <button\n                    onClick={() => window.dispatchEvent(new CustomEvent('closeChatModal'))}\n                    style={{\n                      position: 'absolute',\n                      top: 10,\n                      right: 10,\n                      width: 56,\n                      height: 56,\n                      backgroundColor: '#e74c3c',\n                      color: '#fff',\n                      border: 'none',\n                      borderRadius: '50%',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      boxShadow: '0 4px 12px rgba(0,0,0,0.3)',\n                      cursor: 'pointer',\n                      zIndex: 2147483647,\n                      padding: 0\n                    }}\n                    title=\"Close\"\n                    aria-label=\"Close\"\n                  >\n                    <span style={{\n                      fontSize: 40,\n                      fontWeight: 900,\n                      lineHeight: '56px',\n                      width: '100%',\n                      textAlign: 'center',\n                      display: 'block',\n                      userSelect: 'none',\n                      letterSpacing: 2\n                    }}>Ã—</span>\n                  </button>\n                </div>\n              </div>\n          );\n  }\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}