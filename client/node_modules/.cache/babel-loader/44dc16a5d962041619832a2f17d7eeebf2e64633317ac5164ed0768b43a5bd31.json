{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import'../css/chat-app.css';import io from'socket.io-client';import{useAuth}from'../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const getApiUrl=()=>{if(process.env.REACT_APP_API_URL)return process.env.REACT_APP_API_URL;if(window.location.hostname==='localhost'||window.location.hostname==='127.0.0.1'){return\"http://\".concat(window.location.hostname,\":3001\");}// For mobile/network access, use the network IP\nreturn\"http://172.20.10.2:3001\";};const ChatApp=()=>{const selectedConvoRef=useRef(null);const[onlineUsers,setOnlineUsers]=useState([]);const{user,token,updateUser}=useAuth();const userWithBlocks=user;console.log('[ChatApp] user:',user);const[conversations,setConversations]=useState([]);const[convoUsernames,setConvoUsernames]=useState({});const[selectedConvo,setSelectedConvo]=useState(null);useEffect(()=>{selectedConvoRef.current=selectedConvo;},[selectedConvo]);const[messages,setMessages]=useState([]);const[input,setInput]=useState('');// Remove otherUserId, use only user search and searchResults\nconst[typing,setTyping]=useState(false);const[notification,setNotification]=useState(null);const[userSearch,setUserSearch]=useState('');const[searchResults,setSearchResults]=useState([]);useEffect(()=>{console.log('[ChatApp] onlineUsers state updated:',onlineUsers);},[onlineUsers]);const socketRef=useRef(null);// Setup socket connection and listeners only once per user/token\nuseEffect(()=>{if(user!==null&&user!==void 0&&user._id&&token){console.log('[ChatApp] Connecting socket for user:',user._id);fetch(\"\".concat(getApiUrl(),\"/api/chat/conversations/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(async data=>{setConversations(Array.isArray(data)?data:[]);// Fetch usernames for each conversation's other participant\nconst usernames={};for(const convo of Array.isArray(data)?data:[]){const otherId=convo.participants.find(id=>id!==user._id);if(otherId){const res=await fetch(\"\".concat(getApiUrl(),\"/api/users/\").concat(otherId));if(res.ok){const u=await res.json();usernames[convo._id]=u.username||u.name||otherId;}else{usernames[convo._id]=otherId;}}}setConvoUsernames(usernames);});if(!socketRef.current){socketRef.current=io(getApiUrl());console.log('[ChatApp] Socket.IO connecting to',getApiUrl());socketRef.current.emit('join',user._id);console.log('[ChatApp] Emitted join for user:',user._id);socketRef.current.emit('getOnlineUsers');socketRef.current.on('onlineUsers',users=>{console.log('[ChatApp] Received onlineUsers:',users);setOnlineUsers(users.filter(u=>u._id!==user._id));});socketRef.current.on('userOnline',userOnline=>{console.log('[ChatApp] userOnline event:',userOnline);setOnlineUsers(prev=>{if(prev.some(u=>u._id===userOnline._id))return prev;return[...prev,userOnline].filter(u=>u._id!==user._id);});});socketRef.current.on('userOffline',userOffline=>{console.log('[ChatApp] userOffline event:',userOffline);setOnlineUsers(prev=>prev.filter(u=>u._id!==userOffline._id));});socketRef.current.on('receiveMessage',msg=>{// Always refresh conversations list\nfetch(\"\".concat(getApiUrl(),\"/api/chat/conversations/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(async data=>{setConversations(Array.isArray(data)?data:[]);// Fetch usernames for each conversation's other participant\nconst usernames={};for(const convo of Array.isArray(data)?data:[]){const otherId=convo.participants.find(id=>id!==user._id);if(otherId){const res=await fetch(\"\".concat(getApiUrl(),\"/api/users/\").concat(otherId));if(res.ok){const u=await res.json();usernames[convo._id]=u.username||u.name||otherId;}else{usernames[convo._id]=otherId;}}}setConvoUsernames(usernames);// Always refresh messages for the currently selected conversation\nif(selectedConvoRef.current){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvoRef.current._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}});});socketRef.current.on('typing',_ref=>{let{from}=_ref;setTyping(true);setTimeout(()=>setTyping(false),1500);});socketRef.current.on('notification',_ref2=>{let{from,message}=_ref2;setNotification(\"New message from \".concat(from,\": \").concat(message));setTimeout(()=>setNotification(null),3000);});socketRef.current.on('refreshConversations',()=>{fetch(\"\".concat(getApiUrl(),\"/api/chat/conversations/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(data=>setConversations(Array.isArray(data)?data:[]));if(selectedConvo){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}});}}return()=>{var _socketRef$current;(_socketRef$current=socketRef.current)===null||_socketRef$current===void 0?void 0:_socketRef$current.disconnect();socketRef.current=null;};},[user,token]);useEffect(()=>{if(selectedConvo&&token){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}},[selectedConvo,token]);const startConversation=async otherUserId=>{if(!otherUserId||!token)return;const res=await fetch(\"\".concat(getApiUrl(),\"/api/chat/conversation\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({userId:user._id,otherUserId})});const convo=await res.json();setSelectedConvo(convo);setConversations(prev=>[...prev,convo]);setUserSearch('');setSearchResults([]);};const sendMessage=async()=>{var _socketRef$current2;if(!input||!selectedConvo||!token)return;const recipient=selectedConvo.participants.find(id=>id!==user._id);(_socketRef$current2=socketRef.current)===null||_socketRef$current2===void 0?void 0:_socketRef$current2.emit('sendMessage',{conversationId:selectedConvo._id,sender:user._id,recipient,message:input});await fetch(\"\".concat(getApiUrl(),\"/api/chat/message\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({conversationId:selectedConvo._id,sender:user._id,recipient,message:input})});// Do not update messages here; wait for real-time event\nsetInput('');};// Typing indicator\nconst handleInputChange=e=>{setInput(e.target.value);if(selectedConvo){var _socketRef$current3;const recipient=selectedConvo.participants.find(id=>id!==user._id);(_socketRef$current3=socketRef.current)===null||_socketRef$current3===void 0?void 0:_socketRef$current3.emit('typing',{recipient,sender:user._id});}};// User search\nconst handleUserSearch=async e=>{setUserSearch(e.target.value);if(e.target.value.length>1){try{const res=await fetch(\"\".concat(getApiUrl(),\"/api/users/search?query=\").concat(encodeURIComponent(e.target.value)));if(!res.ok){console.error('User search failed:',res.status,await res.text());setSearchResults([]);return;}const results=await res.json();setSearchResults(results);}catch(err){console.error('User search error:',err);setSearchResults([]);}}else{setSearchResults([]);}};// Handler for deleting conversation\nconst handleDeleteConversation=async()=>{if(!selectedConvo||!token)return;if(!window.confirm('Delete this conversation? This cannot be undone.'))return;await fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{method:'DELETE',headers:{'Authorization':\"Bearer \".concat(token)}});setConversations(conversations.filter(c=>c._id!==selectedConvo._id));setSelectedConvo(null);setMessages([]);};// Handler for block/unblock user\nconst isBlocked=selectedConvo&&userWithBlocks&&userWithBlocks.blockedUsers&&selectedConvo.participants.some(id=>id!==userWithBlocks._id&&userWithBlocks.blockedUsers.includes(id));const otherUserId=selectedConvo&&userWithBlocks?selectedConvo.participants.find(id=>id!==userWithBlocks._id):null;const handleBlockUnblock=async()=>{if(!otherUserId||!token)return;const url=isBlocked?'/api/chat/unblock':'/api/chat/block';await fetch(\"\".concat(getApiUrl()).concat(url),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({userId:user._id,blockId:otherUserId})});// Fetch updated user and update AuthContext state\nconst userRes=await fetch(\"\".concat(getApiUrl(),\"/api/users/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}});if(userRes.ok){const updatedUser=await userRes.json();updateUser(updatedUser);}// Emit a socket event to update both users' conversations in real time\nif(socketRef.current){socketRef.current.emit('refreshConversations',{userId:user._id,otherUserId});}// Refetch conversations for this user\nfetch(\"\".concat(getApiUrl(),\"/api/chat/conversations/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(data=>setConversations(Array.isArray(data)?data:[]));// Optionally, refetch selected conversation if still valid\nif(selectedConvo){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-sidebar\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"chat-app-search\",type:\"text\",value:userSearch,onChange:handleUserSearch,placeholder:\"Search users by name or username...\"}),searchResults.length>0&&/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,marginBottom:4},children:searchResults.map(u=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-convo-btn\",onClick:()=>startConversation(u._id),children:u.userName})},u._id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-online-users\",children:[/*#__PURE__*/_jsx(\"b\",{style:{fontSize:13,color:'#43b581'},children:\"Online Users\"}),/*#__PURE__*/_jsxs(\"ul\",{style:{listStyle:'none',padding:0,minHeight:40},children:[onlineUsers.length===0&&/*#__PURE__*/_jsx(\"li\",{style:{color:'#aaa',fontSize:12},children:\"No users online\"}),onlineUsers.map(u=>/*#__PURE__*/_jsxs(\"li\",{style:{display:'flex',alignItems:'center',gap:6},children:[/*#__PURE__*/_jsx(\"span\",{className:\"chat-app-online-dot\"}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-convo-btn\",onClick:()=>startConversation(u._id),children:u.userName})]},u._id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-convos\",children:[/*#__PURE__*/_jsx(\"b\",{style:{fontSize:13,color:'#2196f3'},children:\"Conversations\"}),/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0},children:conversations.map(convo=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-convo-btn\".concat((selectedConvo===null||selectedConvo===void 0?void 0:selectedConvo._id)===convo._id?' selected':''),onClick:()=>setSelectedConvo(convo),children:convoUsernames[convo._id]||convo.participants.filter(id=>id!==user._id).join(', ')})},convo._id))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-main\",children:[selectedConvo&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-actions-row\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn delete\",onClick:handleDeleteConversation,children:\"Delete\"}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn \".concat(isBlocked?'unblock':'block'),onClick:handleBlockUnblock,children:isBlocked?'Unblock':'Block'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-messages\",children:[messages.map(msg=>/*#__PURE__*/_jsx(\"div\",{className:\"chat-app-message\".concat(msg.sender===user._id?' self':''),children:/*#__PURE__*/_jsx(\"span\",{className:\"chat-app-bubble\".concat(msg.sender===user._id?' self':''),children:msg.message})},msg._id)),typing&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-app-typing\",children:\"Typing...\"})]}),selectedConvo&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-input-row\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"chat-app-input\",type:\"text\",value:input,onChange:handleInputChange,onKeyDown:e=>{if(e.key==='Enter')sendMessage();},placeholder:\"Type a message...\"}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-send-btn\",onClick:sendMessage,disabled:!input.trim(),children:\"Send\"})]}),notification&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-app-notification\",children:notification})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.dispatchEvent(new CustomEvent('closeChatModal')),className:\"chat-app-close-btn\",children:\"Close\"})]});};export default ChatApp;","map":{"version":3,"names":["React","useState","useEffect","useRef","io","useAuth","jsx","_jsx","jsxs","_jsxs","getApiUrl","process","env","REACT_APP_API_URL","window","location","hostname","concat","ChatApp","selectedConvoRef","onlineUsers","setOnlineUsers","user","token","updateUser","userWithBlocks","console","log","conversations","setConversations","convoUsernames","setConvoUsernames","selectedConvo","setSelectedConvo","current","messages","setMessages","input","setInput","typing","setTyping","notification","setNotification","userSearch","setUserSearch","searchResults","setSearchResults","socketRef","_id","fetch","headers","then","res","json","data","Array","isArray","usernames","convo","otherId","participants","find","id","ok","u","username","name","emit","on","users","filter","userOnline","prev","some","userOffline","msg","_ref","from","setTimeout","_ref2","message","_socketRef$current","disconnect","startConversation","otherUserId","method","body","JSON","stringify","userId","sendMessage","_socketRef$current2","recipient","conversationId","sender","handleInputChange","e","target","value","_socketRef$current3","handleUserSearch","length","encodeURIComponent","error","status","text","results","err","handleDeleteConversation","confirm","c","isBlocked","blockedUsers","includes","handleBlockUnblock","url","blockId","userRes","updatedUser","className","children","type","onChange","placeholder","style","listStyle","padding","marginBottom","map","onClick","userName","fontSize","color","minHeight","display","alignItems","gap","join","onKeyDown","key","disabled","trim","dispatchEvent","CustomEvent"],"sources":["/Applications/MAMP/htdocs/eky/client/src/components/ChatApp.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport '../css/chat-app.css';\nimport io, { Socket } from 'socket.io-client';\nimport { useAuth } from '../contexts/AuthContext';\n\ninterface UserWithBlocks {\n  _id: string;\n  blockedUsers?: string[];\n}\n\ninterface Message {\n  _id: string;\n  sender: string;\n  recipient: string;\n  message: string;\n  sentAt: string;\n}\n\n\ninterface Conversation {\n  _id: string;\n  participants: string[];\n}\n\ninterface UserWithBlocks {\n  _id: string;\n  blockedUsers?: string[];\n}\n\nconst getApiUrl = () => {\n  if (process.env.REACT_APP_API_URL) return process.env.REACT_APP_API_URL;\n  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n    return `http://${window.location.hostname}:3001`;\n  }\n  // For mobile/network access, use the network IP\n  return `http://172.20.10.2:3001`;\n};\n\nconst ChatApp: React.FC = () => {\n  const selectedConvoRef = useRef<Conversation | null>(null);\n  const [onlineUsers, setOnlineUsers] = useState<{_id: string, userName: string}[]>([]);\n\n  const { user, token, updateUser } = useAuth();\n  const userWithBlocks = user as UserWithBlocks | null;\n  console.log('[ChatApp] user:', user);\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [convoUsernames, setConvoUsernames] = useState<{[key: string]: string}>({});\n  const [selectedConvo, setSelectedConvo] = useState<Conversation | null>(null);\n  useEffect(() => {\n    selectedConvoRef.current = selectedConvo;\n  }, [selectedConvo]);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  // Remove otherUserId, use only user search and searchResults\n  const [typing, setTyping] = useState(false);\n  const [notification, setNotification] = useState<string | null>(null);\n  const [userSearch, setUserSearch] = useState('');\n  const [searchResults, setSearchResults] = useState<{_id: string, userName: string}[]>([]);\n  useEffect(() => {\n    console.log('[ChatApp] onlineUsers state updated:', onlineUsers);\n  }, [onlineUsers]);\n  const socketRef = useRef<ReturnType<typeof io> | null>(null);\n\n  // Setup socket connection and listeners only once per user/token\n  useEffect(() => {\n    if (user?._id && token) {\n      console.log('[ChatApp] Connecting socket for user:', user._id);\n      fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(async data => {\n          setConversations(Array.isArray(data) ? data : []);\n          // Fetch usernames for each conversation's other participant\n          const usernames: {[key: string]: string} = {};\n          for (const convo of Array.isArray(data) ? data : []) {\n            const otherId = convo.participants.find((id: string) => id !== user._id);\n            if (otherId) {\n              const res = await fetch(`${getApiUrl()}/api/users/${otherId}`);\n              if (res.ok) {\n                const u = await res.json();\n                usernames[convo._id] = u.username || u.name || otherId;\n              } else {\n                usernames[convo._id] = otherId;\n              }\n            }\n          }\n          setConvoUsernames(usernames);\n        });\n      if (!socketRef.current) {\n        socketRef.current = io(getApiUrl());\n        console.log('[ChatApp] Socket.IO connecting to', getApiUrl());\n        socketRef.current.emit('join', user._id);\n        console.log('[ChatApp] Emitted join for user:', user._id);\n        socketRef.current.emit('getOnlineUsers');\n        socketRef.current.on('onlineUsers', (users) => {\n          console.log('[ChatApp] Received onlineUsers:', users);\n          setOnlineUsers(users.filter((u: any) => u._id !== user._id));\n        });\n        socketRef.current.on('userOnline', (userOnline) => {\n          console.log('[ChatApp] userOnline event:', userOnline);\n          setOnlineUsers(prev => {\n            if (prev.some(u => u._id === userOnline._id)) return prev;\n            return [...prev, userOnline].filter(u => u._id !== user._id);\n          });\n        });\n        socketRef.current.on('userOffline', (userOffline) => {\n          console.log('[ChatApp] userOffline event:', userOffline);\n          setOnlineUsers(prev => prev.filter(u => u._id !== userOffline._id));\n        });\n        socketRef.current.on('receiveMessage', (msg) => {\n          // Always refresh conversations list\n          fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n          })\n            .then(res => res.json())\n            .then(async data => {\n              setConversations(Array.isArray(data) ? data : []);\n              // Fetch usernames for each conversation's other participant\n              const usernames: {[key: string]: string} = {};\n              for (const convo of Array.isArray(data) ? data : []) {\n                const otherId = convo.participants.find((id: string) => id !== user._id);\n                if (otherId) {\n                  const res = await fetch(`${getApiUrl()}/api/users/${otherId}`);\n                  if (res.ok) {\n                    const u = await res.json();\n                    usernames[convo._id] = u.username || u.name || otherId;\n                  } else {\n                    usernames[convo._id] = otherId;\n                  }\n                }\n              }\n              setConvoUsernames(usernames);\n              // Always refresh messages for the currently selected conversation\n              if (selectedConvoRef.current) {\n                fetch(`${getApiUrl()}/api/chat/messages/${selectedConvoRef.current._id}`, {\n                  headers: { 'Authorization': `Bearer ${token}` }\n                })\n                  .then(res => res.json())\n                  .then(setMessages);\n              }\n            });\n        });\n        socketRef.current.on('typing', ({ from }) => {\n          setTyping(true);\n          setTimeout(() => setTyping(false), 1500);\n        });\n        socketRef.current.on('notification', ({ from, message }) => {\n          setNotification(`New message from ${from}: ${message}`);\n          setTimeout(() => setNotification(null), 3000);\n        });\n        socketRef.current.on('refreshConversations', () => {\n          fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n          })\n            .then(res => res.json())\n            .then(data => setConversations(Array.isArray(data) ? data : []));\n          if (selectedConvo) {\n            fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n              headers: { 'Authorization': `Bearer ${token}` }\n            })\n              .then(res => res.json())\n              .then(setMessages);\n          }\n        });\n      }\n    }\n    return () => {\n      socketRef.current?.disconnect();\n      socketRef.current = null;\n    };\n  }, [user, token]);\n\n  useEffect(() => {\n    if (selectedConvo && token) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  }, [selectedConvo, token]);\n\n  const startConversation = async (otherUserId: string) => {\n    if (!otherUserId || !token) return;\n    const res = await fetch(`${getApiUrl()}/api/chat/conversation`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({ userId: user._id, otherUserId })\n    });\n    const convo = await res.json();\n    setSelectedConvo(convo);\n    setConversations(prev => [...prev, convo]);\n    setUserSearch('');\n    setSearchResults([]);\n  };\n\n  const sendMessage = async () => {\n    if (!input || !selectedConvo || !token) return;\n    const recipient = selectedConvo.participants.find(id => id !== user._id);\n    socketRef.current?.emit('sendMessage', {\n      conversationId: selectedConvo._id,\n      sender: user._id,\n      recipient,\n      message: input\n    });\n    await fetch(`${getApiUrl()}/api/chat/message`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        conversationId: selectedConvo._id,\n        sender: user._id,\n        recipient,\n        message: input\n      })\n    });\n    // Do not update messages here; wait for real-time event\n    setInput('');\n  };\n\n  // Typing indicator\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setInput(e.target.value);\n    if (selectedConvo) {\n      const recipient = selectedConvo.participants.find(id => id !== user._id);\n      socketRef.current?.emit('typing', { recipient, sender: user._id });\n    }\n  };\n\n  // User search\n  const handleUserSearch = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    setUserSearch(e.target.value);\n    if (e.target.value.length > 1) {\n      try {\n        const res = await fetch(`${getApiUrl()}/api/users/search?query=${encodeURIComponent(e.target.value)}`);\n        if (!res.ok) {\n          console.error('User search failed:', res.status, await res.text());\n          setSearchResults([]);\n          return;\n        }\n        const results = await res.json();\n        setSearchResults(results);\n      } catch (err) {\n        console.error('User search error:', err);\n        setSearchResults([]);\n      }\n    } else {\n      setSearchResults([]);\n    }\n  };\n\n  // Handler for deleting conversation\n  const handleDeleteConversation = async () => {\n    if (!selectedConvo || !token) return;\n    if (!window.confirm('Delete this conversation? This cannot be undone.')) return;\n    await fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n      method: 'DELETE',\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    setConversations(conversations.filter(c => c._id !== selectedConvo._id));\n    setSelectedConvo(null);\n    setMessages([]);\n  };\n\n  // Handler for block/unblock user\n  const isBlocked = selectedConvo && userWithBlocks && userWithBlocks.blockedUsers && selectedConvo.participants.some(\n    id => id !== userWithBlocks._id && userWithBlocks.blockedUsers!.includes(id)\n  );\n  const otherUserId = selectedConvo && userWithBlocks ? selectedConvo.participants.find(id => id !== userWithBlocks._id) : null;\n  const handleBlockUnblock = async () => {\n    if (!otherUserId || !token) return;\n    const url = isBlocked ? '/api/chat/unblock' : '/api/chat/block';\n    await fetch(`${getApiUrl()}${url}`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n      body: JSON.stringify({ userId: user._id, blockId: otherUserId })\n    });\n    // Fetch updated user and update AuthContext state\n    const userRes = await fetch(`${getApiUrl()}/api/users/${user._id}`, {\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    if (userRes.ok) {\n      const updatedUser = await userRes.json();\n      updateUser(updatedUser);\n    }\n    // Emit a socket event to update both users' conversations in real time\n    if (socketRef.current) {\n      socketRef.current.emit('refreshConversations', { userId: user._id, otherUserId });\n    }\n    // Refetch conversations for this user\n    fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n      headers: { 'Authorization': `Bearer ${token}` }\n    })\n      .then(res => res.json())\n      .then(data => setConversations(Array.isArray(data) ? data : []));\n    // Optionally, refetch selected conversation if still valid\n    if (selectedConvo) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  };\n\n  return (\n    <div className=\"chat-app-container\">\n      <div className=\"chat-app-sidebar\">\n        <input\n          className=\"chat-app-search\"\n          type=\"text\"\n          value={userSearch}\n          onChange={handleUserSearch}\n          placeholder=\"Search users by name or username...\"\n        />\n        {searchResults.length > 0 && (\n          <ul style={{ listStyle: 'none', padding: 0, marginBottom: 4 }}>\n            {searchResults.map(u => (\n              <li key={u._id}>\n                <button className=\"chat-app-convo-btn\" onClick={() => startConversation(u._id)}>{u.userName}</button>\n              </li>\n            ))}\n          </ul>\n        )}\n\n        {/* Active/Online Users List */}\n        <div className=\"chat-app-online-users\">\n          <b style={{ fontSize: 13, color: '#43b581' }}>Online Users</b>\n          <ul style={{ listStyle: 'none', padding: 0, minHeight: 40 }}>\n            {onlineUsers.length === 0 && (\n              <li style={{ color: '#aaa', fontSize: 12 }}>No users online</li>\n            )}\n            {onlineUsers.map(u => (\n              <li key={u._id} style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\n                <span className=\"chat-app-online-dot\" />\n                <button className=\"chat-app-convo-btn\" onClick={() => startConversation(u._id)}>{u.userName}</button>\n              </li>\n            ))}\n          </ul>\n        </div>\n\n        <div className=\"chat-app-convos\">\n          <b style={{ fontSize: 13, color: '#2196f3' }}>Conversations</b>\n          <ul style={{ listStyle: 'none', padding: 0 }}>\n            {conversations.map(convo => (\n              <li key={convo._id}>\n                <button\n                  className={`chat-app-convo-btn${selectedConvo?._id === convo._id ? ' selected' : ''}`}\n                  onClick={() => setSelectedConvo(convo)}\n                >\n                  {convoUsernames[convo._id] || convo.participants.filter(id => id !== user._id).join(', ')}\n                </button>\n              </li>\n            ))}\n          </ul>\n        </div>\n      </div>\n      <div className=\"chat-app-main\">\n        {/* Conversation actions always at top for all devices */}\n        {selectedConvo && (\n          <div className=\"chat-app-actions-row\">\n            <button className=\"chat-app-action-btn delete\" onClick={handleDeleteConversation}>Delete</button>\n            <button className={`chat-app-action-btn ${isBlocked ? 'unblock' : 'block'}`} onClick={handleBlockUnblock}>{isBlocked ? 'Unblock' : 'Block'}</button>\n          </div>\n        )}\n        <div className=\"chat-app-messages\">\n          {messages.map(msg => (\n            <div key={msg._id} className={`chat-app-message${msg.sender === user._id ? ' self' : ''}`}>\n              <span className={`chat-app-bubble${msg.sender === user._id ? ' self' : ''}`}>{msg.message}</span>\n            </div>\n          ))}\n          {typing && <div className=\"chat-app-typing\">Typing...</div>}\n        </div>\n        {selectedConvo && (\n          <div className=\"chat-app-input-row\">\n            <input\n              className=\"chat-app-input\"\n              type=\"text\"\n              value={input}\n              onChange={handleInputChange}\n              onKeyDown={e => { if (e.key === 'Enter') sendMessage(); }}\n              placeholder=\"Type a message...\"\n            />\n            <button\n              className=\"chat-app-send-btn\"\n              onClick={sendMessage}\n              disabled={!input.trim()}\n            >Send</button>\n          </div>\n        )}\n        {notification && (\n          <div className=\"chat-app-notification\">{notification}</div>\n        )}\n      </div>\n      {/* Close button at top right (desktop), static on mobile) */}\n      <button\n        onClick={() => window.dispatchEvent(new CustomEvent('closeChatModal'))}\n        className=\"chat-app-close-btn\"\n      >Close</button>\n    </div>\n  );\n};\n\nexport default ChatApp;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}