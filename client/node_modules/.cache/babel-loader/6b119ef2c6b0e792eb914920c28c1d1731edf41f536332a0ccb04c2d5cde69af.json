{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useTranslation}from'react-i18next';import io from'socket.io-client';import{useAuth}from'../contexts/AuthContext';import'../css/chat-app.css';import'../styles/chatAppNotification.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const getApiUrl=()=>{if(process.env.REACT_APP_API_URL)return process.env.REACT_APP_API_URL;if(window.location.protocol==='https:'){return\"https://\".concat(window.location.hostname);}if(window.location.hostname==='localhost'||window.location.hostname==='127.0.0.1'){return\"http://\".concat(window.location.hostname,\":3001\");}return\"http://172.20.10.2:3001\";};const ChatApp=()=>{const[adoptionDogStatus,setAdoptionDogStatus]=useState(null);const[dogStatusMap,setDogStatusMap]=useState({});const[adoptionDogId,setAdoptionDogId]=useState('');const[adoptionIsOwner,setAdoptionIsOwner]=useState(false);const{t}=useTranslation();const{user,token}=useAuth();const[onlineUsers,setOnlineUsers]=useState([]);const[selectedConvo,setSelectedConvo]=useState(null);const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const[typing]=useState(false);const[notification,setNotification]=useState(null);const[userSearch,setUserSearch]=useState('');const[searchResults]=useState([]);const socketRef=useRef(null);const userWithBlocks=user;// Handler for sending a message\nconst sendMessage=async()=>{var _socketRef$current;if(!input||!selectedConvo||!token)return;const recipient=selectedConvo.participants.find(id=>id!==user._id);let messagePayload={conversationId:selectedConvo._id,sender:user._id,recipient,message:input};// If adoptionDogId is set, send as adoption message\nif(adoptionDogId){messagePayload.messageType='adoption';messagePayload.dogId=adoptionDogId;messagePayload.isOwner=adoptionIsOwner;}(_socketRef$current=socketRef.current)===null||_socketRef$current===void 0?void 0:_socketRef$current.emit('sendMessage',messagePayload);await fetch(\"\".concat(getApiUrl(),\"/api/chat/message\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify(messagePayload)});// Optimistically add message to UI\nsetMessages(prev=>[...prev,{_id:Math.random().toString(36).substr(2,9),sender:user._id,recipient,message:input,sentAt:new Date().toISOString(),messageType:messagePayload.messageType,dogId:messagePayload.dogId,isOwner:messagePayload.isOwner}]);setInput('');setAdoptionDogId('');setAdoptionIsOwner(false);};// Handler for input change\nconst handleInputChange=e=>{setInput(e.target.value);if(selectedConvo){var _socketRef$current2;const recipient=selectedConvo.participants.find(id=>id!==user._id);(_socketRef$current2=socketRef.current)===null||_socketRef$current2===void 0?void 0:_socketRef$current2.emit('typing',{recipient,sender:user._id});}};// Handler for deleting a conversation\nconst handleDeleteConversation=async()=>{if(!selectedConvo||!token)return;await fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{method:'DELETE',headers:{'Authorization':\"Bearer \".concat(token)}});setSelectedConvo(null);setMessages([]);};// Block/unblock logic\n// Adoption handlers\nconst handleConfirmAdoption=async(dogId,isOwner)=>{if(!token)return;try{const res=await fetch(\"\".concat(getApiUrl(),\"/api/dogs/confirm-adoption\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({dogId,isOwner})});if(res.ok){setNotification(t('adoptionConfirmed'));}}catch(err){setNotification(t('adoptionConfirmError'));}};const handleCancelAdoption=async dogId=>{if(!token)return;try{const res=await fetch(\"\".concat(getApiUrl(),\"/api/dogs/\").concat(dogId,\"/adopt-cancel\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({reason:''})});if(res.ok){setNotification(t('adoptionCanceled'));}}catch(err){setNotification(t('adoptionCancelError'));}};const isBlocked=selectedConvo&&userWithBlocks&&userWithBlocks.blockedUsers&&selectedConvo.participants.some(id=>id!==userWithBlocks._id&&userWithBlocks.blockedUsers.includes(id));const otherUserId=selectedConvo&&userWithBlocks?selectedConvo.participants.find(id=>id!==userWithBlocks._id):null;const handleBlockUnblock=async()=>{if(!otherUserId||!token)return;const url=isBlocked?'/api/chat/unblock':'/api/chat/block';await fetch(\"\".concat(getApiUrl()).concat(url),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({userId:user._id,blockId:otherUserId})});};useEffect(()=>{if(user!==null&&user!==void 0&&user._id&&token){socketRef.current=io(getApiUrl());socketRef.current.emit('join',user._id);socketRef.current.emit('getOnlineUsers');socketRef.current.on('onlineUsers',users=>{setOnlineUsers(users.filter(u=>u._id!==user._id));});}return()=>{var _socketRef$current3;(_socketRef$current3=socketRef.current)===null||_socketRef$current3===void 0?void 0:_socketRef$current3.disconnect();socketRef.current=null;};},[user,token]);useEffect(()=>{if(selectedConvo&&token){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}},[selectedConvo,token]);// Fetch adoption status for all dogIds in messages and adoptionDogId\nuseEffect(()=>{const ids=new Set();if(adoptionDogId)ids.add(adoptionDogId);messages.forEach(m=>{if(m.dogId)ids.add(m.dogId);});const fetchStatuses=async()=>{const newMap={};await Promise.all(Array.from(ids).map(async id=>{try{const res=await fetch(\"\".concat(getApiUrl(),\"/api/dogs/\").concat(id),{headers:{'Authorization':\"Bearer \".concat(token)}});if(res.ok){const dog=await res.json();newMap[id]=dog.adoptionStatus;}}catch(_unused){}}));setDogStatusMap(newMap);if(adoptionDogId)setAdoptionDogStatus(newMap[adoptionDogId]||null);};if(token&&ids.size>0)fetchStatuses();},[adoptionDogId,messages,token]);const startConversation=async otherUserId=>{if(!otherUserId||!token)return;const res=await fetch(\"\".concat(getApiUrl(),\"/api/chat/conversation\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({userId:user._id,otherUserId})});const convo=await res.json();setSelectedConvo(convo);};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-container\",style:{position:'fixed',right:'60px',bottom:'32px',display:'flex',flexDirection:'column',width:'480px',maxWidth:'100vw',height:'80vh',zIndex:1002},children:[/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-close-btn\",onClick:()=>window.dispatchEvent(new CustomEvent('closeChatModal')),title:\"Close\",\"aria-label\":\"Close\",type:\"button\",children:/*#__PURE__*/_jsxs(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 16 16\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",style:{display:'block',margin:'auto'},children:[/*#__PURE__*/_jsx(\"circle\",{cx:\"8\",cy:\"8\",r:\"7\",fill:\"#e74c3c\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M4.5 4.5L11.5 11.5M11.5 4.5L4.5 11.5\",stroke:\"#fff\",strokeWidth:\"2\",strokeLinecap:\"round\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-sidebar\",style:{width:'100%',minWidth:0,maxWidth:'100%',borderBottom:'1px solid #e3e3e3'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-online-users\",children:[/*#__PURE__*/_jsx(\"b\",{style:{fontSize:13,color:'#43b581'},children:\"Online Users\"}),/*#__PURE__*/_jsxs(\"ul\",{style:{listStyle:'none',padding:0,minHeight:40},children:[onlineUsers.filter(u=>{const id=typeof u==='string'?u:u._id;return String(id)!==String(user._id);}).length===0&&/*#__PURE__*/_jsx(\"li\",{style:{color:'#aaa',fontSize:12},children:t('noUsersOnline')}),onlineUsers.filter(u=>{const id=typeof u==='string'?u:u._id;return String(id)!==String(user._id);}).map(u=>{let displayName='';let profileImg='../img/androcolored-80x80.jpg';if(typeof u==='string'){displayName=u;}else if(u&&typeof u==='object'){displayName=u.userName||u._id||'Unknown';if(u.profilePicture){profileImg=\"\".concat(getApiUrl()).concat(u.profilePicture);}}return/*#__PURE__*/_jsxs(\"li\",{className:\"chat-app-user-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"chat-app-online-dot\",style:{position:'absolute',left:8,top:18}}),/*#__PURE__*/_jsx(\"img\",{src:profileImg,alt:displayName,style:{width:36,height:36,borderRadius:'50%',objectFit:'cover',border:'2px solid #ddd',minWidth:'36px',minHeight:'36px',maxWidth:'40px',maxHeight:'40px',marginRight:8},onError:e=>{e.target.src='../img/androcolored-80x80.jpg';}}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-convo-btn\",style:{fontSize:13,fontWeight:500,margin:0,padding:0,background:'none',border:'none',color:'#1f4b72',cursor:'pointer'},onClick:()=>startConversation(typeof u==='string'?u:u._id),children:displayName})]},typeof u==='string'?u:u._id);})]})]}),/*#__PURE__*/_jsx(\"input\",{className:\"chat-app-search\",type:\"text\",value:userSearch,onChange:e=>setUserSearch(e.target.value),placeholder:t('searchUsersPlaceholder')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-main\",style:{flex:1,minWidth:0,minHeight:0,display:'flex',flexDirection:'column',background:'none',boxShadow:'none'},children:[selectedConvo&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-actions-row\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn delete\",onClick:handleDeleteConversation,children:t('deleteConversation')}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn \".concat(isBlocked?'unblock':'block'),onClick:handleBlockUnblock,children:isBlocked?t('unblock'):t('block')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-messages\",style:{flex:1,minHeight:0,maxHeight:'100%',overflowY:'auto',display:'flex',flexDirection:'column',background:'#f5f8fa',border:'1.5px solid #e3e3e3',borderRadius:10,marginBottom:10,boxShadow:'0 2px 8px rgba(33,150,243,0.06)'},children:[messages.length===0&&adoptionDogId&&selectedConvo&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-message\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"chat-app-bubble\",children:t('adoptionRequest')}),(()=>{const otherId=selectedConvo.participants.find(id=>id!==user._id);if(dogStatusMap[adoptionDogId]==='available'&&otherId===user._id&&adoptionIsOwner===false){return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-adoption-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn confirm\",onClick:()=>handleConfirmAdoption(adoptionDogId,adoptionIsOwner),children:t('confirmAdoption')}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn cancel\",onClick:()=>handleCancelAdoption(adoptionDogId),children:t('cancelAdoption')})]});}return null;})()]}),messages.map(msg=>/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-message\".concat(user&&msg.sender===user._id?' self':'').concat(msg.sender===null?' system':''),style:msg.sender===null?{textAlign:'center',color:'#888',fontStyle:'italic',background:'#f9f9f9',border:'none',margin:'8px 0'}:{},children:[/*#__PURE__*/_jsx(\"span\",{className:\"chat-app-bubble\".concat(user&&msg.sender===user._id?' self':''),children:msg.message}),msg.messageType==='adoption'&&msg.dogId&&dogStatusMap[msg.dogId]==='available'&&msg.sender!==user._id&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-adoption-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn confirm\",onClick:()=>handleConfirmAdoption(msg.dogId,msg.isOwner),children:t('confirmAdoption')}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn cancel\",onClick:()=>handleCancelAdoption(msg.dogId),children:t('cancelAdoption')})]})]},msg._id)),typing&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-app-typing\",children:t('typing')})]})]}),selectedConvo&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-input-row\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"chat-app-input\",type:\"text\",value:input,onChange:handleInputChange,onKeyDown:e=>{if(e.key==='Enter')sendMessage();},placeholder:t('typeMessagePlaceholder')||'Type a message...'}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-send-btn\",onClick:sendMessage,disabled:!input.trim(),children:t('send')||'Send'})]}),notification&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-app-notification\",children:notification})]})]});};export default ChatApp;","map":{"version":3,"names":["React","useState","useEffect","useRef","useTranslation","io","useAuth","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","getApiUrl","process","env","REACT_APP_API_URL","window","location","protocol","concat","hostname","ChatApp","adoptionDogStatus","setAdoptionDogStatus","dogStatusMap","setDogStatusMap","adoptionDogId","setAdoptionDogId","adoptionIsOwner","setAdoptionIsOwner","t","user","token","onlineUsers","setOnlineUsers","selectedConvo","setSelectedConvo","messages","setMessages","input","setInput","typing","notification","setNotification","userSearch","setUserSearch","searchResults","socketRef","userWithBlocks","sendMessage","_socketRef$current","recipient","participants","find","id","_id","messagePayload","conversationId","sender","message","messageType","dogId","isOwner","current","emit","fetch","method","headers","body","JSON","stringify","prev","Math","random","toString","substr","sentAt","Date","toISOString","handleInputChange","e","target","value","_socketRef$current2","handleDeleteConversation","handleConfirmAdoption","res","ok","err","handleCancelAdoption","reason","isBlocked","blockedUsers","some","includes","otherUserId","handleBlockUnblock","url","userId","blockId","on","users","filter","u","_socketRef$current3","disconnect","then","json","ids","Set","add","forEach","m","fetchStatuses","newMap","Promise","all","Array","from","map","dog","adoptionStatus","_unused","size","startConversation","convo","className","style","position","right","bottom","display","flexDirection","width","maxWidth","height","zIndex","children","onClick","dispatchEvent","CustomEvent","title","type","viewBox","fill","xmlns","margin","cx","cy","r","d","stroke","strokeWidth","strokeLinecap","minWidth","borderBottom","fontSize","color","listStyle","padding","minHeight","String","length","displayName","profileImg","userName","profilePicture","left","top","src","alt","borderRadius","objectFit","border","maxHeight","marginRight","onError","fontWeight","background","cursor","onChange","placeholder","flex","boxShadow","overflowY","marginBottom","otherId","msg","textAlign","fontStyle","onKeyDown","key","disabled","trim"],"sources":["/Applications/MAMP/htdocs/eky/client/src/components/ChatApp.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport io from 'socket.io-client';\nimport { useAuth } from '../contexts/AuthContext';\nimport '../css/chat-app.css';\nimport '../styles/chatAppNotification.css';\n\ninterface UserWithBlocks {\n  _id: string;\n  blockedUsers?: string[];\n}\ninterface Message {\n  _id: string;\n  sender: string;\n  recipient: string;\n  message: string;\n  sentAt: string;\n  messageType?: string;\n  dogId?: string;\n  isOwner?: boolean;\n}\ninterface Conversation {\n  _id: string;\n  participants: string[];\n}\nconst getApiUrl = () => {\n  if (process.env.REACT_APP_API_URL) return process.env.REACT_APP_API_URL;\n  if (window.location.protocol === 'https:') {\n    return `https://${window.location.hostname}`;\n  }\n  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n    return `http://${window.location.hostname}:3001`;\n  }\n  return `http://172.20.10.2:3001`;\n};\n\nconst ChatApp: React.FC = () => {\n      const [adoptionDogStatus, setAdoptionDogStatus] = useState<string | null>(null);\n      const [dogStatusMap, setDogStatusMap] = useState<Record<string, string>>({});\n      const [adoptionDogId, setAdoptionDogId] = useState('');\n      const [adoptionIsOwner, setAdoptionIsOwner] = useState(false);\n\n  const { t } = useTranslation();\n  const { user, token } = useAuth();\n  const [onlineUsers, setOnlineUsers] = useState<{_id: string, userName: string, profilePicture?: string}[]>([]);\n  const [selectedConvo, setSelectedConvo] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  const [typing] = useState(false);\n  const [notification, setNotification] = useState<string | null>(null);\n  const [userSearch, setUserSearch] = useState('');\n  const [searchResults] = useState<{_id: string, userName: string}[]>([]);\n  const socketRef = useRef<ReturnType<typeof io> | null>(null);\n  const userWithBlocks = user as UserWithBlocks | null;\n\n  // Handler for sending a message\n  const sendMessage = async () => {\n    if (!input || !selectedConvo || !token) return;\n    const recipient = selectedConvo.participants.find(id => id !== user._id);\n    let messagePayload: any = {\n      conversationId: selectedConvo._id,\n      sender: user._id,\n      recipient,\n      message: input\n    };\n    // If adoptionDogId is set, send as adoption message\n    if (adoptionDogId) {\n      messagePayload.messageType = 'adoption';\n      messagePayload.dogId = adoptionDogId;\n      messagePayload.isOwner = adoptionIsOwner;\n    }\n    socketRef.current?.emit('sendMessage', messagePayload);\n    await fetch(`${getApiUrl()}/api/chat/message`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify(messagePayload)\n    });\n    // Optimistically add message to UI\n    setMessages(prev => [\n      ...prev,\n      {\n        _id: Math.random().toString(36).substr(2, 9),\n        sender: user._id,\n        recipient,\n        message: input,\n        sentAt: new Date().toISOString(),\n        messageType: messagePayload.messageType,\n        dogId: messagePayload.dogId,\n        isOwner: messagePayload.isOwner\n      }\n    ]);\n    setInput('');\n    setAdoptionDogId('');\n    setAdoptionIsOwner(false);\n  };\n\n  // Handler for input change\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setInput(e.target.value);\n    if (selectedConvo) {\n      const recipient = selectedConvo.participants.find(id => id !== user._id);\n      socketRef.current?.emit('typing', { recipient, sender: user._id });\n    }\n  };\n\n  // Handler for deleting a conversation\n  const handleDeleteConversation = async () => {\n    if (!selectedConvo || !token) return;\n    await fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n      method: 'DELETE',\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    setSelectedConvo(null);\n    setMessages([]);\n  };\n\n  // Block/unblock logic\n    // Adoption handlers\n    const handleConfirmAdoption = async (dogId: string, isOwner: boolean) => {\n      if (!token) return;\n      try {\n        const res = await fetch(`${getApiUrl()}/api/dogs/confirm-adoption`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n          body: JSON.stringify({ dogId, isOwner })\n        });\n        if (res.ok) {\n          setNotification(t('adoptionConfirmed'));\n        }\n      } catch (err) {\n        setNotification(t('adoptionConfirmError'));\n      }\n    };\n\n    const handleCancelAdoption = async (dogId: string) => {\n      if (!token) return;\n      try {\n        const res = await fetch(`${getApiUrl()}/api/dogs/${dogId}/adopt-cancel`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n          body: JSON.stringify({ reason: '' })\n        });\n        if (res.ok) {\n          setNotification(t('adoptionCanceled'));\n        }\n      } catch (err) {\n        setNotification(t('adoptionCancelError'));\n      }\n    };\n  const isBlocked = selectedConvo && userWithBlocks && userWithBlocks.blockedUsers && selectedConvo.participants.some(\n    id => id !== userWithBlocks._id && userWithBlocks.blockedUsers!.includes(id)\n  );\n  const otherUserId = selectedConvo && userWithBlocks ? selectedConvo.participants.find(id => id !== userWithBlocks._id) : null;\n  const handleBlockUnblock = async () => {\n    if (!otherUserId || !token) return;\n    const url = isBlocked ? '/api/chat/unblock' : '/api/chat/block';\n    await fetch(`${getApiUrl()}${url}`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n      body: JSON.stringify({ userId: user._id, blockId: otherUserId })\n    });\n  };\n\n  useEffect(() => {\n    if (user?._id && token) {\n      socketRef.current = io(getApiUrl());\n      socketRef.current.emit('join', user._id);\n      socketRef.current.emit('getOnlineUsers');\n      socketRef.current.on('onlineUsers', (users) => {\n        setOnlineUsers(users.filter((u: any) => u._id !== user._id));\n      });\n    }\n    return () => {\n      socketRef.current?.disconnect();\n      socketRef.current = null;\n    };\n  }, [user, token]);\n\n  useEffect(() => {\n    if (selectedConvo && token) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  }, [selectedConvo, token]);\n\n  // Fetch adoption status for all dogIds in messages and adoptionDogId\n  useEffect(() => {\n    const ids = new Set<string>();\n    if (adoptionDogId) ids.add(adoptionDogId);\n    messages.forEach(m => { if (m.dogId) ids.add(m.dogId); });\n    const fetchStatuses = async () => {\n      const newMap: Record<string, string> = {};\n      await Promise.all(Array.from(ids).map(async id => {\n        try {\n          const res = await fetch(`${getApiUrl()}/api/dogs/${id}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n          });\n          if (res.ok) {\n            const dog = await res.json();\n            newMap[id] = dog.adoptionStatus;\n          }\n        } catch {}\n      }));\n      setDogStatusMap(newMap);\n      if (adoptionDogId) setAdoptionDogStatus(newMap[adoptionDogId] || null);\n    };\n    if (token && ids.size > 0) fetchStatuses();\n  }, [adoptionDogId, messages, token]);\n\n  const startConversation = async (otherUserId: string) => {\n    if (!otherUserId || !token) return;\n    const res = await fetch(`${getApiUrl()}/api/chat/conversation`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({ userId: user._id, otherUserId })\n    });\n    const convo = await res.json();\n    setSelectedConvo(convo);\n  };\n  \n  return (\n    <div className=\"chat-app-container\" style={{position: 'fixed', right: '60px', bottom: '32px', display: 'flex', flexDirection: 'column', width: '480px', maxWidth: '100vw', height: '80vh', zIndex: 1002}}>\n      <button\n        className=\"chat-app-close-btn\"\n        onClick={() => window.dispatchEvent(new CustomEvent('closeChatModal'))}\n        title=\"Close\"\n        aria-label=\"Close\"\n        type=\"button\"\n      >\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" style={{display:'block',margin:'auto'}}>\n          <circle cx=\"8\" cy=\"8\" r=\"7\" fill=\"#e74c3c\"/>\n          <path d=\"M4.5 4.5L11.5 11.5M11.5 4.5L4.5 11.5\" stroke=\"#fff\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\n        </svg>\n      </button>\n      <div className=\"chat-app-sidebar\" style={{width: '100%', minWidth: 0, maxWidth: '100%', borderBottom: '1px solid #e3e3e3'}}>\n        <div className=\"chat-app-online-users\">\n          <b style={{ fontSize: 13, color: '#43b581' }}>Online Users</b>\n          <ul style={{ listStyle: 'none', padding: 0, minHeight: 40 }}>\n            {onlineUsers.filter(u => {\n              const id = typeof u === 'string' ? u : u._id;\n              return String(id) !== String(user._id);\n            }).length === 0 && (\n              <li style={{ color: '#aaa', fontSize: 12 }}>{t('noUsersOnline')}</li>\n            )}\n            {onlineUsers.filter(u => {\n              const id = typeof u === 'string' ? u : u._id;\n              return String(id) !== String(user._id);\n            }).map(u => {\n              let displayName = '';\n              let profileImg = '../img/androcolored-80x80.jpg';\n              if (typeof u === 'string') {\n                displayName = u;\n              } else if (u && typeof u === 'object') {\n                displayName = u.userName || u._id || 'Unknown';\n                if (u.profilePicture) {\n                  profileImg = `${getApiUrl()}${u.profilePicture}`;\n                }\n              }\n              return (\n                <li key={typeof u === 'string' ? u : u._id} className=\"chat-app-user-row\">\n                  <span className=\"chat-app-online-dot\" style={{ position: 'absolute', left: 8, top: 18 }} />\n                  <img\n                    src={profileImg}\n                    alt={displayName}\n                    style={{ width: 36, height: 36, borderRadius: '50%', objectFit: 'cover', border: '2px solid #ddd', minWidth: '36px', minHeight: '36px', maxWidth: '40px', maxHeight: '40px', marginRight: 8 }}\n                    onError={e => { (e.target as HTMLImageElement).src = '../img/androcolored-80x80.jpg'; }}\n                  />\n                  <button className=\"chat-app-convo-btn\" style={{ fontSize: 13, fontWeight: 500, margin: 0, padding: 0, background: 'none', border: 'none', color: '#1f4b72', cursor: 'pointer' }} onClick={() => startConversation(typeof u === 'string' ? u : u._id)}>{displayName}</button>\n                </li>\n              );\n            })}\n          </ul>\n        </div>\n        <input\n          className=\"chat-app-search\"\n          type=\"text\"\n          value={userSearch}\n          onChange={e => setUserSearch(e.target.value)}\n          placeholder={t('searchUsersPlaceholder')}\n        />\n      </div>\n      <div className=\"chat-app-main\" style={{flex: 1, minWidth: 0, minHeight: 0, display: 'flex', flexDirection: 'column', background: 'none', boxShadow: 'none'}}>\n        {selectedConvo && (\n          <>\n            <div className=\"chat-app-actions-row\">\n              <button className=\"chat-app-action-btn delete\" onClick={handleDeleteConversation}>{t('deleteConversation')}</button>\n              <button className={`chat-app-action-btn ${isBlocked ? 'unblock' : 'block'}`} onClick={handleBlockUnblock}>{isBlocked ? t('unblock') : t('block')}</button>\n            </div>\n            <div className=\"chat-app-messages\" style={{\n              flex: 1,\n              minHeight: 0,\n              maxHeight: '100%',\n              overflowY: 'auto',\n              display: 'flex',\n              flexDirection: 'column',\n              background: '#f5f8fa',\n              border: '1.5px solid #e3e3e3',\n              borderRadius: 10,\n              marginBottom: 10,\n              boxShadow: '0 2px 8px rgba(33,150,243,0.06)'\n            }}>\n              {messages.length === 0 && adoptionDogId && selectedConvo && (\n                <div className=\"chat-app-message\">\n                  <span className=\"chat-app-bubble\">{t('adoptionRequest')}</span>\n                  {/* Show confirm/cancel if user is NOT the owner and dog is available */}\n                  {(() => {\n                    const otherId = selectedConvo.participants.find(id => id !== user._id);\n                    if (dogStatusMap[adoptionDogId] === 'available' && otherId === user._id && adoptionIsOwner === false) {\n                      return (\n                        <div className=\"chat-app-adoption-actions\">\n                          <button className=\"chat-app-action-btn confirm\" onClick={() => handleConfirmAdoption(adoptionDogId, adoptionIsOwner)}>{t('confirmAdoption')}</button>\n                          <button className=\"chat-app-action-btn cancel\" onClick={() => handleCancelAdoption(adoptionDogId)}>{t('cancelAdoption')}</button>\n                        </div>\n                      );\n                    }\n                    return null;\n                  })()}\n                </div>\n              )}\n              {messages.map(msg => (\n                <div\n                  key={msg._id}\n                  className={`chat-app-message${user && msg.sender === user._id ? ' self' : ''}${msg.sender === null ? ' system' : ''}`}\n                  style={msg.sender === null ? { textAlign: 'center', color: '#888', fontStyle: 'italic', background: '#f9f9f9', border: 'none', margin: '8px 0' } : {}}\n                >\n                  <span className={`chat-app-bubble${user && msg.sender === user._id ? ' self' : ''}`}>{msg.message}</span>\n                  {msg.messageType === 'adoption' && msg.dogId && dogStatusMap[msg.dogId] === 'available' && msg.sender !== user._id && (\n                    <div className=\"chat-app-adoption-actions\">\n                      <button className=\"chat-app-action-btn confirm\" onClick={() => handleConfirmAdoption(msg.dogId, msg.isOwner)}>{t('confirmAdoption')}</button>\n                      <button className=\"chat-app-action-btn cancel\" onClick={() => handleCancelAdoption(msg.dogId)}>{t('cancelAdoption')}</button>\n                    </div>\n                  )}\n                </div>\n              ))}\n              {typing && <div className=\"chat-app-typing\">{t('typing')}</div>}\n            </div>\n          </>\n        )}\n        {selectedConvo && (\n          <div className=\"chat-app-input-row\">\n            <input\n              className=\"chat-app-input\"\n              type=\"text\"\n              value={input}\n              onChange={handleInputChange}\n              onKeyDown={e => { if (e.key === 'Enter') sendMessage(); }}\n              placeholder={t('typeMessagePlaceholder') || 'Type a message...'}\n            />\n            <button\n              className=\"chat-app-send-btn\"\n              onClick={sendMessage}\n              disabled={!input.trim()}\n            >{t('send') || 'Send'}</button>\n          </div>\n        )}\n        {notification && (\n          <div className=\"chat-app-notification\">{notification}</div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default ChatApp;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAC1D,OAASC,cAAc,KAAQ,eAAe,CAC9C,MAAO,CAAAC,EAAE,KAAM,kBAAkB,CACjC,OAASC,OAAO,KAAQ,yBAAyB,CACjD,MAAO,qBAAqB,CAC5B,MAAO,mCAAmC,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAoB3C,KAAM,CAAAC,SAAS,CAAGA,CAAA,GAAM,CACtB,GAAIC,OAAO,CAACC,GAAG,CAACC,iBAAiB,CAAE,MAAO,CAAAF,OAAO,CAACC,GAAG,CAACC,iBAAiB,CACvE,GAAIC,MAAM,CAACC,QAAQ,CAACC,QAAQ,GAAK,QAAQ,CAAE,CACzC,iBAAAC,MAAA,CAAkBH,MAAM,CAACC,QAAQ,CAACG,QAAQ,EAC5C,CACA,GAAIJ,MAAM,CAACC,QAAQ,CAACG,QAAQ,GAAK,WAAW,EAAIJ,MAAM,CAACC,QAAQ,CAACG,QAAQ,GAAK,WAAW,CAAE,CACxF,gBAAAD,MAAA,CAAiBH,MAAM,CAACC,QAAQ,CAACG,QAAQ,UAC3C,CACA,gCACF,CAAC,CAED,KAAM,CAAAC,OAAiB,CAAGA,CAAA,GAAM,CAC1B,KAAM,CAACC,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGvB,QAAQ,CAAgB,IAAI,CAAC,CAC/E,KAAM,CAACwB,YAAY,CAAEC,eAAe,CAAC,CAAGzB,QAAQ,CAAyB,CAAC,CAAC,CAAC,CAC5E,KAAM,CAAC0B,aAAa,CAAEC,gBAAgB,CAAC,CAAG3B,QAAQ,CAAC,EAAE,CAAC,CACtD,KAAM,CAAC4B,eAAe,CAAEC,kBAAkB,CAAC,CAAG7B,QAAQ,CAAC,KAAK,CAAC,CAEjE,KAAM,CAAE8B,CAAE,CAAC,CAAG3B,cAAc,CAAC,CAAC,CAC9B,KAAM,CAAE4B,IAAI,CAAEC,KAAM,CAAC,CAAG3B,OAAO,CAAC,CAAC,CACjC,KAAM,CAAC4B,WAAW,CAAEC,cAAc,CAAC,CAAGlC,QAAQ,CAA6D,EAAE,CAAC,CAC9G,KAAM,CAACmC,aAAa,CAAEC,gBAAgB,CAAC,CAAGpC,QAAQ,CAAsB,IAAI,CAAC,CAC7E,KAAM,CAACqC,QAAQ,CAAEC,WAAW,CAAC,CAAGtC,QAAQ,CAAY,EAAE,CAAC,CACvD,KAAM,CAACuC,KAAK,CAAEC,QAAQ,CAAC,CAAGxC,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACyC,MAAM,CAAC,CAAGzC,QAAQ,CAAC,KAAK,CAAC,CAChC,KAAM,CAAC0C,YAAY,CAAEC,eAAe,CAAC,CAAG3C,QAAQ,CAAgB,IAAI,CAAC,CACrE,KAAM,CAAC4C,UAAU,CAAEC,aAAa,CAAC,CAAG7C,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAAC8C,aAAa,CAAC,CAAG9C,QAAQ,CAAoC,EAAE,CAAC,CACvE,KAAM,CAAA+C,SAAS,CAAG7C,MAAM,CAA+B,IAAI,CAAC,CAC5D,KAAM,CAAA8C,cAAc,CAAGjB,IAA6B,CAEpD;AACA,KAAM,CAAAkB,WAAW,CAAG,KAAAA,CAAA,GAAY,KAAAC,kBAAA,CAC9B,GAAI,CAACX,KAAK,EAAI,CAACJ,aAAa,EAAI,CAACH,KAAK,CAAE,OACxC,KAAM,CAAAmB,SAAS,CAAGhB,aAAa,CAACiB,YAAY,CAACC,IAAI,CAACC,EAAE,EAAIA,EAAE,GAAKvB,IAAI,CAACwB,GAAG,CAAC,CACxE,GAAI,CAAAC,cAAmB,CAAG,CACxBC,cAAc,CAAEtB,aAAa,CAACoB,GAAG,CACjCG,MAAM,CAAE3B,IAAI,CAACwB,GAAG,CAChBJ,SAAS,CACTQ,OAAO,CAAEpB,KACX,CAAC,CACD;AACA,GAAIb,aAAa,CAAE,CACjB8B,cAAc,CAACI,WAAW,CAAG,UAAU,CACvCJ,cAAc,CAACK,KAAK,CAAGnC,aAAa,CACpC8B,cAAc,CAACM,OAAO,CAAGlC,eAAe,CAC1C,CACA,CAAAsB,kBAAA,CAAAH,SAAS,CAACgB,OAAO,UAAAb,kBAAA,iBAAjBA,kBAAA,CAAmBc,IAAI,CAAC,aAAa,CAAER,cAAc,CAAC,CACtD,KAAM,CAAAS,KAAK,IAAA9C,MAAA,CAAIP,SAAS,CAAC,CAAC,sBAAqB,CAC7CsD,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAAkB,CAClC,eAAe,WAAAhD,MAAA,CAAYa,KAAK,CAClC,CAAC,CACDoC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACd,cAAc,CACrC,CAAC,CAAC,CACF;AACAlB,WAAW,CAACiC,IAAI,EAAI,CAClB,GAAGA,IAAI,CACP,CACEhB,GAAG,CAAEiB,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,CAC5CjB,MAAM,CAAE3B,IAAI,CAACwB,GAAG,CAChBJ,SAAS,CACTQ,OAAO,CAAEpB,KAAK,CACdqC,MAAM,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAChClB,WAAW,CAAEJ,cAAc,CAACI,WAAW,CACvCC,KAAK,CAAEL,cAAc,CAACK,KAAK,CAC3BC,OAAO,CAAEN,cAAc,CAACM,OAC1B,CAAC,CACF,CAAC,CACFtB,QAAQ,CAAC,EAAE,CAAC,CACZb,gBAAgB,CAAC,EAAE,CAAC,CACpBE,kBAAkB,CAAC,KAAK,CAAC,CAC3B,CAAC,CAED;AACA,KAAM,CAAAkD,iBAAiB,CAAIC,CAAsC,EAAK,CACpExC,QAAQ,CAACwC,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CACxB,GAAI/C,aAAa,CAAE,KAAAgD,mBAAA,CACjB,KAAM,CAAAhC,SAAS,CAAGhB,aAAa,CAACiB,YAAY,CAACC,IAAI,CAACC,EAAE,EAAIA,EAAE,GAAKvB,IAAI,CAACwB,GAAG,CAAC,CACxE,CAAA4B,mBAAA,CAAApC,SAAS,CAACgB,OAAO,UAAAoB,mBAAA,iBAAjBA,mBAAA,CAAmBnB,IAAI,CAAC,QAAQ,CAAE,CAAEb,SAAS,CAAEO,MAAM,CAAE3B,IAAI,CAACwB,GAAI,CAAC,CAAC,CACpE,CACF,CAAC,CAED;AACA,KAAM,CAAA6B,wBAAwB,CAAG,KAAAA,CAAA,GAAY,CAC3C,GAAI,CAACjD,aAAa,EAAI,CAACH,KAAK,CAAE,OAC9B,KAAM,CAAAiC,KAAK,IAAA9C,MAAA,CAAIP,SAAS,CAAC,CAAC,wBAAAO,MAAA,CAAsBgB,aAAa,CAACoB,GAAG,EAAI,CACnEW,MAAM,CAAE,QAAQ,CAChBC,OAAO,CAAE,CAAE,eAAe,WAAAhD,MAAA,CAAYa,KAAK,CAAG,CAChD,CAAC,CAAC,CACFI,gBAAgB,CAAC,IAAI,CAAC,CACtBE,WAAW,CAAC,EAAE,CAAC,CACjB,CAAC,CAED;AACE;AACA,KAAM,CAAA+C,qBAAqB,CAAG,KAAAA,CAAOxB,KAAa,CAAEC,OAAgB,GAAK,CACvE,GAAI,CAAC9B,KAAK,CAAE,OACZ,GAAI,CACF,KAAM,CAAAsD,GAAG,CAAG,KAAM,CAAArB,KAAK,IAAA9C,MAAA,CAAIP,SAAS,CAAC,CAAC,+BAA8B,CAClEsD,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAkB,CAAE,eAAe,WAAAhD,MAAA,CAAYa,KAAK,CAAG,CAAC,CACnFoC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAET,KAAK,CAAEC,OAAQ,CAAC,CACzC,CAAC,CAAC,CACF,GAAIwB,GAAG,CAACC,EAAE,CAAE,CACV5C,eAAe,CAACb,CAAC,CAAC,mBAAmB,CAAC,CAAC,CACzC,CACF,CAAE,MAAO0D,GAAG,CAAE,CACZ7C,eAAe,CAACb,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAC5C,CACF,CAAC,CAED,KAAM,CAAA2D,oBAAoB,CAAG,KAAO,CAAA5B,KAAa,EAAK,CACpD,GAAI,CAAC7B,KAAK,CAAE,OACZ,GAAI,CACF,KAAM,CAAAsD,GAAG,CAAG,KAAM,CAAArB,KAAK,IAAA9C,MAAA,CAAIP,SAAS,CAAC,CAAC,eAAAO,MAAA,CAAa0C,KAAK,kBAAiB,CACvEK,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAkB,CAAE,eAAe,WAAAhD,MAAA,CAAYa,KAAK,CAAG,CAAC,CACnFoC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEoB,MAAM,CAAE,EAAG,CAAC,CACrC,CAAC,CAAC,CACF,GAAIJ,GAAG,CAACC,EAAE,CAAE,CACV5C,eAAe,CAACb,CAAC,CAAC,kBAAkB,CAAC,CAAC,CACxC,CACF,CAAE,MAAO0D,GAAG,CAAE,CACZ7C,eAAe,CAACb,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAC3C,CACF,CAAC,CACH,KAAM,CAAA6D,SAAS,CAAGxD,aAAa,EAAIa,cAAc,EAAIA,cAAc,CAAC4C,YAAY,EAAIzD,aAAa,CAACiB,YAAY,CAACyC,IAAI,CACjHvC,EAAE,EAAIA,EAAE,GAAKN,cAAc,CAACO,GAAG,EAAIP,cAAc,CAAC4C,YAAY,CAAEE,QAAQ,CAACxC,EAAE,CAC7E,CAAC,CACD,KAAM,CAAAyC,WAAW,CAAG5D,aAAa,EAAIa,cAAc,CAAGb,aAAa,CAACiB,YAAY,CAACC,IAAI,CAACC,EAAE,EAAIA,EAAE,GAAKN,cAAc,CAACO,GAAG,CAAC,CAAG,IAAI,CAC7H,KAAM,CAAAyC,kBAAkB,CAAG,KAAAA,CAAA,GAAY,CACrC,GAAI,CAACD,WAAW,EAAI,CAAC/D,KAAK,CAAE,OAC5B,KAAM,CAAAiE,GAAG,CAAGN,SAAS,CAAG,mBAAmB,CAAG,iBAAiB,CAC/D,KAAM,CAAA1B,KAAK,IAAA9C,MAAA,CAAIP,SAAS,CAAC,CAAC,EAAAO,MAAA,CAAG8E,GAAG,EAAI,CAClC/B,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAkB,CAAE,eAAe,WAAAhD,MAAA,CAAYa,KAAK,CAAG,CAAC,CACnFoC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAE4B,MAAM,CAAEnE,IAAI,CAACwB,GAAG,CAAE4C,OAAO,CAAEJ,WAAY,CAAC,CACjE,CAAC,CAAC,CACJ,CAAC,CAED9F,SAAS,CAAC,IAAM,CACd,GAAI8B,IAAI,SAAJA,IAAI,WAAJA,IAAI,CAAEwB,GAAG,EAAIvB,KAAK,CAAE,CACtBe,SAAS,CAACgB,OAAO,CAAG3D,EAAE,CAACQ,SAAS,CAAC,CAAC,CAAC,CACnCmC,SAAS,CAACgB,OAAO,CAACC,IAAI,CAAC,MAAM,CAAEjC,IAAI,CAACwB,GAAG,CAAC,CACxCR,SAAS,CAACgB,OAAO,CAACC,IAAI,CAAC,gBAAgB,CAAC,CACxCjB,SAAS,CAACgB,OAAO,CAACqC,EAAE,CAAC,aAAa,CAAGC,KAAK,EAAK,CAC7CnE,cAAc,CAACmE,KAAK,CAACC,MAAM,CAAEC,CAAM,EAAKA,CAAC,CAAChD,GAAG,GAAKxB,IAAI,CAACwB,GAAG,CAAC,CAAC,CAC9D,CAAC,CAAC,CACJ,CACA,MAAO,IAAM,KAAAiD,mBAAA,CACX,CAAAA,mBAAA,CAAAzD,SAAS,CAACgB,OAAO,UAAAyC,mBAAA,iBAAjBA,mBAAA,CAAmBC,UAAU,CAAC,CAAC,CAC/B1D,SAAS,CAACgB,OAAO,CAAG,IAAI,CAC1B,CAAC,CACH,CAAC,CAAE,CAAChC,IAAI,CAAEC,KAAK,CAAC,CAAC,CAEjB/B,SAAS,CAAC,IAAM,CACd,GAAIkC,aAAa,EAAIH,KAAK,CAAE,CAC1BiC,KAAK,IAAA9C,MAAA,CAAIP,SAAS,CAAC,CAAC,wBAAAO,MAAA,CAAsBgB,aAAa,CAACoB,GAAG,EAAI,CAC7DY,OAAO,CAAE,CAAE,eAAe,WAAAhD,MAAA,CAAYa,KAAK,CAAG,CAChD,CAAC,CAAC,CACC0E,IAAI,CAACpB,GAAG,EAAIA,GAAG,CAACqB,IAAI,CAAC,CAAC,CAAC,CACvBD,IAAI,CAACpE,WAAW,CAAC,CACtB,CACF,CAAC,CAAE,CAACH,aAAa,CAAEH,KAAK,CAAC,CAAC,CAE1B;AACA/B,SAAS,CAAC,IAAM,CACd,KAAM,CAAA2G,GAAG,CAAG,GAAI,CAAAC,GAAG,CAAS,CAAC,CAC7B,GAAInF,aAAa,CAAEkF,GAAG,CAACE,GAAG,CAACpF,aAAa,CAAC,CACzCW,QAAQ,CAAC0E,OAAO,CAACC,CAAC,EAAI,CAAE,GAAIA,CAAC,CAACnD,KAAK,CAAE+C,GAAG,CAACE,GAAG,CAACE,CAAC,CAACnD,KAAK,CAAC,CAAE,CAAC,CAAC,CACzD,KAAM,CAAAoD,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChC,KAAM,CAAAC,MAA8B,CAAG,CAAC,CAAC,CACzC,KAAM,CAAAC,OAAO,CAACC,GAAG,CAACC,KAAK,CAACC,IAAI,CAACV,GAAG,CAAC,CAACW,GAAG,CAAC,KAAM,CAAAjE,EAAE,EAAI,CAChD,GAAI,CACF,KAAM,CAAAgC,GAAG,CAAG,KAAM,CAAArB,KAAK,IAAA9C,MAAA,CAAIP,SAAS,CAAC,CAAC,eAAAO,MAAA,CAAamC,EAAE,EAAI,CACvDa,OAAO,CAAE,CAAE,eAAe,WAAAhD,MAAA,CAAYa,KAAK,CAAG,CAChD,CAAC,CAAC,CACF,GAAIsD,GAAG,CAACC,EAAE,CAAE,CACV,KAAM,CAAAiC,GAAG,CAAG,KAAM,CAAAlC,GAAG,CAACqB,IAAI,CAAC,CAAC,CAC5BO,MAAM,CAAC5D,EAAE,CAAC,CAAGkE,GAAG,CAACC,cAAc,CACjC,CACF,CAAE,MAAAC,OAAA,CAAM,CAAC,CACX,CAAC,CAAC,CAAC,CACHjG,eAAe,CAACyF,MAAM,CAAC,CACvB,GAAIxF,aAAa,CAAEH,oBAAoB,CAAC2F,MAAM,CAACxF,aAAa,CAAC,EAAI,IAAI,CAAC,CACxE,CAAC,CACD,GAAIM,KAAK,EAAI4E,GAAG,CAACe,IAAI,CAAG,CAAC,CAAEV,aAAa,CAAC,CAAC,CAC5C,CAAC,CAAE,CAACvF,aAAa,CAAEW,QAAQ,CAAEL,KAAK,CAAC,CAAC,CAEpC,KAAM,CAAA4F,iBAAiB,CAAG,KAAO,CAAA7B,WAAmB,EAAK,CACvD,GAAI,CAACA,WAAW,EAAI,CAAC/D,KAAK,CAAE,OAC5B,KAAM,CAAAsD,GAAG,CAAG,KAAM,CAAArB,KAAK,IAAA9C,MAAA,CAAIP,SAAS,CAAC,CAAC,2BAA0B,CAC9DsD,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAAkB,CAClC,eAAe,WAAAhD,MAAA,CAAYa,KAAK,CAClC,CAAC,CACDoC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAE4B,MAAM,CAAEnE,IAAI,CAACwB,GAAG,CAAEwC,WAAY,CAAC,CACxD,CAAC,CAAC,CACF,KAAM,CAAA8B,KAAK,CAAG,KAAM,CAAAvC,GAAG,CAACqB,IAAI,CAAC,CAAC,CAC9BvE,gBAAgB,CAACyF,KAAK,CAAC,CACzB,CAAC,CAED,mBACEpH,KAAA,QAAKqH,SAAS,CAAC,oBAAoB,CAACC,KAAK,CAAE,CAACC,QAAQ,CAAE,OAAO,CAAEC,KAAK,CAAE,MAAM,CAAEC,MAAM,CAAE,MAAM,CAAEC,OAAO,CAAE,MAAM,CAAEC,aAAa,CAAE,QAAQ,CAAEC,KAAK,CAAE,OAAO,CAAEC,QAAQ,CAAE,OAAO,CAAEC,MAAM,CAAE,MAAM,CAAEC,MAAM,CAAE,IAAI,CAAE,CAAAC,QAAA,eACvMlI,IAAA,WACEuH,SAAS,CAAC,oBAAoB,CAC9BY,OAAO,CAAEA,CAAA,GAAM1H,MAAM,CAAC2H,aAAa,CAAC,GAAI,CAAAC,WAAW,CAAC,gBAAgB,CAAC,CAAE,CACvEC,KAAK,CAAC,OAAO,CACb,aAAW,OAAO,CAClBC,IAAI,CAAC,QAAQ,CAAAL,QAAA,cAEbhI,KAAA,QAAK4H,KAAK,CAAC,IAAI,CAACE,MAAM,CAAC,IAAI,CAACQ,OAAO,CAAC,WAAW,CAACC,IAAI,CAAC,MAAM,CAACC,KAAK,CAAC,4BAA4B,CAAClB,KAAK,CAAE,CAACI,OAAO,CAAC,OAAO,CAACe,MAAM,CAAC,MAAM,CAAE,CAAAT,QAAA,eACpIlI,IAAA,WAAQ4I,EAAE,CAAC,GAAG,CAACC,EAAE,CAAC,GAAG,CAACC,CAAC,CAAC,GAAG,CAACL,IAAI,CAAC,SAAS,CAAC,CAAC,cAC5CzI,IAAA,SAAM+I,CAAC,CAAC,sCAAsC,CAACC,MAAM,CAAC,MAAM,CAACC,WAAW,CAAC,GAAG,CAACC,aAAa,CAAC,OAAO,CAAC,CAAC,EACjG,CAAC,CACA,CAAC,cACThJ,KAAA,QAAKqH,SAAS,CAAC,kBAAkB,CAACC,KAAK,CAAE,CAACM,KAAK,CAAE,MAAM,CAAEqB,QAAQ,CAAE,CAAC,CAAEpB,QAAQ,CAAE,MAAM,CAAEqB,YAAY,CAAE,mBAAmB,CAAE,CAAAlB,QAAA,eACzHhI,KAAA,QAAKqH,SAAS,CAAC,uBAAuB,CAAAW,QAAA,eACpClI,IAAA,MAAGwH,KAAK,CAAE,CAAE6B,QAAQ,CAAE,EAAE,CAAEC,KAAK,CAAE,SAAU,CAAE,CAAApB,QAAA,CAAC,cAAY,CAAG,CAAC,cAC9DhI,KAAA,OAAIsH,KAAK,CAAE,CAAE+B,SAAS,CAAE,MAAM,CAAEC,OAAO,CAAE,CAAC,CAAEC,SAAS,CAAE,EAAG,CAAE,CAAAvB,QAAA,EACzDxG,WAAW,CAACqE,MAAM,CAACC,CAAC,EAAI,CACvB,KAAM,CAAAjD,EAAE,CAAG,MAAO,CAAAiD,CAAC,GAAK,QAAQ,CAAGA,CAAC,CAAGA,CAAC,CAAChD,GAAG,CAC5C,MAAO,CAAA0G,MAAM,CAAC3G,EAAE,CAAC,GAAK2G,MAAM,CAAClI,IAAI,CAACwB,GAAG,CAAC,CACxC,CAAC,CAAC,CAAC2G,MAAM,GAAK,CAAC,eACb3J,IAAA,OAAIwH,KAAK,CAAE,CAAE8B,KAAK,CAAE,MAAM,CAAED,QAAQ,CAAE,EAAG,CAAE,CAAAnB,QAAA,CAAE3G,CAAC,CAAC,eAAe,CAAC,CAAK,CACrE,CACAG,WAAW,CAACqE,MAAM,CAACC,CAAC,EAAI,CACvB,KAAM,CAAAjD,EAAE,CAAG,MAAO,CAAAiD,CAAC,GAAK,QAAQ,CAAGA,CAAC,CAAGA,CAAC,CAAChD,GAAG,CAC5C,MAAO,CAAA0G,MAAM,CAAC3G,EAAE,CAAC,GAAK2G,MAAM,CAAClI,IAAI,CAACwB,GAAG,CAAC,CACxC,CAAC,CAAC,CAACgE,GAAG,CAAChB,CAAC,EAAI,CACV,GAAI,CAAA4D,WAAW,CAAG,EAAE,CACpB,GAAI,CAAAC,UAAU,CAAG,+BAA+B,CAChD,GAAI,MAAO,CAAA7D,CAAC,GAAK,QAAQ,CAAE,CACzB4D,WAAW,CAAG5D,CAAC,CACjB,CAAC,IAAM,IAAIA,CAAC,EAAI,MAAO,CAAAA,CAAC,GAAK,QAAQ,CAAE,CACrC4D,WAAW,CAAG5D,CAAC,CAAC8D,QAAQ,EAAI9D,CAAC,CAAChD,GAAG,EAAI,SAAS,CAC9C,GAAIgD,CAAC,CAAC+D,cAAc,CAAE,CACpBF,UAAU,IAAAjJ,MAAA,CAAMP,SAAS,CAAC,CAAC,EAAAO,MAAA,CAAGoF,CAAC,CAAC+D,cAAc,CAAE,CAClD,CACF,CACA,mBACE7J,KAAA,OAA4CqH,SAAS,CAAC,mBAAmB,CAAAW,QAAA,eACvElI,IAAA,SAAMuH,SAAS,CAAC,qBAAqB,CAACC,KAAK,CAAE,CAAEC,QAAQ,CAAE,UAAU,CAAEuC,IAAI,CAAE,CAAC,CAAEC,GAAG,CAAE,EAAG,CAAE,CAAE,CAAC,cAC3FjK,IAAA,QACEkK,GAAG,CAAEL,UAAW,CAChBM,GAAG,CAAEP,WAAY,CACjBpC,KAAK,CAAE,CAAEM,KAAK,CAAE,EAAE,CAAEE,MAAM,CAAE,EAAE,CAAEoC,YAAY,CAAE,KAAK,CAAEC,SAAS,CAAE,OAAO,CAAEC,MAAM,CAAE,gBAAgB,CAAEnB,QAAQ,CAAE,MAAM,CAAEM,SAAS,CAAE,MAAM,CAAE1B,QAAQ,CAAE,MAAM,CAAEwC,SAAS,CAAE,MAAM,CAAEC,WAAW,CAAE,CAAE,CAAE,CAC9LC,OAAO,CAAEhG,CAAC,EAAI,CAAGA,CAAC,CAACC,MAAM,CAAsBwF,GAAG,CAAG,+BAA+B,CAAE,CAAE,CACzF,CAAC,cACFlK,IAAA,WAAQuH,SAAS,CAAC,oBAAoB,CAACC,KAAK,CAAE,CAAE6B,QAAQ,CAAE,EAAE,CAAEqB,UAAU,CAAE,GAAG,CAAE/B,MAAM,CAAE,CAAC,CAAEa,OAAO,CAAE,CAAC,CAAEmB,UAAU,CAAE,MAAM,CAAEL,MAAM,CAAE,MAAM,CAAEhB,KAAK,CAAE,SAAS,CAAEsB,MAAM,CAAE,SAAU,CAAE,CAACzC,OAAO,CAAEA,CAAA,GAAMd,iBAAiB,CAAC,MAAO,CAAArB,CAAC,GAAK,QAAQ,CAAGA,CAAC,CAAGA,CAAC,CAAChD,GAAG,CAAE,CAAAkF,QAAA,CAAE0B,WAAW,CAAS,CAAC,GARrQ,MAAO,CAAA5D,CAAC,GAAK,QAAQ,CAAGA,CAAC,CAAGA,CAAC,CAAChD,GASnC,CAAC,CAET,CAAC,CAAC,EACA,CAAC,EACF,CAAC,cACNhD,IAAA,UACEuH,SAAS,CAAC,iBAAiB,CAC3BgB,IAAI,CAAC,MAAM,CACX5D,KAAK,CAAEtC,UAAW,CAClBwI,QAAQ,CAAEpG,CAAC,EAAInC,aAAa,CAACmC,CAAC,CAACC,MAAM,CAACC,KAAK,CAAE,CAC7CmG,WAAW,CAAEvJ,CAAC,CAAC,wBAAwB,CAAE,CAC1C,CAAC,EACC,CAAC,cACNrB,KAAA,QAAKqH,SAAS,CAAC,eAAe,CAACC,KAAK,CAAE,CAACuD,IAAI,CAAE,CAAC,CAAE5B,QAAQ,CAAE,CAAC,CAAEM,SAAS,CAAE,CAAC,CAAE7B,OAAO,CAAE,MAAM,CAAEC,aAAa,CAAE,QAAQ,CAAE8C,UAAU,CAAE,MAAM,CAAEK,SAAS,CAAE,MAAM,CAAE,CAAA9C,QAAA,EACzJtG,aAAa,eACZ1B,KAAA,CAAAE,SAAA,EAAA8H,QAAA,eACEhI,KAAA,QAAKqH,SAAS,CAAC,sBAAsB,CAAAW,QAAA,eACnClI,IAAA,WAAQuH,SAAS,CAAC,4BAA4B,CAACY,OAAO,CAAEtD,wBAAyB,CAAAqD,QAAA,CAAE3G,CAAC,CAAC,oBAAoB,CAAC,CAAS,CAAC,cACpHvB,IAAA,WAAQuH,SAAS,wBAAA3G,MAAA,CAAyBwE,SAAS,CAAG,SAAS,CAAG,OAAO,CAAG,CAAC+C,OAAO,CAAE1C,kBAAmB,CAAAyC,QAAA,CAAE9C,SAAS,CAAG7D,CAAC,CAAC,SAAS,CAAC,CAAGA,CAAC,CAAC,OAAO,CAAC,CAAS,CAAC,EACvJ,CAAC,cACNrB,KAAA,QAAKqH,SAAS,CAAC,mBAAmB,CAACC,KAAK,CAAE,CACxCuD,IAAI,CAAE,CAAC,CACPtB,SAAS,CAAE,CAAC,CACZc,SAAS,CAAE,MAAM,CACjBU,SAAS,CAAE,MAAM,CACjBrD,OAAO,CAAE,MAAM,CACfC,aAAa,CAAE,QAAQ,CACvB8C,UAAU,CAAE,SAAS,CACrBL,MAAM,CAAE,qBAAqB,CAC7BF,YAAY,CAAE,EAAE,CAChBc,YAAY,CAAE,EAAE,CAChBF,SAAS,CAAE,iCACb,CAAE,CAAA9C,QAAA,EACCpG,QAAQ,CAAC6H,MAAM,GAAK,CAAC,EAAIxI,aAAa,EAAIS,aAAa,eACtD1B,KAAA,QAAKqH,SAAS,CAAC,kBAAkB,CAAAW,QAAA,eAC/BlI,IAAA,SAAMuH,SAAS,CAAC,iBAAiB,CAAAW,QAAA,CAAE3G,CAAC,CAAC,iBAAiB,CAAC,CAAO,CAAC,CAE9D,CAAC,IAAM,CACN,KAAM,CAAA4J,OAAO,CAAGvJ,aAAa,CAACiB,YAAY,CAACC,IAAI,CAACC,EAAE,EAAIA,EAAE,GAAKvB,IAAI,CAACwB,GAAG,CAAC,CACtE,GAAI/B,YAAY,CAACE,aAAa,CAAC,GAAK,WAAW,EAAIgK,OAAO,GAAK3J,IAAI,CAACwB,GAAG,EAAI3B,eAAe,GAAK,KAAK,CAAE,CACpG,mBACEnB,KAAA,QAAKqH,SAAS,CAAC,2BAA2B,CAAAW,QAAA,eACxClI,IAAA,WAAQuH,SAAS,CAAC,6BAA6B,CAACY,OAAO,CAAEA,CAAA,GAAMrD,qBAAqB,CAAC3D,aAAa,CAAEE,eAAe,CAAE,CAAA6G,QAAA,CAAE3G,CAAC,CAAC,iBAAiB,CAAC,CAAS,CAAC,cACrJvB,IAAA,WAAQuH,SAAS,CAAC,4BAA4B,CAACY,OAAO,CAAEA,CAAA,GAAMjD,oBAAoB,CAAC/D,aAAa,CAAE,CAAA+G,QAAA,CAAE3G,CAAC,CAAC,gBAAgB,CAAC,CAAS,CAAC,EAC9H,CAAC,CAEV,CACA,MAAO,KAAI,CACb,CAAC,EAAE,CAAC,EACD,CACN,CACAO,QAAQ,CAACkF,GAAG,CAACoE,GAAG,eACflL,KAAA,QAEEqH,SAAS,oBAAA3G,MAAA,CAAqBY,IAAI,EAAI4J,GAAG,CAACjI,MAAM,GAAK3B,IAAI,CAACwB,GAAG,CAAG,OAAO,CAAG,EAAE,EAAApC,MAAA,CAAGwK,GAAG,CAACjI,MAAM,GAAK,IAAI,CAAG,SAAS,CAAG,EAAE,CAAG,CACtHqE,KAAK,CAAE4D,GAAG,CAACjI,MAAM,GAAK,IAAI,CAAG,CAAEkI,SAAS,CAAE,QAAQ,CAAE/B,KAAK,CAAE,MAAM,CAAEgC,SAAS,CAAE,QAAQ,CAAEX,UAAU,CAAE,SAAS,CAAEL,MAAM,CAAE,MAAM,CAAE3B,MAAM,CAAE,OAAQ,CAAC,CAAG,CAAC,CAAE,CAAAT,QAAA,eAEtJlI,IAAA,SAAMuH,SAAS,mBAAA3G,MAAA,CAAoBY,IAAI,EAAI4J,GAAG,CAACjI,MAAM,GAAK3B,IAAI,CAACwB,GAAG,CAAG,OAAO,CAAG,EAAE,CAAG,CAAAkF,QAAA,CAAEkD,GAAG,CAAChI,OAAO,CAAO,CAAC,CACxGgI,GAAG,CAAC/H,WAAW,GAAK,UAAU,EAAI+H,GAAG,CAAC9H,KAAK,EAAIrC,YAAY,CAACmK,GAAG,CAAC9H,KAAK,CAAC,GAAK,WAAW,EAAI8H,GAAG,CAACjI,MAAM,GAAK3B,IAAI,CAACwB,GAAG,eAChH9C,KAAA,QAAKqH,SAAS,CAAC,2BAA2B,CAAAW,QAAA,eACxClI,IAAA,WAAQuH,SAAS,CAAC,6BAA6B,CAACY,OAAO,CAAEA,CAAA,GAAMrD,qBAAqB,CAACsG,GAAG,CAAC9H,KAAK,CAAE8H,GAAG,CAAC7H,OAAO,CAAE,CAAA2E,QAAA,CAAE3G,CAAC,CAAC,iBAAiB,CAAC,CAAS,CAAC,cAC7IvB,IAAA,WAAQuH,SAAS,CAAC,4BAA4B,CAACY,OAAO,CAAEA,CAAA,GAAMjD,oBAAoB,CAACkG,GAAG,CAAC9H,KAAK,CAAE,CAAA4E,QAAA,CAAE3G,CAAC,CAAC,gBAAgB,CAAC,CAAS,CAAC,EAC1H,CACN,GAVI6J,GAAG,CAACpI,GAWN,CACN,CAAC,CACDd,MAAM,eAAIlC,IAAA,QAAKuH,SAAS,CAAC,iBAAiB,CAAAW,QAAA,CAAE3G,CAAC,CAAC,QAAQ,CAAC,CAAM,CAAC,EAC5D,CAAC,EACN,CACH,CACAK,aAAa,eACZ1B,KAAA,QAAKqH,SAAS,CAAC,oBAAoB,CAAAW,QAAA,eACjClI,IAAA,UACEuH,SAAS,CAAC,gBAAgB,CAC1BgB,IAAI,CAAC,MAAM,CACX5D,KAAK,CAAE3C,KAAM,CACb6I,QAAQ,CAAErG,iBAAkB,CAC5B+G,SAAS,CAAE9G,CAAC,EAAI,CAAE,GAAIA,CAAC,CAAC+G,GAAG,GAAK,OAAO,CAAE9I,WAAW,CAAC,CAAC,CAAE,CAAE,CAC1DoI,WAAW,CAAEvJ,CAAC,CAAC,wBAAwB,CAAC,EAAI,mBAAoB,CACjE,CAAC,cACFvB,IAAA,WACEuH,SAAS,CAAC,mBAAmB,CAC7BY,OAAO,CAAEzF,WAAY,CACrB+I,QAAQ,CAAE,CAACzJ,KAAK,CAAC0J,IAAI,CAAC,CAAE,CAAAxD,QAAA,CACxB3G,CAAC,CAAC,MAAM,CAAC,EAAI,MAAM,CAAS,CAAC,EAC5B,CACN,CACAY,YAAY,eACXnC,IAAA,QAAKuH,SAAS,CAAC,uBAAuB,CAAAW,QAAA,CAAE/F,YAAY,CAAM,CAC3D,EACE,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAArB,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}