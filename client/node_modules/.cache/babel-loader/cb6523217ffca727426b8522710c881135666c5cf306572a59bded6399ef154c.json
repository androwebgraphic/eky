{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/eky/client/src/components/ChatApp.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport io from 'socket.io-client';\nimport { useAuth } from '../contexts/AuthContext';\nimport '../css/chat-app.css';\nimport '../styles/chatAppNotification.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst getApiUrl = () => {\n  if (process.env.REACT_APP_API_URL) return process.env.REACT_APP_API_URL;\n  if (window.location.protocol === 'https:') {\n    return `https://${window.location.hostname}`;\n  }\n  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n    return `http://${window.location.hostname}:3001`;\n  }\n  return `http://172.20.10.2:3001`;\n};\nconst ChatApp = () => {\n  _s();\n  const {\n    t\n  } = useTranslation();\n  const {\n    user,\n    token\n  } = useAuth();\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const [selectedConvo, setSelectedConvo] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [typing, setTyping] = useState(false);\n  const [notification, setNotification] = useState(null);\n  const [userSearch, setUserSearch] = useState('');\n  const [searchResults, setSearchResults] = useState([]);\n  const socketRef = useRef(null);\n  const userWithBlocks = user;\n  useEffect(() => {\n    if (user !== null && user !== void 0 && user._id && token) {\n      socketRef.current = io(getApiUrl());\n      socketRef.current.emit('join', user._id);\n      socketRef.current.emit('getOnlineUsers');\n      socketRef.current.on('onlineUsers', users => {\n        setOnlineUsers(users.filter(u => u._id !== user._id));\n      });\n    }\n    return () => {\n      var _socketRef$current;\n      (_socketRef$current = socketRef.current) === null || _socketRef$current === void 0 ? void 0 : _socketRef$current.disconnect();\n      socketRef.current = null;\n    };\n  }, [user, token]);\n  useEffect(() => {\n    if (selectedConvo && token) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }).then(res => res.json()).then(setMessages);\n    }\n  }, [selectedConvo, token]);\n  const startConversation = async otherUserId => {\n    if (!otherUserId || !token) return;\n    const res = await fetch(`${getApiUrl()}/api/chat/conversation`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        userId: user._id,\n        otherUserId\n      })\n    });\n    const convo = await res.json();\n    setSelectedConvo(convo);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatApp, \"y6lQjjNGIEi4Eb22HSnbILhwiQE=\", false, function () {\n  return [useTranslation, useAuth];\n});\n_c = ChatApp;\nexport default ChatApp;\nvar _c;\n$RefreshReg$(_c, \"ChatApp\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useTranslation","io","useAuth","jsxDEV","_jsxDEV","getApiUrl","process","env","REACT_APP_API_URL","window","location","protocol","hostname","ChatApp","_s","t","user","token","onlineUsers","setOnlineUsers","selectedConvo","setSelectedConvo","messages","setMessages","input","setInput","typing","setTyping","notification","setNotification","userSearch","setUserSearch","searchResults","setSearchResults","socketRef","userWithBlocks","_id","current","emit","on","users","filter","u","_socketRef$current","disconnect","fetch","headers","then","res","json","startConversation","otherUserId","method","body","JSON","stringify","userId","convo","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Applications/MAMP/htdocs/eky/client/src/components/ChatApp.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport io from 'socket.io-client';\nimport { useAuth } from '../contexts/AuthContext';\nimport '../css/chat-app.css';\nimport '../styles/chatAppNotification.css';\n\ninterface UserWithBlocks {\n  _id: string;\n  blockedUsers?: string[];\n}\ninterface Message {\n  _id: string;\n  sender: string;\n  recipient: string;\n  message: string;\n  sentAt: string;\n}\ninterface Conversation {\n  _id: string;\n  participants: string[];\n}\nconst getApiUrl = () => {\n  if (process.env.REACT_APP_API_URL) return process.env.REACT_APP_API_URL;\n  if (window.location.protocol === 'https:') {\n    return `https://${window.location.hostname}`;\n  }\n  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n    return `http://${window.location.hostname}:3001`;\n  }\n  return `http://172.20.10.2:3001`;\n};\n\nconst ChatApp: React.FC = () => {\n  const { t } = useTranslation();\n  const { user, token } = useAuth();\n  const [onlineUsers, setOnlineUsers] = useState<{_id: string, userName: string, profilePicture?: string}[]>([]);\n  const [selectedConvo, setSelectedConvo] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  const [typing, setTyping] = useState(false);\n  const [notification, setNotification] = useState<string | null>(null);\n  const [userSearch, setUserSearch] = useState('');\n  const [searchResults, setSearchResults] = useState<{_id: string, userName: string}[]>([]);\n  const socketRef = useRef<ReturnType<typeof io> | null>(null);\n  const userWithBlocks = user as UserWithBlocks | null;\n\n  useEffect(() => {\n    if (user?._id && token) {\n      socketRef.current = io(getApiUrl());\n      socketRef.current.emit('join', user._id);\n      socketRef.current.emit('getOnlineUsers');\n      socketRef.current.on('onlineUsers', (users) => {\n        setOnlineUsers(users.filter((u: any) => u._id !== user._id));\n      });\n    }\n    return () => {\n      socketRef.current?.disconnect();\n      socketRef.current = null;\n    };\n  }, [user, token]);\n\n  useEffect(() => {\n    if (selectedConvo && token) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  }, [selectedConvo, token]);\n\n  const startConversation = async (otherUserId: string) => {\n    if (!otherUserId || !token) return;\n    const res = await fetch(`${getApiUrl()}/api/chat/conversation`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({ userId: user._id, otherUserId })\n    });\n    const convo = await res.json();\n    setSelectedConvo(convo);\n  };\n  \n  return (\n    <div>\n      {/* Your JSX code here */}\n    </div>\n  );\n}\n\nexport default ChatApp;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}