{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/eky/client/src/components/pages/EditDogModal.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef, useMemo } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\nimport { useAuth } from '../../contexts/AuthContext';\nimport '../../css/edit-modal.css';\nimport '../../css/editdog-visuals.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || '';\nconst getImageUrl = url => {\n  if (!url) return '';\n  if (/^https?:\\/\\//.test(url)) return url;\n  if (url.startsWith('/')) return API_URL + url;\n  // Try both /uploads/dogs/ and /u/dogs/ for compatibility\n  if (url.includes('/u/dogs/')) return API_URL + url;\n  return API_URL + '/uploads/dogs/' + url;\n};\n\n// Helper for fallback image\nconst fallbackDogImg = '/img/placeholder-dog.jpg';\nconst EditDogModal = ({\n  dog,\n  onClose,\n  onSave,\n  modalPosition,\n  isSingleDog\n}) => {\n  _s();\n  const {\n    t\n  } = useTranslation();\n  const {\n    token\n  } = useAuth();\n  const isMounted = useRef(true);\n  const [gender, setGender] = useState(dog.gender || '');\n  const [vaccinated, setVaccinated] = useState(!!dog.vaccinated);\n  const [neutered, setNeutered] = useState(!!dog.neutered);\n  const [mediaFiles, setMediaFiles] = useState([]);\n  const [mediaPreviews, setMediaPreviews] = useState([]);\n  const previewUrlsRef = useRef({});\n  const fileInputRef = useRef(null);\n  const [existingImages, setExistingImages] = useState(dog.images ? [...dog.images] : []);\n  const [selectedToDelete, setSelectedToDelete] = useState(new Set());\n  const [imageLoadErrors, setImageLoadErrors] = useState(new Set());\n  const [submitError, setSubmitError] = useState(null);\n  // Capture window size once on mount for stable modal layout\n  const [windowSize] = useState(() => ({\n    width: window.innerWidth,\n    height: window.innerHeight\n  }));\n  const {\n    handleSubmit,\n    setValue,\n    reset\n  } = useForm({\n    defaultValues: {\n      name: dog.name || '',\n      breed: dog.breed || '',\n      color: dog.color || '',\n      location: dog.location || '',\n      age: dog.age || undefined,\n      description: dog.description || '',\n      size: dog.size || '',\n      gender: dog.gender || '',\n      vaccinated: !!dog.vaccinated,\n      neutered: !!dog.neutered\n    }\n  });\n\n  // Only reset modal state if the dog ID changes (not on every prop update)\n  const prevDogId = useRef(dog._id);\n  useEffect(() => {\n    isMounted.current = true;\n    if (prevDogId.current !== dog._id) {\n      console.log('[EditDogModal] useEffect: dog._id changed', dog._id);\n      reset({\n        name: dog.name || '',\n        breed: dog.breed || '',\n        color: dog.color || '',\n        location: dog.location || '',\n        age: dog.age || undefined,\n        description: dog.description || '',\n        size: dog.size || '',\n        gender: dog.gender || '',\n        vaccinated: !!dog.vaccinated,\n        neutered: !!dog.neutered\n      });\n      setExistingImages(dog.images ? [...dog.images] : []);\n      setMediaFiles([]);\n      setMediaPreviews([]);\n      setSelectedToDelete(new Set());\n      prevDogId.current = dog._id;\n    } else {\n      // Always update images if length or URLs differ\n      const urls = (arr = []) => arr.map(img => img.url).join(',');\n      const dogUrls = urls(dog.images);\n      const existingUrls = urls(existingImages);\n      if (dog.images && existingImages && (dog.images.length !== existingImages.length || dogUrls !== existingUrls)) {\n        setExistingImages([...dog.images]);\n        console.log('[EditDogModal] useEffect: images updated', {\n          dogImages: dog.images,\n          existingImages\n        });\n      } else {\n        console.log('[EditDogModal] useEffect: images NOT updated', {\n          dogImages: dog.images,\n          existingImages\n        });\n      }\n    }\n    return () => {\n      isMounted.current = false;\n    };\n  }, [dog, dog.images, setValue, reset]);\n  const onSubmit = async fields => {\n    setSubmitError(null);\n    try {\n      if (!isMounted.current) return;\n      let resp;\n      // Always send all fields, including unchecked checkboxes and empty fields\n      const allKeys = ['name', 'breed', 'color', 'location', 'age', 'description', 'size', 'gender', 'vaccinated', 'neutered'];\n      // Always send correct keepImages (after deletions)\n      const keepImagesArr = existingImages.map(img => img.url);\n      const hasNewFiles = mediaFiles.length > 0;\n      const hasRemovedImages = keepImagesArr.length !== (dog.images ? dog.images.length : 0);\n      const hasPhotoChanges = hasNewFiles || hasRemovedImages;\n      console.log('[EditDogModal] onSubmit', {\n        fields,\n        keepImagesArr,\n        hasNewFiles,\n        hasRemovedImages,\n        hasPhotoChanges,\n        existingImages,\n        mediaFiles\n      });\n      if (hasPhotoChanges) {\n        const formData = new FormData();\n        allKeys.forEach(k => {\n          let v = fields[k];\n          // Always send as string, even for 0, false, or empty\n          if (k === 'vaccinated' || k === 'neutered') {\n            formData.append(k, v ? 'true' : 'false');\n          } else if (typeof v === 'number') {\n            formData.append(k, String(v));\n          } else if (typeof v === 'boolean') {\n            formData.append(k, v ? 'true' : 'false');\n          } else if (typeof v !== 'undefined' && v !== null) {\n            formData.append(k, String(v));\n          } else {\n            formData.append(k, '');\n          }\n        });\n        formData.append('keepImages', JSON.stringify(keepImagesArr));\n        mediaFiles.forEach((file, idx) => {\n          formData.append('media', file, file.name);\n        });\n        const headers = {};\n        if (token) headers['Authorization'] = `Bearer ${token}`;\n        try {\n          resp = await fetch(`${API_URL}/api/dogs/${dog._id}`, {\n            method: 'PATCH',\n            body: formData,\n            headers\n          });\n          // Debug log for upload response\n          if (!resp.ok) {\n            const errText = await resp.text();\n            console.error('[UPLOAD ERROR] PATCH /api/dogs/:id failed:', errText);\n          } else {\n            const respText = await resp.clone().text();\n            console.log('[UPLOAD SUCCESS] PATCH /api/dogs/:id response:', respText);\n          }\n        } catch (fetchErr) {\n          if (isMounted.current) {\n            console.error('[UPLOAD ERROR] Network or fetch failed:', fetchErr);\n          }\n          return;\n        }\n      } else {\n        const bodyData = {};\n        allKeys.forEach(k => {\n          let v = fields[k];\n          if (k === 'vaccinated' || k === 'neutered') {\n            bodyData[k] = v ? true : false;\n          } else if (typeof v !== 'undefined' && v !== null) {\n            bodyData[k] = v;\n          } else {\n            bodyData[k] = '';\n          }\n        });\n        // Always include keepImages in JSON PATCH\n        bodyData.keepImages = existingImages.map(img => img.url);\n        const headers = {\n          'Content-Type': 'application/json'\n        };\n        if (token) headers['Authorization'] = `Bearer ${token}`;\n        resp = await fetch(`${API_URL}/api/dogs/${dog._id}`, {\n          method: 'PATCH',\n          headers,\n          body: JSON.stringify(bodyData)\n        });\n      }\n      if (!resp.ok) {\n        const errData = await resp.json().catch(() => ({}));\n        setSubmitError(errData.message || 'Failed to update dog');\n        throw new Error(errData.message || 'Failed to update dog');\n      }\n      // Always fetch the latest dog data after update (not just PATCH response)\n      let updatedDog = null;\n      let respText = '';\n      try {\n        respText = await resp.clone().text();\n        const respData = JSON.parse(respText);\n        updatedDog = respData.dog || respData;\n        console.log('[EditDogModal] PATCH response JSON:', respData);\n      } catch (e) {\n        updatedDog = null;\n        console.warn('[EditDogModal] PATCH response not valid JSON:', respText);\n      }\n      // Defensive: fetch latest from backend in case PATCH response is stale\n      if (updatedDog && updatedDog._id) {\n        try {\n          const latestResp = await fetch(`${API_URL}/api/dogs/${updatedDog._id}`);\n          if (latestResp.ok) {\n            updatedDog = await latestResp.json();\n          }\n        } catch {}\n      }\n      if (isMounted.current && updatedDog) {\n        // If images are missing, fetch latest dog data from backend\n        let dogToShow = updatedDog;\n        if (!updatedDog.images || updatedDog.images.length === 0) {\n          try {\n            const resp = await fetch(`${API_URL}/api/dogs/${updatedDog._id}`);\n            if (resp.ok) {\n              dogToShow = await resp.json();\n            }\n          } catch {}\n        }\n        // Debug: log all image URLs and dogToShow after upload\n        if (dogToShow.images && dogToShow.images.length > 0) {\n          console.log('[UI DEBUG] Images after upload:', dogToShow.images.map(img => img.url));\n        } else {\n          console.warn('[UI DEBUG] No images found after upload. dogToShow:', dogToShow);\n        }\n        // Update modal state directly so images show instantly\n        setExistingImages(dogToShow.images ? [...dogToShow.images] : []);\n        setMediaFiles([]);\n        setMediaPreviews([]);\n        // Do NOT reset modal or rely on parent for images\n        console.log('[EditDogModal] onSubmit: calling onSave with dogToShow', dogToShow);\n        onSave(dogToShow); // Still notify parent\n      }\n    } catch (err) {\n      if (!isMounted.current) return;\n      if (mediaFiles.length > 0 && (err.message === 'Failed to fetch' || err.message === 'NetworkError when attempting to fetch resource.')) {\n        setSubmitError('Failed to upload images. Please check your connection or try again.');\n      } else {\n        setSubmitError(err.message || 'Failed to update dog');\n      }\n      console.error('[EditDogModal] onSubmit error', err);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"edit-modal-overlay\",\n    style: {\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      width: '100vw',\n      height: '100vh',\n      backgroundColor: 'rgba(0, 0, 0, 0.8)',\n      zIndex: 2147483647,\n      display: 'flex',\n      alignItems: windowSize.width > 768 ? 'center' : 'stretch',\n      justifyContent: 'center',\n      padding: windowSize.width > 768 ? '2rem' : '0',\n      boxSizing: 'border-box'\n    },\n    onClick: e => {\n      if (e.target === e.currentTarget) {\n        onClose();\n      }\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        backgroundColor: 'white',\n        borderRadius: windowSize.width > 768 ? isSingleDog ? '16px' : '12px' : '0',\n        padding: isSingleDog ? '0.2rem 0.4rem' : '1.5rem',\n        paddingTop: windowSize.width > 768 ? isSingleDog ? '0.2rem' : '1.5rem' : '3.5rem',\n        paddingBottom: windowSize.width > 768 ? isSingleDog ? '0.2rem' : '1.5rem' : '6rem',\n        width: windowSize.width > 768 ? isSingleDog ? '180px' : '100%' : '100vw',\n        height: windowSize.width > 768 ? isSingleDog ? 'auto' : '90vh' : '100vh',\n        maxWidth: windowSize.width > 768 ? isSingleDog ? '180px' : '600px' : '100vw',\n        maxHeight: windowSize.width > 768 ? isSingleDog ? '28vh' : '90vh' : '100vh',\n        minHeight: windowSize.width > 768 && isSingleDog ? 'unset' : undefined,\n        overflowY: 'auto',\n        WebkitOverflowScrolling: 'touch',\n        position: 'relative',\n        zIndex: 2147483647,\n        boxShadow: isSingleDog && windowSize.width > 768 ? '0 2px 16px rgba(0,0,0,0.10)' : undefined,\n        transition: 'all 0.2s cubic-bezier(.4,2,.6,1)'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"editdog-close-btn\",\n        onClick: onClose,\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          marginBottom: isSingleDog ? '0.3rem' : '1rem',\n          fontSize: isSingleDog ? '1.05rem' : undefined,\n          fontWeight: isSingleDog ? 500 : undefined,\n          position: 'static',\n          backgroundColor: 'white',\n          zIndex: 100,\n          paddingTop: 0\n        },\n        children: t('editdog.title', {\n          name: dog.name\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 9\n      }, this), submitError && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: '#e74c3c',\n          fontWeight: 500,\n          marginBottom: 12,\n          textAlign: 'center'\n        },\n        children: submitError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(onSubmit),\n        style: {\n          display: 'flex',\n          flexDirection: 'column',\n          gap: isSingleDog ? '0.4rem' : '1rem',\n          fontSize: isSingleDog ? '0.95rem' : undefined\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: t('adddog.name')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"name\",\n          defaultValue: dog.name || '',\n          onChange: e => setValue('name', e.target.value),\n          required: true,\n          style: {\n            padding: isSingleDog ? '0.25rem' : '0.5rem',\n            borderRadius: 6,\n            border: '1px solid #ccc',\n            fontSize: isSingleDog ? '0.95rem' : undefined\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          children: t('adddog.breed')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"breed\",\n          defaultValue: dog.breed || '',\n          onChange: e => setValue('breed', e.target.value),\n          style: {\n            padding: isSingleDog ? '0.25rem' : '0.5rem',\n            borderRadius: 6,\n            border: '1px solid #ccc',\n            fontSize: isSingleDog ? '0.95rem' : undefined\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          children: t('adddog.color')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 353,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"color\",\n          defaultValue: dog.color || '',\n          onChange: e => setValue('color', e.target.value),\n          style: {\n            padding: isSingleDog ? '0.25rem' : '0.5rem',\n            borderRadius: 6,\n            border: '1px solid #ccc',\n            fontSize: isSingleDog ? '0.95rem' : undefined\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          children: t('adddog.location')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"location\",\n          defaultValue: dog.location || '',\n          onChange: e => setValue('location', e.target.value),\n          style: {\n            padding: isSingleDog ? '0.25rem' : '0.5rem',\n            borderRadius: 6,\n            border: '1px solid #ccc',\n            fontSize: isSingleDog ? '0.95rem' : undefined\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 363,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          style: {\n            fontSize: '1.1rem',\n            fontWeight: 500\n          },\n          children: t('adddog.gender').replace('adddog.', '')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: 24,\n            alignItems: 'center',\n            marginBottom: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: `editdog-radio-label${gender === 'male' ? ' selected' : ''}`,\n            style: {\n              fontSize: '1.1rem',\n              fontWeight: 500\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"radio\",\n              name: \"gender\",\n              className: \"editdog-radio\",\n              checked: gender === 'male',\n              onChange: () => {\n                setValue('gender', 'male');\n                setGender('male');\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 373,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"editdog-radio-custom\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 380,\n              columnNumber: 15\n            }, this), t('adddog.male').replace('adddog.', '')]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: `editdog-radio-label${gender === 'female' ? ' selected' : ''}`,\n            style: {\n              fontSize: '1.1rem',\n              fontWeight: 500\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"radio\",\n              name: \"gender\",\n              className: \"editdog-radio\",\n              checked: gender === 'female',\n              onChange: () => {\n                setValue('gender', 'female');\n                setGender('female');\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"editdog-radio-custom\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 391,\n              columnNumber: 15\n            }, this), t('adddog.female').replace('adddog.', '')]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: 24,\n            alignItems: 'center',\n            marginBottom: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: `editdog-checkbox-label${vaccinated ? ' selected' : ''}`,\n            style: {\n              fontSize: '1.1rem',\n              fontWeight: 500\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              name: \"vaccinated\",\n              className: \"editdog-checkbox\",\n              checked: vaccinated,\n              onChange: e => {\n                setValue('vaccinated', e.target.checked);\n                setVaccinated(e.target.checked);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 398,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"editdog-checkbox-custom\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 15\n            }, this), t('adddog.vaccinated').replace('adddog.', '')]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: `editdog-checkbox-label${neutered ? ' selected' : ''}`,\n            style: {\n              fontSize: '1.1rem',\n              fontWeight: 500\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              name: \"neutered\",\n              className: \"editdog-checkbox\",\n              checked: neutered,\n              onChange: e => {\n                setValue('neutered', e.target.checked);\n                setNeutered(e.target.checked);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 409,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"editdog-checkbox-custom\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 416,\n              columnNumber: 15\n            }, this), t('adddog.neutered').replace('adddog.', '')]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 408,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          children: t('adddog.description')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 421,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          name: \"description\",\n          defaultValue: dog.description || '',\n          onChange: e => setValue('description', e.target.value),\n          rows: isSingleDog ? 2 : 3,\n          style: {\n            padding: isSingleDog ? '0.18rem' : '0.5rem',\n            borderRadius: 6,\n            border: '1px solid #ccc',\n            resize: 'vertical',\n            fontSize: isSingleDog ? '0.95rem' : undefined\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          children: t('adddog.media')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"media-input-row\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: 'relative',\n              width: '100%'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              id: \"editdog-media\",\n              name: \"media\",\n              type: \"file\",\n              accept: \"image/*\",\n              multiple: true,\n              ref: fileInputRef,\n              onChange: e => {\n                const files = Array.from(e.target.files || []);\n                setMediaFiles(prev => {\n                  const existingNames = new Set(prev.map(f => f.name));\n                  const newFiles = files.filter(f => !existingNames.has(f.name));\n                  newFiles.forEach(f => {\n                    if (!previewUrlsRef.current[f.name]) {\n                      previewUrlsRef.current[f.name] = URL.createObjectURL(f);\n                    }\n                  });\n                  setMediaPreviews(prevPreviews => [...prevPreviews, ...newFiles.map(f => ({\n                    name: f.name,\n                    url: previewUrlsRef.current[f.name]\n                  }))]);\n                  // Reset file input value so the same file can be selected again\n                  if (fileInputRef.current) fileInputRef.current.value = '';\n                  return [...prev, ...newFiles];\n                });\n              },\n              style: {\n                marginBottom: 8\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 434,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                position: 'relative',\n                height: 260,\n                minHeight: 220,\n                maxHeight: 300,\n                width: '100%',\n                overflow: 'hidden'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                onClick: () => {\n                  setMediaFiles([]);\n                  setMediaPreviews([]);\n                  // Revoke all object URLs\n                  Object.values(previewUrlsRef.current).forEach(url => URL.revokeObjectURL(url));\n                  previewUrlsRef.current = {};\n                  // Reset file input value\n                  if (fileInputRef.current) fileInputRef.current.value = '';\n                },\n                className: \"editdog-reset-photos-btn\",\n                style: {\n                  position: 'absolute',\n                  top: 8,\n                  right: 8,\n                  zIndex: 10,\n                  visibility: mediaPreviews.length > 0 ? 'visible' : 'hidden'\n                },\n                tabIndex: mediaPreviews.length > 0 ? 0 : -1,\n                \"aria-hidden\": mediaPreviews.length === 0,\n                children: t('editdog.resetPhotos').replace('editdog.', '').replace('adddog.', '')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 464,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  height: 210,\n                  width: '100%',\n                  overflow: 'hidden',\n                  display: 'flex',\n                  flexDirection: 'column',\n                  alignItems: 'center',\n                  justifyContent: 'center'\n                },\n                children: [mediaPreviews.length === 0 && existingImages.length === 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n                  style: {\n                    margin: 0,\n                    color: '#b0b0b0',\n                    fontSize: '1rem',\n                    fontWeight: 500,\n                    height: 24,\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    role: \"img\",\n                    \"aria-label\": \"media\",\n                    children: \"\\uD83D\\uDCF7\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 485,\n                    columnNumber: 23\n                  }, this), \" \", t('editdog.noPhotos').replace('editdog.', '').replace('adddog.', '')]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 484,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"media-preview-list-wrapper\",\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"media-preview-list\",\n                    children: [(() => {\n                      console.log('[EditDogModal] RENDER IMAGES', {\n                        existingImages,\n                        dogImages: dog.images\n                      });\n                      return null;\n                    })(), useMemo(() => {\n                      if (mediaPreviews.length > 0) {\n                        return mediaPreviews.map(preview => /*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            position: 'relative',\n                            width: 80,\n                            height: 80\n                          },\n                          children: /*#__PURE__*/_jsxDEV(\"img\", {\n                            src: preview.url,\n                            alt: `preview-${preview.name}`,\n                            width: 80,\n                            height: 80,\n                            style: {\n                              borderRadius: 8,\n                              objectFit: 'cover',\n                              height: 80,\n                              width: 80\n                            }\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 495,\n                            columnNumber: 31\n                          }, this)\n                        }, preview.name, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 494,\n                          columnNumber: 29\n                        }, this));\n                      } else if (existingImages.length > 0) {\n                        // Show all images in existingImages, no filtering by filename\n                        return existingImages.map((img, idx) => {\n                          if (!img.url) return null;\n                          let imgUrl = getImageUrl(img.url);\n                          if ((!imgUrl || imgUrl === '' || imgUrl === 'undefined') && !imageLoadErrors.has(idx)) {\n                            return /*#__PURE__*/_jsxDEV(\"div\", {\n                              style: {\n                                position: 'relative',\n                                width: 80,\n                                height: 80,\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center',\n                                background: '#f5f5f5',\n                                borderRadius: 8,\n                                color: '#bbb',\n                                fontSize: 32\n                              },\n                              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                                role: \"img\",\n                                \"aria-label\": \"no image\",\n                                children: \"\\uD83D\\uDCF7\"\n                              }, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 513,\n                                columnNumber: 37\n                              }, this)\n                            }, (img._id ? img._id : '') + '-' + idx, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 512,\n                              columnNumber: 35\n                            }, this);\n                          }\n                          if (imageLoadErrors.has(idx)) return null;\n                          const key = (img._id ? img._id : '') + '-' + idx;\n                          return /*#__PURE__*/_jsxDEV(\"div\", {\n                            style: {\n                              position: 'relative',\n                              width: 80,\n                              height: 80\n                            },\n                            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                              src: imgUrl,\n                              alt: \"Dog preview\",\n                              width: 80,\n                              height: 80,\n                              style: {\n                                borderRadius: 8,\n                                objectFit: 'cover',\n                                height: 80,\n                                width: 80,\n                                opacity: selectedToDelete.has(idx) ? 0.5 : 1,\n                                background: '#f5f5f5'\n                              },\n                              onError: () => setImageLoadErrors(prev => new Set(prev).add(idx))\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 521,\n                              columnNumber: 35\n                            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                              type: \"checkbox\",\n                              checked: selectedToDelete.has(idx),\n                              onChange: e => {\n                                setSelectedToDelete(prev => {\n                                  const next = new Set(prev);\n                                  if (e.target.checked) next.add(idx);else next.delete(idx);\n                                  return next;\n                                });\n                              },\n                              style: {\n                                position: 'absolute',\n                                top: 4,\n                                left: 4,\n                                zIndex: 3,\n                                width: 22,\n                                height: 22,\n                                accentColor: '#e74c3c',\n                                background: '#fff',\n                                border: '2px solid #e74c3c',\n                                borderRadius: 6,\n                                boxShadow: '0 2px 8px rgba(0,0,0,0.12)'\n                              },\n                              title: selectedToDelete.has(idx) ? t('editdog.selectedToDelete').replace('editdog.', '').replace('adddog.', '') : t('editdog.selectToDelete').replace('editdog.', '').replace('adddog.', '')\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 529,\n                              columnNumber: 35\n                            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                              type: \"button\",\n                              style: {\n                                position: 'absolute',\n                                top: 4,\n                                right: 4,\n                                background: '#e74c3c',\n                                color: '#fff',\n                                border: 'none',\n                                borderRadius: '50%',\n                                width: 22,\n                                height: 22,\n                                minWidth: 22,\n                                minHeight: 22,\n                                maxWidth: 22,\n                                maxHeight: 22,\n                                cursor: 'pointer',\n                                fontWeight: 'bold',\n                                fontSize: 16,\n                                lineHeight: '22px',\n                                padding: 0,\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center',\n                                boxShadow: '0 2px 8px rgba(0,0,0,0.12)'\n                              },\n                              onClick: () => {\n                                setExistingImages(existingImages.filter((_, i) => i !== idx));\n                                setSelectedToDelete(prev => {\n                                  const next = new Set(prev);\n                                  next.delete(idx);\n                                  // Shift all indices above idx down by 1\n                                  const shifted = new Set();\n                                  next.forEach(i => shifted.add(i > idx ? i - 1 : i));\n                                  return shifted;\n                                });\n                              },\n                              title: t('editdog.deleteThisImage').replace('editdog.', '').replace('adddog.', ''),\n                              children: \"\\xD7\"\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 543,\n                              columnNumber: 35\n                            }, this)]\n                          }, key, true, {\n                            fileName: _jsxFileName,\n                            lineNumber: 520,\n                            columnNumber: 33\n                          }, this);\n                        }).filter(Boolean);\n                      }\n                      return null;\n                    }, [mediaPreviews, existingImages, selectedToDelete, t])]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 489,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 488,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 482,\n                columnNumber: 17\n              }, this), mediaPreviews.length === 0 && existingImages.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: 'absolute',\n                  bottom: 0,\n                  left: 0,\n                  width: '100%',\n                  marginTop: 8,\n                  display: 'flex',\n                  gap: 8,\n                  background: 'white',\n                  zIndex: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  style: {\n                    background: '#e74c3c',\n                    color: '#fff',\n                    border: 'none',\n                    borderRadius: 6,\n                    padding: '0.5rem 1rem',\n                    cursor: 'pointer',\n                    fontWeight: 'bold'\n                  },\n                  disabled: selectedToDelete.size === 0,\n                  onClick: () => {\n                    setExistingImages(existingImages.filter((_, i) => !selectedToDelete.has(i)));\n                    setSelectedToDelete(new Set());\n                  },\n                  children: t('editdog.deleteSelected').replace('editdog.', '').replace('adddog.', '')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 574,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  style: {\n                    background: '#e67e22',\n                    color: '#fff',\n                    border: 'none',\n                    borderRadius: 6,\n                    padding: '0.5rem 1rem',\n                    cursor: 'pointer',\n                    fontWeight: 'bold'\n                  },\n                  onClick: () => {\n                    setExistingImages([]);\n                    setSelectedToDelete(new Set());\n                  },\n                  children: t('editdog.deleteAll').replace('editdog.', '').replace('adddog.', '')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 585,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 573,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 462,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 433,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'flex-end',\n            marginTop: isSingleDog ? 8 : 24,\n            position: isSingleDog && windowSize.width > 768 ? 'sticky' : 'static',\n            bottom: isSingleDog && windowSize.width > 768 ? 0 : undefined,\n            background: isSingleDog && windowSize.width > 768 ? 'white' : undefined,\n            zIndex: 10,\n            paddingBottom: isSingleDog && windowSize.width > 768 ? 4 : 0\n          },\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            style: {\n              background: '#3498db',\n              color: '#fff',\n              border: 'none',\n              borderRadius: 6,\n              padding: isSingleDog && windowSize.width > 768 ? '0.35rem 0.7rem' : '0.75rem 2rem',\n              fontWeight: 'bold',\n              fontSize: isSingleDog && windowSize.width > 768 ? '0.92rem' : '1.1rem',\n              cursor: 'pointer',\n              boxShadow: '0 2px 8px rgba(52,152,219,0.08)'\n            },\n            children: t('editdog.save').replace('editdog.', '').replace('adddog.', '') || 'Save'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 610,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 600,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 266,\n    columnNumber: 5\n  }, this);\n};\n_s(EditDogModal, \"w+HrTGkB2PVUFNU/V8Qdl6bu8Ok=\", false, function () {\n  return [useTranslation, useAuth, useForm];\n});\n_c = EditDogModal;\nexport default EditDogModal;\nvar _c;\n$RefreshReg$(_c, \"EditDogModal\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useMemo","useForm","useTranslation","useAuth","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","getImageUrl","url","test","startsWith","includes","fallbackDogImg","EditDogModal","dog","onClose","onSave","modalPosition","isSingleDog","_s","t","token","isMounted","gender","setGender","vaccinated","setVaccinated","neutered","setNeutered","mediaFiles","setMediaFiles","mediaPreviews","setMediaPreviews","previewUrlsRef","fileInputRef","existingImages","setExistingImages","images","selectedToDelete","setSelectedToDelete","Set","imageLoadErrors","setImageLoadErrors","submitError","setSubmitError","windowSize","width","window","innerWidth","height","innerHeight","handleSubmit","setValue","reset","defaultValues","name","breed","color","location","age","undefined","description","size","prevDogId","_id","current","console","log","urls","arr","map","img","join","dogUrls","existingUrls","length","dogImages","onSubmit","fields","resp","allKeys","keepImagesArr","hasNewFiles","hasRemovedImages","hasPhotoChanges","formData","FormData","forEach","k","v","append","String","JSON","stringify","file","idx","headers","fetch","method","body","ok","errText","text","error","respText","clone","fetchErr","bodyData","keepImages","errData","json","catch","message","Error","updatedDog","respData","parse","e","warn","latestResp","dogToShow","err","className","style","position","top","left","backgroundColor","zIndex","display","alignItems","justifyContent","padding","boxSizing","onClick","target","currentTarget","children","borderRadius","paddingTop","paddingBottom","maxWidth","maxHeight","minHeight","overflowY","WebkitOverflowScrolling","boxShadow","transition","fileName","_jsxFileName","lineNumber","columnNumber","marginBottom","fontSize","fontWeight","textAlign","flexDirection","gap","defaultValue","onChange","value","required","border","replace","type","checked","rows","resize","id","accept","multiple","ref","files","Array","from","prev","existingNames","f","newFiles","filter","has","URL","createObjectURL","prevPreviews","overflow","Object","values","revokeObjectURL","right","visibility","tabIndex","margin","role","preview","src","alt","objectFit","imgUrl","background","key","opacity","onError","add","next","delete","accentColor","title","minWidth","cursor","lineHeight","_","i","shifted","Boolean","bottom","marginTop","disabled","_c","$RefreshReg$"],"sources":["/Applications/MAMP/htdocs/eky/client/src/components/pages/EditDogModal.tsx"],"sourcesContent":["import React, { useEffect, useState, useRef, useMemo } from 'react';\nimport { useForm, SubmitHandler } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\nimport { useAuth } from '../../contexts/AuthContext';\nimport '../../css/edit-modal.css';\nimport '../../css/editdog-visuals.css';\n\n\ninterface EditDogFormData {\n  name: string;\n  breed?: string;\n  color?: string;\n  location?: string;\n  age?: number;\n  description?: string;\n  size?: string;\n  gender?: string;\n  vaccinated?: boolean;\n  neutered?: boolean;\n}\n\ntype DogImage = { url: string };\n\n\ninterface EditDogModalProps {\n  dog: any;\n  onClose: () => void;\n  onSave: (dog: any) => void;\n  modalPosition?: { x: number; y: number };\n  isSingleDog?: boolean; // If true, render smaller card/modal\n}\n\nconst API_URL = process.env.REACT_APP_API_URL || '';\n\n\nconst getImageUrl = (url: string) => {\n  if (!url) return '';\n  if (/^https?:\\/\\//.test(url)) return url;\n  if (url.startsWith('/')) return API_URL + url;\n  // Try both /uploads/dogs/ and /u/dogs/ for compatibility\n  if (url.includes('/u/dogs/')) return API_URL + url;\n  return API_URL + '/uploads/dogs/' + url;\n};\n\n// Helper for fallback image\nconst fallbackDogImg = '/img/placeholder-dog.jpg';\n\n\n\nconst EditDogModal = ({ dog, onClose, onSave, modalPosition, isSingleDog }: EditDogModalProps) => {\n  const { t } = useTranslation();\n  const { token } = useAuth();\n  const isMounted = useRef(true);\n  const [gender, setGender] = useState(dog.gender || '');\n  const [vaccinated, setVaccinated] = useState(!!dog.vaccinated);\n  const [neutered, setNeutered] = useState(!!dog.neutered);\n  const [mediaFiles, setMediaFiles] = useState<File[]>([]);\n  const [mediaPreviews, setMediaPreviews] = useState<{ name: string; url: string }[]>([]);\n  const previewUrlsRef = useRef<{ [name: string]: string }>({});\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const [existingImages, setExistingImages] = useState<DogImage[]>(dog.images ? [...dog.images] : []);\n  const [selectedToDelete, setSelectedToDelete] = useState<Set<number>>(new Set());\n  const [imageLoadErrors, setImageLoadErrors] = useState<Set<number>>(new Set());\n  const [submitError, setSubmitError] = useState<string | null>(null);\n  // Capture window size once on mount for stable modal layout\n  const [windowSize] = useState(() => ({ width: window.innerWidth, height: window.innerHeight }));\n\n  const { handleSubmit, setValue, reset } = useForm<EditDogFormData>({\n    defaultValues: {\n      name: dog.name || '',\n      breed: dog.breed || '',\n      color: dog.color || '',\n      location: dog.location || '',\n      age: dog.age || undefined,\n      description: dog.description || '',\n      size: dog.size || '',\n      gender: dog.gender || '',\n      vaccinated: !!dog.vaccinated,\n      neutered: !!dog.neutered,\n    }\n  });\n\n  // Only reset modal state if the dog ID changes (not on every prop update)\n  const prevDogId = useRef(dog._id);\n  useEffect(() => {\n    isMounted.current = true;\n    if (prevDogId.current !== dog._id) {\n      console.log('[EditDogModal] useEffect: dog._id changed', dog._id);\n      reset({\n        name: dog.name || '',\n        breed: dog.breed || '',\n        color: dog.color || '',\n        location: dog.location || '',\n        age: dog.age || undefined,\n        description: dog.description || '',\n        size: dog.size || '',\n        gender: dog.gender || '',\n        vaccinated: !!dog.vaccinated,\n        neutered: !!dog.neutered,\n      });\n      setExistingImages(dog.images ? [...dog.images] : []);\n      setMediaFiles([]);\n      setMediaPreviews([]);\n      setSelectedToDelete(new Set());\n      prevDogId.current = dog._id;\n    } else {\n      // Always update images if length or URLs differ\n      const urls = (arr: any[] = []) => arr.map(img => img.url).join(',');\n      const dogUrls = urls(dog.images);\n      const existingUrls = urls(existingImages);\n      if ((dog.images && existingImages && (dog.images.length !== existingImages.length || dogUrls !== existingUrls))) {\n        setExistingImages([...dog.images]);\n        console.log('[EditDogModal] useEffect: images updated', {dogImages: dog.images, existingImages});\n      } else {\n        console.log('[EditDogModal] useEffect: images NOT updated', {dogImages: dog.images, existingImages});\n      }\n    }\n    return () => {\n      isMounted.current = false;\n    };\n  }, [dog, dog.images, setValue, reset]);\n\n  const onSubmit: SubmitHandler<EditDogFormData> = async (fields) => {\n    setSubmitError(null);\n    try {\n      if (!isMounted.current) return;\n      let resp;\n      // Always send all fields, including unchecked checkboxes and empty fields\n      const allKeys = [\n        'name', 'breed', 'color', 'location', 'age', 'description', 'size', 'gender', 'vaccinated', 'neutered'\n      ];\n      // Always send correct keepImages (after deletions)\n      const keepImagesArr = existingImages.map(img => img.url);\n      const hasNewFiles = mediaFiles.length > 0;\n      const hasRemovedImages = keepImagesArr.length !== (dog.images ? dog.images.length : 0);\n      const hasPhotoChanges = hasNewFiles || hasRemovedImages;\n      console.log('[EditDogModal] onSubmit', { fields, keepImagesArr, hasNewFiles, hasRemovedImages, hasPhotoChanges, existingImages, mediaFiles });\n      if (hasPhotoChanges) {\n        const formData = new FormData();\n        allKeys.forEach(k => {\n          let v = fields[k as keyof EditDogFormData];\n          // Always send as string, even for 0, false, or empty\n          if (k === 'vaccinated' || k === 'neutered') {\n            formData.append(k, v ? 'true' : 'false');\n          } else if (typeof v === 'number') {\n            formData.append(k, String(v));\n          } else if (typeof v === 'boolean') {\n            formData.append(k, v ? 'true' : 'false');\n          } else if (typeof v !== 'undefined' && v !== null) {\n            formData.append(k, String(v));\n          } else {\n            formData.append(k, '');\n          }\n        });\n        formData.append('keepImages', JSON.stringify(keepImagesArr));\n        mediaFiles.forEach((file, idx) => {\n          formData.append('media', file, file.name);\n        });\n        const headers: any = {};\n        if (token) headers['Authorization'] = `Bearer ${token}`;\n        try {\n          resp = await fetch(`${API_URL}/api/dogs/${dog._id}`, {\n            method: 'PATCH',\n            body: formData,\n            headers\n          });\n          // Debug log for upload response\n          if (!resp.ok) {\n            const errText = await resp.text();\n            console.error('[UPLOAD ERROR] PATCH /api/dogs/:id failed:', errText);\n          } else {\n            const respText = await resp.clone().text();\n            console.log('[UPLOAD SUCCESS] PATCH /api/dogs/:id response:', respText);\n          }\n        } catch (fetchErr) {\n          if (isMounted.current) {\n            console.error('[UPLOAD ERROR] Network or fetch failed:', fetchErr);\n          }\n          return;\n        }\n      } else {\n        const bodyData: any = {};\n        allKeys.forEach(k => {\n          let v = fields[k as keyof EditDogFormData];\n          if (k === 'vaccinated' || k === 'neutered') {\n            bodyData[k] = v ? true : false;\n          } else if (typeof v !== 'undefined' && v !== null) {\n            bodyData[k] = v;\n          } else {\n            bodyData[k] = '';\n          }\n        });\n        // Always include keepImages in JSON PATCH\n        bodyData.keepImages = existingImages.map(img => img.url);\n        const headers: any = { 'Content-Type': 'application/json' };\n        if (token) headers['Authorization'] = `Bearer ${token}`;\n        resp = await fetch(`${API_URL}/api/dogs/${dog._id}`, {\n          method: 'PATCH',\n          headers,\n          body: JSON.stringify(bodyData)\n        });\n      }\n      if (!resp.ok) {\n        const errData = await resp.json().catch(() => ({}));\n        setSubmitError(errData.message || 'Failed to update dog');\n        throw new Error(errData.message || 'Failed to update dog');\n      }\n      // Always fetch the latest dog data after update (not just PATCH response)\n      let updatedDog = null;\n      let respText = '';\n      try {\n        respText = await resp.clone().text();\n        const respData = JSON.parse(respText);\n        updatedDog = respData.dog || respData;\n        console.log('[EditDogModal] PATCH response JSON:', respData);\n      } catch (e) {\n        updatedDog = null;\n        console.warn('[EditDogModal] PATCH response not valid JSON:', respText);\n      }\n      // Defensive: fetch latest from backend in case PATCH response is stale\n      if (updatedDog && updatedDog._id) {\n        try {\n          const latestResp = await fetch(`${API_URL}/api/dogs/${updatedDog._id}`);\n          if (latestResp.ok) {\n            updatedDog = await latestResp.json();\n          }\n        } catch {}\n      }\n      if (isMounted.current && updatedDog) {\n        // If images are missing, fetch latest dog data from backend\n        let dogToShow = updatedDog;\n        if (!updatedDog.images || updatedDog.images.length === 0) {\n          try {\n            const resp = await fetch(`${API_URL}/api/dogs/${updatedDog._id}`);\n            if (resp.ok) {\n              dogToShow = await resp.json();\n            }\n          } catch {}\n        }\n        // Debug: log all image URLs and dogToShow after upload\n        if (dogToShow.images && dogToShow.images.length > 0) {\n          console.log('[UI DEBUG] Images after upload:', dogToShow.images.map(img => img.url));\n        } else {\n          console.warn('[UI DEBUG] No images found after upload. dogToShow:', dogToShow);\n        }\n        // Update modal state directly so images show instantly\n        setExistingImages(dogToShow.images ? [...dogToShow.images] : []);\n        setMediaFiles([]);\n        setMediaPreviews([]);\n        // Do NOT reset modal or rely on parent for images\n        console.log('[EditDogModal] onSubmit: calling onSave with dogToShow', dogToShow);\n        onSave(dogToShow); // Still notify parent\n      }\n    } catch (err: any) {\n      if (!isMounted.current) return;\n      if (mediaFiles.length > 0 && (err.message === 'Failed to fetch' || err.message === 'NetworkError when attempting to fetch resource.')) {\n        setSubmitError('Failed to upload images. Please check your connection or try again.');\n      } else {\n        setSubmitError(err.message || 'Failed to update dog');\n      }\n      console.error('[EditDogModal] onSubmit error', err);\n    }\n  };\n\n  return (\n    <div \n      className=\"edit-modal-overlay\"\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        width: '100vw',\n        height: '100vh',\n        backgroundColor: 'rgba(0, 0, 0, 0.8)',\n        zIndex: 2147483647,\n        display: 'flex',\n        alignItems: windowSize.width > 768 ? 'center' : 'stretch',\n        justifyContent: 'center',\n        padding: windowSize.width > 768 ? '2rem' : '0',\n        boxSizing: 'border-box'\n      }}\n      onClick={(e) => {\n        if (e.target === e.currentTarget) {\n          onClose();\n        }\n      }}\n    >\n      <div \n        style={{\n          backgroundColor: 'white',\n          borderRadius: windowSize.width > 768 ? (isSingleDog ? '16px' : '12px') : '0',\n          padding: isSingleDog ? '0.2rem 0.4rem' : '1.5rem',\n          paddingTop: windowSize.width > 768 ? (isSingleDog ? '0.2rem' : '1.5rem') : '3.5rem',\n          paddingBottom: windowSize.width > 768 ? (isSingleDog ? '0.2rem' : '1.5rem') : '6rem',\n          width: windowSize.width > 768 ? (isSingleDog ? '180px' : '100%') : '100vw',\n          height: windowSize.width > 768 ? (isSingleDog ? 'auto' : '90vh') : '100vh',\n          maxWidth: windowSize.width > 768 ? (isSingleDog ? '180px' : '600px') : '100vw',\n          maxHeight: windowSize.width > 768 ? (isSingleDog ? '28vh' : '90vh') : '100vh',\n          minHeight: windowSize.width > 768 && isSingleDog ? 'unset' : undefined,\n          overflowY: 'auto',\n          WebkitOverflowScrolling: 'touch',\n          position: 'relative',\n          zIndex: 2147483647,\n          boxShadow: isSingleDog && windowSize.width > 768 ? '0 2px 16px rgba(0,0,0,0.10)' : undefined,\n          transition: 'all 0.2s cubic-bezier(.4,2,.6,1)',\n        }}\n      >\n        <button \n          className=\"editdog-close-btn\"\n          onClick={onClose}\n        >\n          &times;\n        </button>\n        <h2 style={{\n          marginBottom: isSingleDog ? '0.3rem' : '1rem',\n          fontSize: isSingleDog ? '1.05rem' : undefined,\n          fontWeight: isSingleDog ? 500 : undefined,\n          position: 'static',\n          backgroundColor: 'white',\n          zIndex: 100,\n          paddingTop: 0\n        }}>{t('editdog.title', { name: dog.name })}</h2>\n        {submitError && (\n          <div style={{ color: '#e74c3c', fontWeight: 500, marginBottom: 12, textAlign: 'center' }}>{submitError}</div>\n        )}\n        <form \n          onSubmit={handleSubmit(onSubmit)}\n          style={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: isSingleDog ? '0.4rem' : '1rem',\n            fontSize: isSingleDog ? '0.95rem' : undefined,\n          }}\n        >\n          {/* Dog fields */}\n          <label>{t('adddog.name')}</label>\n          <input\n            name=\"name\"\n            defaultValue={dog.name || ''}\n            onChange={e => setValue('name', e.target.value)}\n            required\n            style={{ padding: isSingleDog ? '0.25rem' : '0.5rem', borderRadius: 6, border: '1px solid #ccc', fontSize: isSingleDog ? '0.95rem' : undefined }}\n          />\n\n          <label>{t('adddog.breed')}</label>\n          <input\n            name=\"breed\"\n            defaultValue={dog.breed || ''}\n            onChange={e => setValue('breed', e.target.value)}\n            style={{ padding: isSingleDog ? '0.25rem' : '0.5rem', borderRadius: 6, border: '1px solid #ccc', fontSize: isSingleDog ? '0.95rem' : undefined }}\n          />\n\n          <label>{t('adddog.color')}</label>\n          <input\n            name=\"color\"\n            defaultValue={dog.color || ''}\n            onChange={e => setValue('color', e.target.value)}\n            style={{ padding: isSingleDog ? '0.25rem' : '0.5rem', borderRadius: 6, border: '1px solid #ccc', fontSize: isSingleDog ? '0.95rem' : undefined }}\n          />\n\n\n          <label>{t('adddog.location')}</label>\n          <input\n            name=\"location\"\n            defaultValue={dog.location || ''}\n            onChange={e => setValue('location', e.target.value)}\n            style={{ padding: isSingleDog ? '0.25rem' : '0.5rem', borderRadius: 6, border: '1px solid #ccc', fontSize: isSingleDog ? '0.95rem' : undefined }}\n          />\n\n          <label style={{ fontSize: '1.1rem', fontWeight: 500 }}>{t('adddog.gender').replace('adddog.', '')}</label>\n          <div style={{ display: 'flex', gap: 24, alignItems: 'center', marginBottom: 8 }}>\n            <label className={`editdog-radio-label${gender === 'male' ? ' selected' : ''}`} style={{ fontSize: '1.1rem', fontWeight: 500 }}>\n              <input\n                type=\"radio\"\n                name=\"gender\"\n                className=\"editdog-radio\"\n                checked={gender === 'male'}\n                onChange={() => { setValue('gender', 'male'); setGender('male'); }}\n              />\n              <span className=\"editdog-radio-custom\" />\n              {t('adddog.male').replace('adddog.', '')}\n            </label>\n            <label className={`editdog-radio-label${gender === 'female' ? ' selected' : ''}`} style={{ fontSize: '1.1rem', fontWeight: 500 }}>\n              <input\n                type=\"radio\"\n                name=\"gender\"\n                className=\"editdog-radio\"\n                checked={gender === 'female'}\n                onChange={() => { setValue('gender', 'female'); setGender('female'); }}\n              />\n              <span className=\"editdog-radio-custom\" />\n              {t('adddog.female').replace('adddog.', '')}\n            </label>\n          </div>\n\n          <div style={{ display: 'flex', gap: 24, alignItems: 'center', marginBottom: 8 }}>\n            <label className={`editdog-checkbox-label${vaccinated ? ' selected' : ''}`} style={{ fontSize: '1.1rem', fontWeight: 500 }}>\n              <input\n                type=\"checkbox\"\n                name=\"vaccinated\"\n                className=\"editdog-checkbox\"\n                checked={vaccinated}\n                onChange={e => { setValue('vaccinated', e.target.checked); setVaccinated(e.target.checked); }}\n              />\n              <span className=\"editdog-checkbox-custom\" />\n              {t('adddog.vaccinated').replace('adddog.', '')}\n            </label>\n            <label className={`editdog-checkbox-label${neutered ? ' selected' : ''}`} style={{ fontSize: '1.1rem', fontWeight: 500 }}>\n              <input\n                type=\"checkbox\"\n                name=\"neutered\"\n                className=\"editdog-checkbox\"\n                checked={neutered}\n                onChange={e => { setValue('neutered', e.target.checked); setNeutered(e.target.checked); }}\n              />\n              <span className=\"editdog-checkbox-custom\" />\n              {t('adddog.neutered').replace('adddog.', '')}\n            </label>\n          </div>\n\n          <label>{t('adddog.description')}</label>\n          <textarea\n            name=\"description\"\n            defaultValue={dog.description || ''}\n            onChange={e => setValue('description', e.target.value)}\n            rows={isSingleDog ? 2 : 3}\n            style={{ padding: isSingleDog ? '0.18rem' : '0.5rem', borderRadius: 6, border: '1px solid #ccc', resize: 'vertical', fontSize: isSingleDog ? '0.95rem' : undefined }}\n          />\n\n          {/* Media preview and upload */}\n          <label>{t('adddog.media')}</label>\n          <div className=\"media-input-row\">\n            <div style={{ position: 'relative', width: '100%' }}>\n                <input\n                id=\"editdog-media\"\n                name=\"media\"\n                type=\"file\"\n                accept=\"image/*\"\n                multiple\n                ref={fileInputRef}\n                onChange={e => {\n                  const files = Array.from(e.target.files || []);\n                  setMediaFiles(prev => {\n                    const existingNames = new Set(prev.map(f => f.name));\n                    const newFiles = files.filter(f => !existingNames.has(f.name));\n                    newFiles.forEach(f => {\n                      if (!previewUrlsRef.current[f.name]) {\n                        previewUrlsRef.current[f.name] = URL.createObjectURL(f);\n                      }\n                    });\n                    setMediaPreviews(prevPreviews => [\n                      ...prevPreviews,\n                      ...newFiles.map(f => ({ name: f.name, url: previewUrlsRef.current[f.name] }))\n                    ]);\n                    // Reset file input value so the same file can be selected again\n                    if (fileInputRef.current) fileInputRef.current.value = '';\n                    return [...prev, ...newFiles];\n                  });\n                }}\n                style={{ marginBottom: 8 }}\n              />\n              <div style={{ position: 'relative', height: 260, minHeight: 220, maxHeight: 300, width: '100%', overflow: 'hidden' }}>\n                {/* Always render the reset button, but hide it with visibility when not needed */}\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setMediaFiles([]);\n                    setMediaPreviews([]);\n                    // Revoke all object URLs\n                    Object.values(previewUrlsRef.current).forEach(url => URL.revokeObjectURL(url));\n                    previewUrlsRef.current = {};\n                    // Reset file input value\n                    if (fileInputRef.current) fileInputRef.current.value = '';\n                  }}\n                  className=\"editdog-reset-photos-btn\"\n                  style={{ position: 'absolute', top: 8, right: 8, zIndex: 10, visibility: mediaPreviews.length > 0 ? 'visible' : 'hidden' }}\n                  tabIndex={mediaPreviews.length > 0 ? 0 : -1}\n                  aria-hidden={mediaPreviews.length === 0}\n                >\n                  {t('editdog.resetPhotos').replace('editdog.', '').replace('adddog.', '')}\n                </button>\n                <div style={{ height: 210, width: '100%', overflow: 'hidden', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>\n                  {mediaPreviews.length === 0 && existingImages.length === 0 && (\n                    <p style={{ margin: 0, color: '#b0b0b0', fontSize: '1rem', fontWeight: 500, height: 24, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n                      <span role=\"img\" aria-label=\"media\"></span> {t('editdog.noPhotos').replace('editdog.', '').replace('adddog.', '')}\n                    </p>\n                  )}\n                  <div className=\"media-preview-list-wrapper\">\n                    <div className=\"media-preview-list\">\n                      {(() => { console.log('[EditDogModal] RENDER IMAGES', {existingImages, dogImages: dog.images}); return null; })()}\n                      {useMemo(() => {\n                        if (mediaPreviews.length > 0) {\n                          return mediaPreviews.map((preview) => (\n                            <div key={preview.name} style={{ position: 'relative', width: 80, height: 80 }}>\n                              <img\n                                src={preview.url}\n                                alt={`preview-${preview.name}`}\n                                width={80}\n                                height={80}\n                                style={{ borderRadius: 8, objectFit: 'cover', height: 80, width: 80 }}\n                              />\n                            </div>\n                          ));\n                        } else if (existingImages.length > 0) {\n                          // Show all images in existingImages, no filtering by filename\n                          return existingImages\n                            .map((img: any, idx: number) => {\n                              if (!img.url) return null;\n                              let imgUrl = getImageUrl(img.url);\n                              if ((!imgUrl || imgUrl === '' || imgUrl === 'undefined') && !imageLoadErrors.has(idx)) {\n                                return (\n                                  <div key={(img._id ? img._id : '') + '-' + idx} style={{ position: 'relative', width: 80, height: 80, display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#f5f5f5', borderRadius: 8, color: '#bbb', fontSize: 32 }}>\n                                    <span role=\"img\" aria-label=\"no image\"></span>\n                                  </div>\n                                );\n                              }\n                              if (imageLoadErrors.has(idx)) return null;\n                              const key = (img._id ? img._id : '') + '-' + idx;\n                              return (\n                                <div key={key} style={{ position: 'relative', width: 80, height: 80 }}>\n                                  <img\n                                    src={imgUrl}\n                                    alt=\"Dog preview\"\n                                    width={80}\n                                    height={80}\n                                    style={{ borderRadius: 8, objectFit: 'cover', height: 80, width: 80, opacity: selectedToDelete.has(idx) ? 0.5 : 1, background: '#f5f5f5' }}\n                                    onError={() => setImageLoadErrors(prev => new Set(prev).add(idx))}\n                                  />\n                                  <input\n                                    type=\"checkbox\"\n                                    checked={selectedToDelete.has(idx)}\n                                    onChange={e => {\n                                      setSelectedToDelete(prev => {\n                                        const next = new Set(prev);\n                                        if (e.target.checked) next.add(idx);\n                                        else next.delete(idx);\n                                        return next;\n                                      });\n                                    }}\n                                    style={{ position: 'absolute', top: 4, left: 4, zIndex: 3, width: 22, height: 22, accentColor: '#e74c3c', background: '#fff', border: '2px solid #e74c3c', borderRadius: 6, boxShadow: '0 2px 8px rgba(0,0,0,0.12)' }}\n                                    title={selectedToDelete.has(idx) ? t('editdog.selectedToDelete').replace('editdog.', '').replace('adddog.', '') : t('editdog.selectToDelete').replace('editdog.', '').replace('adddog.', '')}\n                                  />\n                                  <button\n                                    type=\"button\"\n                                    style={{ position: 'absolute', top: 4, right: 4, background: '#e74c3c', color: '#fff', border: 'none', borderRadius: '50%', width: 22, height: 22, minWidth: 22, minHeight: 22, maxWidth: 22, maxHeight: 22, cursor: 'pointer', fontWeight: 'bold', fontSize: 16, lineHeight: '22px', padding: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: '0 2px 8px rgba(0,0,0,0.12)' }}\n                                    onClick={() => {\n                                      setExistingImages(existingImages.filter((_, i) => i !== idx));\n                                      setSelectedToDelete(prev => {\n                                        const next = new Set(prev);\n                                        next.delete(idx);\n                                        // Shift all indices above idx down by 1\n                                        const shifted = new Set<number>();\n                                        next.forEach(i => shifted.add(i > idx ? i - 1 : i));\n                                        return shifted;\n                                      });\n                                    }}\n                                    title={t('editdog.deleteThisImage').replace('editdog.', '').replace('adddog.', '')}\n                                  >\n                                    &times;\n                                  </button>\n                                </div>\n                              );\n                            })\n                            .filter(Boolean);\n                        }\n                        return null;\n                      }, [mediaPreviews, existingImages, selectedToDelete, t])}\n                    </div>\n                  </div>\n                </div>\n              {/* Action buttons for deleting images, only for existing images and only if not showing new images */}\n              {mediaPreviews.length === 0 && existingImages.length > 0 && (\n                <div style={{ position: 'absolute', bottom: 0, left: 0, width: '100%', marginTop: 8, display: 'flex', gap: 8, background: 'white', zIndex: 2 }}>\n                  <button\n                    type=\"button\"\n                    style={{ background: '#e74c3c', color: '#fff', border: 'none', borderRadius: 6, padding: '0.5rem 1rem', cursor: 'pointer', fontWeight: 'bold' }}\n                    disabled={selectedToDelete.size === 0}\n                    onClick={() => {\n                      setExistingImages(existingImages.filter((_, i) => !selectedToDelete.has(i)));\n                      setSelectedToDelete(new Set());\n                    }}\n                  >\n                    {t('editdog.deleteSelected').replace('editdog.', '').replace('adddog.', '')}\n                  </button>\n                  <button\n                    type=\"button\"\n                    style={{ background: '#e67e22', color: '#fff', border: 'none', borderRadius: 6, padding: '0.5rem 1rem', cursor: 'pointer', fontWeight: 'bold' }}\n                    onClick={() => {\n                      setExistingImages([]);\n                      setSelectedToDelete(new Set());\n                    }}\n                  >\n                    {t('editdog.deleteAll').replace('editdog.', '').replace('adddog.', '')}\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n          </div>\n          <div style={{\n            display: 'flex',\n            justifyContent: 'flex-end',\n            marginTop: isSingleDog ? 8 : 24,\n            position: isSingleDog && windowSize.width > 768 ? 'sticky' : 'static',\n            bottom: isSingleDog && windowSize.width > 768 ? 0 : undefined,\n            background: isSingleDog && windowSize.width > 768 ? 'white' : undefined,\n            zIndex: 10,\n            paddingBottom: isSingleDog && windowSize.width > 768 ? 4 : 0\n          }}>\n            <button\n              type=\"submit\"\n              style={{\n                background: '#3498db',\n                color: '#fff',\n                border: 'none',\n                borderRadius: 6,\n                padding: isSingleDog && windowSize.width > 768 ? '0.35rem 0.7rem' : '0.75rem 2rem',\n                fontWeight: 'bold',\n                fontSize: isSingleDog && windowSize.width > 768 ? '0.92rem' : '1.1rem',\n                cursor: 'pointer',\n                boxShadow: '0 2px 8px rgba(52,152,219,0.08)'\n              }}\n            >\n              {t('editdog.save').replace('editdog.', '').replace('adddog.', '') || 'Save'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n\nexport default EditDogModal;\n\n\n\n\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,OAAO,QAAQ,OAAO;AACnE,SAASC,OAAO,QAAuB,iBAAiB;AACxD,SAASC,cAAc,QAAQ,eAAe;AAC9C,SAASC,OAAO,QAAQ,4BAA4B;AACpD,OAAO,0BAA0B;AACjC,OAAO,+BAA+B;AAAC,SAAAC,MAAA,IAAAC,OAAA;AA2BvC,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,EAAE;AAGnD,MAAMC,WAAW,GAAIC,GAAW,IAAK;EACnC,IAAI,CAACA,GAAG,EAAE,OAAO,EAAE;EACnB,IAAI,cAAc,CAACC,IAAI,CAACD,GAAG,CAAC,EAAE,OAAOA,GAAG;EACxC,IAAIA,GAAG,CAACE,UAAU,CAAC,GAAG,CAAC,EAAE,OAAOP,OAAO,GAAGK,GAAG;EAC7C;EACA,IAAIA,GAAG,CAACG,QAAQ,CAAC,UAAU,CAAC,EAAE,OAAOR,OAAO,GAAGK,GAAG;EAClD,OAAOL,OAAO,GAAG,gBAAgB,GAAGK,GAAG;AACzC,CAAC;;AAED;AACA,MAAMI,cAAc,GAAG,0BAA0B;AAIjD,MAAMC,YAAY,GAAGA,CAAC;EAAEC,GAAG;EAAEC,OAAO;EAAEC,MAAM;EAAEC,aAAa;EAAEC;AAA+B,CAAC,KAAK;EAAAC,EAAA;EAChG,MAAM;IAAEC;EAAE,CAAC,GAAGrB,cAAc,CAAC,CAAC;EAC9B,MAAM;IAAEsB;EAAM,CAAC,GAAGrB,OAAO,CAAC,CAAC;EAC3B,MAAMsB,SAAS,GAAG1B,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAM,CAAC2B,MAAM,EAAEC,SAAS,CAAC,GAAG7B,QAAQ,CAACmB,GAAG,CAACS,MAAM,IAAI,EAAE,CAAC;EACtD,MAAM,CAACE,UAAU,EAAEC,aAAa,CAAC,GAAG/B,QAAQ,CAAC,CAAC,CAACmB,GAAG,CAACW,UAAU,CAAC;EAC9D,MAAM,CAACE,QAAQ,EAAEC,WAAW,CAAC,GAAGjC,QAAQ,CAAC,CAAC,CAACmB,GAAG,CAACa,QAAQ,CAAC;EACxD,MAAM,CAACE,UAAU,EAAEC,aAAa,CAAC,GAAGnC,QAAQ,CAAS,EAAE,CAAC;EACxD,MAAM,CAACoC,aAAa,EAAEC,gBAAgB,CAAC,GAAGrC,QAAQ,CAAkC,EAAE,CAAC;EACvF,MAAMsC,cAAc,GAAGrC,MAAM,CAA6B,CAAC,CAAC,CAAC;EAC7D,MAAMsC,YAAY,GAAGtC,MAAM,CAA0B,IAAI,CAAC;EAC1D,MAAM,CAACuC,cAAc,EAAEC,iBAAiB,CAAC,GAAGzC,QAAQ,CAAamB,GAAG,CAACuB,MAAM,GAAG,CAAC,GAAGvB,GAAG,CAACuB,MAAM,CAAC,GAAG,EAAE,CAAC;EACnG,MAAM,CAACC,gBAAgB,EAAEC,mBAAmB,CAAC,GAAG5C,QAAQ,CAAc,IAAI6C,GAAG,CAAC,CAAC,CAAC;EAChF,MAAM,CAACC,eAAe,EAAEC,kBAAkB,CAAC,GAAG/C,QAAQ,CAAc,IAAI6C,GAAG,CAAC,CAAC,CAAC;EAC9E,MAAM,CAACG,WAAW,EAAEC,cAAc,CAAC,GAAGjD,QAAQ,CAAgB,IAAI,CAAC;EACnE;EACA,MAAM,CAACkD,UAAU,CAAC,GAAGlD,QAAQ,CAAC,OAAO;IAAEmD,KAAK,EAAEC,MAAM,CAACC,UAAU;IAAEC,MAAM,EAAEF,MAAM,CAACG;EAAY,CAAC,CAAC,CAAC;EAE/F,MAAM;IAAEC,YAAY;IAAEC,QAAQ;IAAEC;EAAM,CAAC,GAAGvD,OAAO,CAAkB;IACjEwD,aAAa,EAAE;MACbC,IAAI,EAAEzC,GAAG,CAACyC,IAAI,IAAI,EAAE;MACpBC,KAAK,EAAE1C,GAAG,CAAC0C,KAAK,IAAI,EAAE;MACtBC,KAAK,EAAE3C,GAAG,CAAC2C,KAAK,IAAI,EAAE;MACtBC,QAAQ,EAAE5C,GAAG,CAAC4C,QAAQ,IAAI,EAAE;MAC5BC,GAAG,EAAE7C,GAAG,CAAC6C,GAAG,IAAIC,SAAS;MACzBC,WAAW,EAAE/C,GAAG,CAAC+C,WAAW,IAAI,EAAE;MAClCC,IAAI,EAAEhD,GAAG,CAACgD,IAAI,IAAI,EAAE;MACpBvC,MAAM,EAAET,GAAG,CAACS,MAAM,IAAI,EAAE;MACxBE,UAAU,EAAE,CAAC,CAACX,GAAG,CAACW,UAAU;MAC5BE,QAAQ,EAAE,CAAC,CAACb,GAAG,CAACa;IAClB;EACF,CAAC,CAAC;;EAEF;EACA,MAAMoC,SAAS,GAAGnE,MAAM,CAACkB,GAAG,CAACkD,GAAG,CAAC;EACjCtE,SAAS,CAAC,MAAM;IACd4B,SAAS,CAAC2C,OAAO,GAAG,IAAI;IACxB,IAAIF,SAAS,CAACE,OAAO,KAAKnD,GAAG,CAACkD,GAAG,EAAE;MACjCE,OAAO,CAACC,GAAG,CAAC,2CAA2C,EAAErD,GAAG,CAACkD,GAAG,CAAC;MACjEX,KAAK,CAAC;QACJE,IAAI,EAAEzC,GAAG,CAACyC,IAAI,IAAI,EAAE;QACpBC,KAAK,EAAE1C,GAAG,CAAC0C,KAAK,IAAI,EAAE;QACtBC,KAAK,EAAE3C,GAAG,CAAC2C,KAAK,IAAI,EAAE;QACtBC,QAAQ,EAAE5C,GAAG,CAAC4C,QAAQ,IAAI,EAAE;QAC5BC,GAAG,EAAE7C,GAAG,CAAC6C,GAAG,IAAIC,SAAS;QACzBC,WAAW,EAAE/C,GAAG,CAAC+C,WAAW,IAAI,EAAE;QAClCC,IAAI,EAAEhD,GAAG,CAACgD,IAAI,IAAI,EAAE;QACpBvC,MAAM,EAAET,GAAG,CAACS,MAAM,IAAI,EAAE;QACxBE,UAAU,EAAE,CAAC,CAACX,GAAG,CAACW,UAAU;QAC5BE,QAAQ,EAAE,CAAC,CAACb,GAAG,CAACa;MAClB,CAAC,CAAC;MACFS,iBAAiB,CAACtB,GAAG,CAACuB,MAAM,GAAG,CAAC,GAAGvB,GAAG,CAACuB,MAAM,CAAC,GAAG,EAAE,CAAC;MACpDP,aAAa,CAAC,EAAE,CAAC;MACjBE,gBAAgB,CAAC,EAAE,CAAC;MACpBO,mBAAmB,CAAC,IAAIC,GAAG,CAAC,CAAC,CAAC;MAC9BuB,SAAS,CAACE,OAAO,GAAGnD,GAAG,CAACkD,GAAG;IAC7B,CAAC,MAAM;MACL;MACA,MAAMI,IAAI,GAAGA,CAACC,GAAU,GAAG,EAAE,KAAKA,GAAG,CAACC,GAAG,CAACC,GAAG,IAAIA,GAAG,CAAC/D,GAAG,CAAC,CAACgE,IAAI,CAAC,GAAG,CAAC;MACnE,MAAMC,OAAO,GAAGL,IAAI,CAACtD,GAAG,CAACuB,MAAM,CAAC;MAChC,MAAMqC,YAAY,GAAGN,IAAI,CAACjC,cAAc,CAAC;MACzC,IAAKrB,GAAG,CAACuB,MAAM,IAAIF,cAAc,KAAKrB,GAAG,CAACuB,MAAM,CAACsC,MAAM,KAAKxC,cAAc,CAACwC,MAAM,IAAIF,OAAO,KAAKC,YAAY,CAAC,EAAG;QAC/GtC,iBAAiB,CAAC,CAAC,GAAGtB,GAAG,CAACuB,MAAM,CAAC,CAAC;QAClC6B,OAAO,CAACC,GAAG,CAAC,0CAA0C,EAAE;UAACS,SAAS,EAAE9D,GAAG,CAACuB,MAAM;UAAEF;QAAc,CAAC,CAAC;MAClG,CAAC,MAAM;QACL+B,OAAO,CAACC,GAAG,CAAC,8CAA8C,EAAE;UAACS,SAAS,EAAE9D,GAAG,CAACuB,MAAM;UAAEF;QAAc,CAAC,CAAC;MACtG;IACF;IACA,OAAO,MAAM;MACXb,SAAS,CAAC2C,OAAO,GAAG,KAAK;IAC3B,CAAC;EACH,CAAC,EAAE,CAACnD,GAAG,EAAEA,GAAG,CAACuB,MAAM,EAAEe,QAAQ,EAAEC,KAAK,CAAC,CAAC;EAEtC,MAAMwB,QAAwC,GAAG,MAAOC,MAAM,IAAK;IACjElC,cAAc,CAAC,IAAI,CAAC;IACpB,IAAI;MACF,IAAI,CAACtB,SAAS,CAAC2C,OAAO,EAAE;MACxB,IAAIc,IAAI;MACR;MACA,MAAMC,OAAO,GAAG,CACd,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,KAAK,EAAE,aAAa,EAAE,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,UAAU,CACvG;MACD;MACA,MAAMC,aAAa,GAAG9C,cAAc,CAACmC,GAAG,CAACC,GAAG,IAAIA,GAAG,CAAC/D,GAAG,CAAC;MACxD,MAAM0E,WAAW,GAAGrD,UAAU,CAAC8C,MAAM,GAAG,CAAC;MACzC,MAAMQ,gBAAgB,GAAGF,aAAa,CAACN,MAAM,MAAM7D,GAAG,CAACuB,MAAM,GAAGvB,GAAG,CAACuB,MAAM,CAACsC,MAAM,GAAG,CAAC,CAAC;MACtF,MAAMS,eAAe,GAAGF,WAAW,IAAIC,gBAAgB;MACvDjB,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAE;QAAEW,MAAM;QAAEG,aAAa;QAAEC,WAAW;QAAEC,gBAAgB;QAAEC,eAAe;QAAEjD,cAAc;QAAEN;MAAW,CAAC,CAAC;MAC7I,IAAIuD,eAAe,EAAE;QACnB,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;QAC/BN,OAAO,CAACO,OAAO,CAACC,CAAC,IAAI;UACnB,IAAIC,CAAC,GAAGX,MAAM,CAACU,CAAC,CAA0B;UAC1C;UACA,IAAIA,CAAC,KAAK,YAAY,IAAIA,CAAC,KAAK,UAAU,EAAE;YAC1CH,QAAQ,CAACK,MAAM,CAACF,CAAC,EAAEC,CAAC,GAAG,MAAM,GAAG,OAAO,CAAC;UAC1C,CAAC,MAAM,IAAI,OAAOA,CAAC,KAAK,QAAQ,EAAE;YAChCJ,QAAQ,CAACK,MAAM,CAACF,CAAC,EAAEG,MAAM,CAACF,CAAC,CAAC,CAAC;UAC/B,CAAC,MAAM,IAAI,OAAOA,CAAC,KAAK,SAAS,EAAE;YACjCJ,QAAQ,CAACK,MAAM,CAACF,CAAC,EAAEC,CAAC,GAAG,MAAM,GAAG,OAAO,CAAC;UAC1C,CAAC,MAAM,IAAI,OAAOA,CAAC,KAAK,WAAW,IAAIA,CAAC,KAAK,IAAI,EAAE;YACjDJ,QAAQ,CAACK,MAAM,CAACF,CAAC,EAAEG,MAAM,CAACF,CAAC,CAAC,CAAC;UAC/B,CAAC,MAAM;YACLJ,QAAQ,CAACK,MAAM,CAACF,CAAC,EAAE,EAAE,CAAC;UACxB;QACF,CAAC,CAAC;QACFH,QAAQ,CAACK,MAAM,CAAC,YAAY,EAAEE,IAAI,CAACC,SAAS,CAACZ,aAAa,CAAC,CAAC;QAC5DpD,UAAU,CAAC0D,OAAO,CAAC,CAACO,IAAI,EAAEC,GAAG,KAAK;UAChCV,QAAQ,CAACK,MAAM,CAAC,OAAO,EAAEI,IAAI,EAAEA,IAAI,CAACvC,IAAI,CAAC;QAC3C,CAAC,CAAC;QACF,MAAMyC,OAAY,GAAG,CAAC,CAAC;QACvB,IAAI3E,KAAK,EAAE2E,OAAO,CAAC,eAAe,CAAC,GAAG,UAAU3E,KAAK,EAAE;QACvD,IAAI;UACF0D,IAAI,GAAG,MAAMkB,KAAK,CAAC,GAAG9F,OAAO,aAAaW,GAAG,CAACkD,GAAG,EAAE,EAAE;YACnDkC,MAAM,EAAE,OAAO;YACfC,IAAI,EAAEd,QAAQ;YACdW;UACF,CAAC,CAAC;UACF;UACA,IAAI,CAACjB,IAAI,CAACqB,EAAE,EAAE;YACZ,MAAMC,OAAO,GAAG,MAAMtB,IAAI,CAACuB,IAAI,CAAC,CAAC;YACjCpC,OAAO,CAACqC,KAAK,CAAC,4CAA4C,EAAEF,OAAO,CAAC;UACtE,CAAC,MAAM;YACL,MAAMG,QAAQ,GAAG,MAAMzB,IAAI,CAAC0B,KAAK,CAAC,CAAC,CAACH,IAAI,CAAC,CAAC;YAC1CpC,OAAO,CAACC,GAAG,CAAC,gDAAgD,EAAEqC,QAAQ,CAAC;UACzE;QACF,CAAC,CAAC,OAAOE,QAAQ,EAAE;UACjB,IAAIpF,SAAS,CAAC2C,OAAO,EAAE;YACrBC,OAAO,CAACqC,KAAK,CAAC,yCAAyC,EAAEG,QAAQ,CAAC;UACpE;UACA;QACF;MACF,CAAC,MAAM;QACL,MAAMC,QAAa,GAAG,CAAC,CAAC;QACxB3B,OAAO,CAACO,OAAO,CAACC,CAAC,IAAI;UACnB,IAAIC,CAAC,GAAGX,MAAM,CAACU,CAAC,CAA0B;UAC1C,IAAIA,CAAC,KAAK,YAAY,IAAIA,CAAC,KAAK,UAAU,EAAE;YAC1CmB,QAAQ,CAACnB,CAAC,CAAC,GAAGC,CAAC,GAAG,IAAI,GAAG,KAAK;UAChC,CAAC,MAAM,IAAI,OAAOA,CAAC,KAAK,WAAW,IAAIA,CAAC,KAAK,IAAI,EAAE;YACjDkB,QAAQ,CAACnB,CAAC,CAAC,GAAGC,CAAC;UACjB,CAAC,MAAM;YACLkB,QAAQ,CAACnB,CAAC,CAAC,GAAG,EAAE;UAClB;QACF,CAAC,CAAC;QACF;QACAmB,QAAQ,CAACC,UAAU,GAAGzE,cAAc,CAACmC,GAAG,CAACC,GAAG,IAAIA,GAAG,CAAC/D,GAAG,CAAC;QACxD,MAAMwF,OAAY,GAAG;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC3D,IAAI3E,KAAK,EAAE2E,OAAO,CAAC,eAAe,CAAC,GAAG,UAAU3E,KAAK,EAAE;QACvD0D,IAAI,GAAG,MAAMkB,KAAK,CAAC,GAAG9F,OAAO,aAAaW,GAAG,CAACkD,GAAG,EAAE,EAAE;UACnDkC,MAAM,EAAE,OAAO;UACfF,OAAO;UACPG,IAAI,EAAEP,IAAI,CAACC,SAAS,CAACc,QAAQ;QAC/B,CAAC,CAAC;MACJ;MACA,IAAI,CAAC5B,IAAI,CAACqB,EAAE,EAAE;QACZ,MAAMS,OAAO,GAAG,MAAM9B,IAAI,CAAC+B,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACnDnE,cAAc,CAACiE,OAAO,CAACG,OAAO,IAAI,sBAAsB,CAAC;QACzD,MAAM,IAAIC,KAAK,CAACJ,OAAO,CAACG,OAAO,IAAI,sBAAsB,CAAC;MAC5D;MACA;MACA,IAAIE,UAAU,GAAG,IAAI;MACrB,IAAIV,QAAQ,GAAG,EAAE;MACjB,IAAI;QACFA,QAAQ,GAAG,MAAMzB,IAAI,CAAC0B,KAAK,CAAC,CAAC,CAACH,IAAI,CAAC,CAAC;QACpC,MAAMa,QAAQ,GAAGvB,IAAI,CAACwB,KAAK,CAACZ,QAAQ,CAAC;QACrCU,UAAU,GAAGC,QAAQ,CAACrG,GAAG,IAAIqG,QAAQ;QACrCjD,OAAO,CAACC,GAAG,CAAC,qCAAqC,EAAEgD,QAAQ,CAAC;MAC9D,CAAC,CAAC,OAAOE,CAAC,EAAE;QACVH,UAAU,GAAG,IAAI;QACjBhD,OAAO,CAACoD,IAAI,CAAC,+CAA+C,EAAEd,QAAQ,CAAC;MACzE;MACA;MACA,IAAIU,UAAU,IAAIA,UAAU,CAAClD,GAAG,EAAE;QAChC,IAAI;UACF,MAAMuD,UAAU,GAAG,MAAMtB,KAAK,CAAC,GAAG9F,OAAO,aAAa+G,UAAU,CAAClD,GAAG,EAAE,CAAC;UACvE,IAAIuD,UAAU,CAACnB,EAAE,EAAE;YACjBc,UAAU,GAAG,MAAMK,UAAU,CAACT,IAAI,CAAC,CAAC;UACtC;QACF,CAAC,CAAC,MAAM,CAAC;MACX;MACA,IAAIxF,SAAS,CAAC2C,OAAO,IAAIiD,UAAU,EAAE;QACnC;QACA,IAAIM,SAAS,GAAGN,UAAU;QAC1B,IAAI,CAACA,UAAU,CAAC7E,MAAM,IAAI6E,UAAU,CAAC7E,MAAM,CAACsC,MAAM,KAAK,CAAC,EAAE;UACxD,IAAI;YACF,MAAMI,IAAI,GAAG,MAAMkB,KAAK,CAAC,GAAG9F,OAAO,aAAa+G,UAAU,CAAClD,GAAG,EAAE,CAAC;YACjE,IAAIe,IAAI,CAACqB,EAAE,EAAE;cACXoB,SAAS,GAAG,MAAMzC,IAAI,CAAC+B,IAAI,CAAC,CAAC;YAC/B;UACF,CAAC,CAAC,MAAM,CAAC;QACX;QACA;QACA,IAAIU,SAAS,CAACnF,MAAM,IAAImF,SAAS,CAACnF,MAAM,CAACsC,MAAM,GAAG,CAAC,EAAE;UACnDT,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAEqD,SAAS,CAACnF,MAAM,CAACiC,GAAG,CAACC,GAAG,IAAIA,GAAG,CAAC/D,GAAG,CAAC,CAAC;QACtF,CAAC,MAAM;UACL0D,OAAO,CAACoD,IAAI,CAAC,qDAAqD,EAAEE,SAAS,CAAC;QAChF;QACA;QACApF,iBAAiB,CAACoF,SAAS,CAACnF,MAAM,GAAG,CAAC,GAAGmF,SAAS,CAACnF,MAAM,CAAC,GAAG,EAAE,CAAC;QAChEP,aAAa,CAAC,EAAE,CAAC;QACjBE,gBAAgB,CAAC,EAAE,CAAC;QACpB;QACAkC,OAAO,CAACC,GAAG,CAAC,wDAAwD,EAAEqD,SAAS,CAAC;QAChFxG,MAAM,CAACwG,SAAS,CAAC,CAAC,CAAC;MACrB;IACF,CAAC,CAAC,OAAOC,GAAQ,EAAE;MACjB,IAAI,CAACnG,SAAS,CAAC2C,OAAO,EAAE;MACxB,IAAIpC,UAAU,CAAC8C,MAAM,GAAG,CAAC,KAAK8C,GAAG,CAACT,OAAO,KAAK,iBAAiB,IAAIS,GAAG,CAACT,OAAO,KAAK,iDAAiD,CAAC,EAAE;QACrIpE,cAAc,CAAC,qEAAqE,CAAC;MACvF,CAAC,MAAM;QACLA,cAAc,CAAC6E,GAAG,CAACT,OAAO,IAAI,sBAAsB,CAAC;MACvD;MACA9C,OAAO,CAACqC,KAAK,CAAC,+BAA+B,EAAEkB,GAAG,CAAC;IACrD;EACF,CAAC;EAED,oBACEvH,OAAA;IACEwH,SAAS,EAAC,oBAAoB;IAC9BC,KAAK,EAAE;MACLC,QAAQ,EAAE,OAAO;MACjBC,GAAG,EAAE,CAAC;MACNC,IAAI,EAAE,CAAC;MACPhF,KAAK,EAAE,OAAO;MACdG,MAAM,EAAE,OAAO;MACf8E,eAAe,EAAE,oBAAoB;MACrCC,MAAM,EAAE,UAAU;MAClBC,OAAO,EAAE,MAAM;MACfC,UAAU,EAAErF,UAAU,CAACC,KAAK,GAAG,GAAG,GAAG,QAAQ,GAAG,SAAS;MACzDqF,cAAc,EAAE,QAAQ;MACxBC,OAAO,EAAEvF,UAAU,CAACC,KAAK,GAAG,GAAG,GAAG,MAAM,GAAG,GAAG;MAC9CuF,SAAS,EAAE;IACb,CAAE;IACFC,OAAO,EAAGjB,CAAC,IAAK;MACd,IAAIA,CAAC,CAACkB,MAAM,KAAKlB,CAAC,CAACmB,aAAa,EAAE;QAChCzH,OAAO,CAAC,CAAC;MACX;IACF,CAAE;IAAA0H,QAAA,eAEFvI,OAAA;MACEyH,KAAK,EAAE;QACLI,eAAe,EAAE,OAAO;QACxBW,YAAY,EAAE7F,UAAU,CAACC,KAAK,GAAG,GAAG,GAAI5B,WAAW,GAAG,MAAM,GAAG,MAAM,GAAI,GAAG;QAC5EkH,OAAO,EAAElH,WAAW,GAAG,eAAe,GAAG,QAAQ;QACjDyH,UAAU,EAAE9F,UAAU,CAACC,KAAK,GAAG,GAAG,GAAI5B,WAAW,GAAG,QAAQ,GAAG,QAAQ,GAAI,QAAQ;QACnF0H,aAAa,EAAE/F,UAAU,CAACC,KAAK,GAAG,GAAG,GAAI5B,WAAW,GAAG,QAAQ,GAAG,QAAQ,GAAI,MAAM;QACpF4B,KAAK,EAAED,UAAU,CAACC,KAAK,GAAG,GAAG,GAAI5B,WAAW,GAAG,OAAO,GAAG,MAAM,GAAI,OAAO;QAC1E+B,MAAM,EAAEJ,UAAU,CAACC,KAAK,GAAG,GAAG,GAAI5B,WAAW,GAAG,MAAM,GAAG,MAAM,GAAI,OAAO;QAC1E2H,QAAQ,EAAEhG,UAAU,CAACC,KAAK,GAAG,GAAG,GAAI5B,WAAW,GAAG,OAAO,GAAG,OAAO,GAAI,OAAO;QAC9E4H,SAAS,EAAEjG,UAAU,CAACC,KAAK,GAAG,GAAG,GAAI5B,WAAW,GAAG,MAAM,GAAG,MAAM,GAAI,OAAO;QAC7E6H,SAAS,EAAElG,UAAU,CAACC,KAAK,GAAG,GAAG,IAAI5B,WAAW,GAAG,OAAO,GAAG0C,SAAS;QACtEoF,SAAS,EAAE,MAAM;QACjBC,uBAAuB,EAAE,OAAO;QAChCrB,QAAQ,EAAE,UAAU;QACpBI,MAAM,EAAE,UAAU;QAClBkB,SAAS,EAAEhI,WAAW,IAAI2B,UAAU,CAACC,KAAK,GAAG,GAAG,GAAG,6BAA6B,GAAGc,SAAS;QAC5FuF,UAAU,EAAE;MACd,CAAE;MAAAV,QAAA,gBAEFvI,OAAA;QACEwH,SAAS,EAAC,mBAAmB;QAC7BY,OAAO,EAAEvH,OAAQ;QAAA0H,QAAA,EAClB;MAED;QAAAW,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,eACTrJ,OAAA;QAAIyH,KAAK,EAAE;UACT6B,YAAY,EAAEtI,WAAW,GAAG,QAAQ,GAAG,MAAM;UAC7CuI,QAAQ,EAAEvI,WAAW,GAAG,SAAS,GAAG0C,SAAS;UAC7C8F,UAAU,EAAExI,WAAW,GAAG,GAAG,GAAG0C,SAAS;UACzCgE,QAAQ,EAAE,QAAQ;UAClBG,eAAe,EAAE,OAAO;UACxBC,MAAM,EAAE,GAAG;UACXW,UAAU,EAAE;QACd,CAAE;QAAAF,QAAA,EAAErH,CAAC,CAAC,eAAe,EAAE;UAAEmC,IAAI,EAAEzC,GAAG,CAACyC;QAAK,CAAC;MAAC;QAAA6F,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC,EAC/C5G,WAAW,iBACVzC,OAAA;QAAKyH,KAAK,EAAE;UAAElE,KAAK,EAAE,SAAS;UAAEiG,UAAU,EAAE,GAAG;UAAEF,YAAY,EAAE,EAAE;UAAEG,SAAS,EAAE;QAAS,CAAE;QAAAlB,QAAA,EAAE9F;MAAW;QAAAyG,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAM,CAC7G,eACDrJ,OAAA;QACE2E,QAAQ,EAAE1B,YAAY,CAAC0B,QAAQ,CAAE;QACjC8C,KAAK,EAAE;UACLM,OAAO,EAAE,MAAM;UACf2B,aAAa,EAAE,QAAQ;UACvBC,GAAG,EAAE3I,WAAW,GAAG,QAAQ,GAAG,MAAM;UACpCuI,QAAQ,EAAEvI,WAAW,GAAG,SAAS,GAAG0C;QACtC,CAAE;QAAA6E,QAAA,gBAGFvI,OAAA;UAAAuI,QAAA,EAAQrH,CAAC,CAAC,aAAa;QAAC;UAAAgI,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eACjCrJ,OAAA;UACEqD,IAAI,EAAC,MAAM;UACXuG,YAAY,EAAEhJ,GAAG,CAACyC,IAAI,IAAI,EAAG;UAC7BwG,QAAQ,EAAE1C,CAAC,IAAIjE,QAAQ,CAAC,MAAM,EAAEiE,CAAC,CAACkB,MAAM,CAACyB,KAAK,CAAE;UAChDC,QAAQ;UACRtC,KAAK,EAAE;YAAES,OAAO,EAAElH,WAAW,GAAG,SAAS,GAAG,QAAQ;YAAEwH,YAAY,EAAE,CAAC;YAAEwB,MAAM,EAAE,gBAAgB;YAAET,QAAQ,EAAEvI,WAAW,GAAG,SAAS,GAAG0C;UAAU;QAAE;UAAAwF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClJ,CAAC,eAEFrJ,OAAA;UAAAuI,QAAA,EAAQrH,CAAC,CAAC,cAAc;QAAC;UAAAgI,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eAClCrJ,OAAA;UACEqD,IAAI,EAAC,OAAO;UACZuG,YAAY,EAAEhJ,GAAG,CAAC0C,KAAK,IAAI,EAAG;UAC9BuG,QAAQ,EAAE1C,CAAC,IAAIjE,QAAQ,CAAC,OAAO,EAAEiE,CAAC,CAACkB,MAAM,CAACyB,KAAK,CAAE;UACjDrC,KAAK,EAAE;YAAES,OAAO,EAAElH,WAAW,GAAG,SAAS,GAAG,QAAQ;YAAEwH,YAAY,EAAE,CAAC;YAAEwB,MAAM,EAAE,gBAAgB;YAAET,QAAQ,EAAEvI,WAAW,GAAG,SAAS,GAAG0C;UAAU;QAAE;UAAAwF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClJ,CAAC,eAEFrJ,OAAA;UAAAuI,QAAA,EAAQrH,CAAC,CAAC,cAAc;QAAC;UAAAgI,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eAClCrJ,OAAA;UACEqD,IAAI,EAAC,OAAO;UACZuG,YAAY,EAAEhJ,GAAG,CAAC2C,KAAK,IAAI,EAAG;UAC9BsG,QAAQ,EAAE1C,CAAC,IAAIjE,QAAQ,CAAC,OAAO,EAAEiE,CAAC,CAACkB,MAAM,CAACyB,KAAK,CAAE;UACjDrC,KAAK,EAAE;YAAES,OAAO,EAAElH,WAAW,GAAG,SAAS,GAAG,QAAQ;YAAEwH,YAAY,EAAE,CAAC;YAAEwB,MAAM,EAAE,gBAAgB;YAAET,QAAQ,EAAEvI,WAAW,GAAG,SAAS,GAAG0C;UAAU;QAAE;UAAAwF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClJ,CAAC,eAGFrJ,OAAA;UAAAuI,QAAA,EAAQrH,CAAC,CAAC,iBAAiB;QAAC;UAAAgI,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eACrCrJ,OAAA;UACEqD,IAAI,EAAC,UAAU;UACfuG,YAAY,EAAEhJ,GAAG,CAAC4C,QAAQ,IAAI,EAAG;UACjCqG,QAAQ,EAAE1C,CAAC,IAAIjE,QAAQ,CAAC,UAAU,EAAEiE,CAAC,CAACkB,MAAM,CAACyB,KAAK,CAAE;UACpDrC,KAAK,EAAE;YAAES,OAAO,EAAElH,WAAW,GAAG,SAAS,GAAG,QAAQ;YAAEwH,YAAY,EAAE,CAAC;YAAEwB,MAAM,EAAE,gBAAgB;YAAET,QAAQ,EAAEvI,WAAW,GAAG,SAAS,GAAG0C;UAAU;QAAE;UAAAwF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClJ,CAAC,eAEFrJ,OAAA;UAAOyH,KAAK,EAAE;YAAE8B,QAAQ,EAAE,QAAQ;YAAEC,UAAU,EAAE;UAAI,CAAE;UAAAjB,QAAA,EAAErH,CAAC,CAAC,eAAe,CAAC,CAAC+I,OAAO,CAAC,SAAS,EAAE,EAAE;QAAC;UAAAf,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eAC1GrJ,OAAA;UAAKyH,KAAK,EAAE;YAAEM,OAAO,EAAE,MAAM;YAAE4B,GAAG,EAAE,EAAE;YAAE3B,UAAU,EAAE,QAAQ;YAAEsB,YAAY,EAAE;UAAE,CAAE;UAAAf,QAAA,gBAC9EvI,OAAA;YAAOwH,SAAS,EAAE,sBAAsBnG,MAAM,KAAK,MAAM,GAAG,WAAW,GAAG,EAAE,EAAG;YAACoG,KAAK,EAAE;cAAE8B,QAAQ,EAAE,QAAQ;cAAEC,UAAU,EAAE;YAAI,CAAE;YAAAjB,QAAA,gBAC7HvI,OAAA;cACEkK,IAAI,EAAC,OAAO;cACZ7G,IAAI,EAAC,QAAQ;cACbmE,SAAS,EAAC,eAAe;cACzB2C,OAAO,EAAE9I,MAAM,KAAK,MAAO;cAC3BwI,QAAQ,EAAEA,CAAA,KAAM;gBAAE3G,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC;gBAAE5B,SAAS,CAAC,MAAM,CAAC;cAAE;YAAE;cAAA4H,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACpE,CAAC,eACFrJ,OAAA;cAAMwH,SAAS,EAAC;YAAsB;cAAA0B,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,EACxCnI,CAAC,CAAC,aAAa,CAAC,CAAC+I,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;UAAA;YAAAf,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACnC,CAAC,eACRrJ,OAAA;YAAOwH,SAAS,EAAE,sBAAsBnG,MAAM,KAAK,QAAQ,GAAG,WAAW,GAAG,EAAE,EAAG;YAACoG,KAAK,EAAE;cAAE8B,QAAQ,EAAE,QAAQ;cAAEC,UAAU,EAAE;YAAI,CAAE;YAAAjB,QAAA,gBAC/HvI,OAAA;cACEkK,IAAI,EAAC,OAAO;cACZ7G,IAAI,EAAC,QAAQ;cACbmE,SAAS,EAAC,eAAe;cACzB2C,OAAO,EAAE9I,MAAM,KAAK,QAAS;cAC7BwI,QAAQ,EAAEA,CAAA,KAAM;gBAAE3G,QAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC;gBAAE5B,SAAS,CAAC,QAAQ,CAAC;cAAE;YAAE;cAAA4H,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACxE,CAAC,eACFrJ,OAAA;cAAMwH,SAAS,EAAC;YAAsB;cAAA0B,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,EACxCnI,CAAC,CAAC,eAAe,CAAC,CAAC+I,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;UAAA;YAAAf,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACrC,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACL,CAAC,eAENrJ,OAAA;UAAKyH,KAAK,EAAE;YAAEM,OAAO,EAAE,MAAM;YAAE4B,GAAG,EAAE,EAAE;YAAE3B,UAAU,EAAE,QAAQ;YAAEsB,YAAY,EAAE;UAAE,CAAE;UAAAf,QAAA,gBAC9EvI,OAAA;YAAOwH,SAAS,EAAE,yBAAyBjG,UAAU,GAAG,WAAW,GAAG,EAAE,EAAG;YAACkG,KAAK,EAAE;cAAE8B,QAAQ,EAAE,QAAQ;cAAEC,UAAU,EAAE;YAAI,CAAE;YAAAjB,QAAA,gBACzHvI,OAAA;cACEkK,IAAI,EAAC,UAAU;cACf7G,IAAI,EAAC,YAAY;cACjBmE,SAAS,EAAC,kBAAkB;cAC5B2C,OAAO,EAAE5I,UAAW;cACpBsI,QAAQ,EAAE1C,CAAC,IAAI;gBAAEjE,QAAQ,CAAC,YAAY,EAAEiE,CAAC,CAACkB,MAAM,CAAC8B,OAAO,CAAC;gBAAE3I,aAAa,CAAC2F,CAAC,CAACkB,MAAM,CAAC8B,OAAO,CAAC;cAAE;YAAE;cAAAjB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAC/F,CAAC,eACFrJ,OAAA;cAAMwH,SAAS,EAAC;YAAyB;cAAA0B,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,EAC3CnI,CAAC,CAAC,mBAAmB,CAAC,CAAC+I,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;UAAA;YAAAf,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACzC,CAAC,eACRrJ,OAAA;YAAOwH,SAAS,EAAE,yBAAyB/F,QAAQ,GAAG,WAAW,GAAG,EAAE,EAAG;YAACgG,KAAK,EAAE;cAAE8B,QAAQ,EAAE,QAAQ;cAAEC,UAAU,EAAE;YAAI,CAAE;YAAAjB,QAAA,gBACvHvI,OAAA;cACEkK,IAAI,EAAC,UAAU;cACf7G,IAAI,EAAC,UAAU;cACfmE,SAAS,EAAC,kBAAkB;cAC5B2C,OAAO,EAAE1I,QAAS;cAClBoI,QAAQ,EAAE1C,CAAC,IAAI;gBAAEjE,QAAQ,CAAC,UAAU,EAAEiE,CAAC,CAACkB,MAAM,CAAC8B,OAAO,CAAC;gBAAEzI,WAAW,CAACyF,CAAC,CAACkB,MAAM,CAAC8B,OAAO,CAAC;cAAE;YAAE;cAAAjB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAC3F,CAAC,eACFrJ,OAAA;cAAMwH,SAAS,EAAC;YAAyB;cAAA0B,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,EAC3CnI,CAAC,CAAC,iBAAiB,CAAC,CAAC+I,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;UAAA;YAAAf,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACvC,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACL,CAAC,eAENrJ,OAAA;UAAAuI,QAAA,EAAQrH,CAAC,CAAC,oBAAoB;QAAC;UAAAgI,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eACxCrJ,OAAA;UACEqD,IAAI,EAAC,aAAa;UAClBuG,YAAY,EAAEhJ,GAAG,CAAC+C,WAAW,IAAI,EAAG;UACpCkG,QAAQ,EAAE1C,CAAC,IAAIjE,QAAQ,CAAC,aAAa,EAAEiE,CAAC,CAACkB,MAAM,CAACyB,KAAK,CAAE;UACvDM,IAAI,EAAEpJ,WAAW,GAAG,CAAC,GAAG,CAAE;UAC1ByG,KAAK,EAAE;YAAES,OAAO,EAAElH,WAAW,GAAG,SAAS,GAAG,QAAQ;YAAEwH,YAAY,EAAE,CAAC;YAAEwB,MAAM,EAAE,gBAAgB;YAAEK,MAAM,EAAE,UAAU;YAAEd,QAAQ,EAAEvI,WAAW,GAAG,SAAS,GAAG0C;UAAU;QAAE;UAAAwF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACtK,CAAC,eAGFrJ,OAAA;UAAAuI,QAAA,EAAQrH,CAAC,CAAC,cAAc;QAAC;UAAAgI,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eAClCrJ,OAAA;UAAKwH,SAAS,EAAC,iBAAiB;UAAAe,QAAA,eAC9BvI,OAAA;YAAKyH,KAAK,EAAE;cAAEC,QAAQ,EAAE,UAAU;cAAE9E,KAAK,EAAE;YAAO,CAAE;YAAA2F,QAAA,gBAChDvI,OAAA;cACAsK,EAAE,EAAC,eAAe;cAClBjH,IAAI,EAAC,OAAO;cACZ6G,IAAI,EAAC,MAAM;cACXK,MAAM,EAAC,SAAS;cAChBC,QAAQ;cACRC,GAAG,EAAEzI,YAAa;cAClB6H,QAAQ,EAAE1C,CAAC,IAAI;gBACb,MAAMuD,KAAK,GAAGC,KAAK,CAACC,IAAI,CAACzD,CAAC,CAACkB,MAAM,CAACqC,KAAK,IAAI,EAAE,CAAC;gBAC9C9I,aAAa,CAACiJ,IAAI,IAAI;kBACpB,MAAMC,aAAa,GAAG,IAAIxI,GAAG,CAACuI,IAAI,CAACzG,GAAG,CAAC2G,CAAC,IAAIA,CAAC,CAAC1H,IAAI,CAAC,CAAC;kBACpD,MAAM2H,QAAQ,GAAGN,KAAK,CAACO,MAAM,CAACF,CAAC,IAAI,CAACD,aAAa,CAACI,GAAG,CAACH,CAAC,CAAC1H,IAAI,CAAC,CAAC;kBAC9D2H,QAAQ,CAAC3F,OAAO,CAAC0F,CAAC,IAAI;oBACpB,IAAI,CAAChJ,cAAc,CAACgC,OAAO,CAACgH,CAAC,CAAC1H,IAAI,CAAC,EAAE;sBACnCtB,cAAc,CAACgC,OAAO,CAACgH,CAAC,CAAC1H,IAAI,CAAC,GAAG8H,GAAG,CAACC,eAAe,CAACL,CAAC,CAAC;oBACzD;kBACF,CAAC,CAAC;kBACFjJ,gBAAgB,CAACuJ,YAAY,IAAI,CAC/B,GAAGA,YAAY,EACf,GAAGL,QAAQ,CAAC5G,GAAG,CAAC2G,CAAC,KAAK;oBAAE1H,IAAI,EAAE0H,CAAC,CAAC1H,IAAI;oBAAE/C,GAAG,EAAEyB,cAAc,CAACgC,OAAO,CAACgH,CAAC,CAAC1H,IAAI;kBAAE,CAAC,CAAC,CAAC,CAC9E,CAAC;kBACF;kBACA,IAAIrB,YAAY,CAAC+B,OAAO,EAAE/B,YAAY,CAAC+B,OAAO,CAAC+F,KAAK,GAAG,EAAE;kBACzD,OAAO,CAAC,GAAGe,IAAI,EAAE,GAAGG,QAAQ,CAAC;gBAC/B,CAAC,CAAC;cACJ,CAAE;cACFvD,KAAK,EAAE;gBAAE6B,YAAY,EAAE;cAAE;YAAE;cAAAJ,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAC5B,CAAC,eACFrJ,OAAA;cAAKyH,KAAK,EAAE;gBAAEC,QAAQ,EAAE,UAAU;gBAAE3E,MAAM,EAAE,GAAG;gBAAE8F,SAAS,EAAE,GAAG;gBAAED,SAAS,EAAE,GAAG;gBAAEhG,KAAK,EAAE,MAAM;gBAAE0I,QAAQ,EAAE;cAAS,CAAE;cAAA/C,QAAA,gBAEnHvI,OAAA;gBACEkK,IAAI,EAAC,QAAQ;gBACb9B,OAAO,EAAEA,CAAA,KAAM;kBACbxG,aAAa,CAAC,EAAE,CAAC;kBACjBE,gBAAgB,CAAC,EAAE,CAAC;kBACpB;kBACAyJ,MAAM,CAACC,MAAM,CAACzJ,cAAc,CAACgC,OAAO,CAAC,CAACsB,OAAO,CAAC/E,GAAG,IAAI6K,GAAG,CAACM,eAAe,CAACnL,GAAG,CAAC,CAAC;kBAC9EyB,cAAc,CAACgC,OAAO,GAAG,CAAC,CAAC;kBAC3B;kBACA,IAAI/B,YAAY,CAAC+B,OAAO,EAAE/B,YAAY,CAAC+B,OAAO,CAAC+F,KAAK,GAAG,EAAE;gBAC3D,CAAE;gBACFtC,SAAS,EAAC,0BAA0B;gBACpCC,KAAK,EAAE;kBAAEC,QAAQ,EAAE,UAAU;kBAAEC,GAAG,EAAE,CAAC;kBAAE+D,KAAK,EAAE,CAAC;kBAAE5D,MAAM,EAAE,EAAE;kBAAE6D,UAAU,EAAE9J,aAAa,CAAC4C,MAAM,GAAG,CAAC,GAAG,SAAS,GAAG;gBAAS,CAAE;gBAC3HmH,QAAQ,EAAE/J,aAAa,CAAC4C,MAAM,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAE;gBAC5C,eAAa5C,aAAa,CAAC4C,MAAM,KAAK,CAAE;gBAAA8D,QAAA,EAEvCrH,CAAC,CAAC,qBAAqB,CAAC,CAAC+I,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,EAAE;cAAC;gBAAAf,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAClE,CAAC,eACTrJ,OAAA;gBAAKyH,KAAK,EAAE;kBAAE1E,MAAM,EAAE,GAAG;kBAAEH,KAAK,EAAE,MAAM;kBAAE0I,QAAQ,EAAE,QAAQ;kBAAEvD,OAAO,EAAE,MAAM;kBAAE2B,aAAa,EAAE,QAAQ;kBAAE1B,UAAU,EAAE,QAAQ;kBAAEC,cAAc,EAAE;gBAAS,CAAE;gBAAAM,QAAA,GACtJ1G,aAAa,CAAC4C,MAAM,KAAK,CAAC,IAAIxC,cAAc,CAACwC,MAAM,KAAK,CAAC,iBACxDzE,OAAA;kBAAGyH,KAAK,EAAE;oBAAEoE,MAAM,EAAE,CAAC;oBAAEtI,KAAK,EAAE,SAAS;oBAAEgG,QAAQ,EAAE,MAAM;oBAAEC,UAAU,EAAE,GAAG;oBAAEzG,MAAM,EAAE,EAAE;oBAAEgF,OAAO,EAAE,MAAM;oBAAEC,UAAU,EAAE,QAAQ;oBAAEC,cAAc,EAAE;kBAAS,CAAE;kBAAAM,QAAA,gBACxJvI,OAAA;oBAAM8L,IAAI,EAAC,KAAK;oBAAC,cAAW,OAAO;oBAAAvD,QAAA,EAAC;kBAAE;oBAAAW,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAM,CAAC,KAAC,EAACnI,CAAC,CAAC,kBAAkB,CAAC,CAAC+I,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;gBAAA;kBAAAf,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAClH,CACJ,eACDrJ,OAAA;kBAAKwH,SAAS,EAAC,4BAA4B;kBAAAe,QAAA,eACzCvI,OAAA;oBAAKwH,SAAS,EAAC,oBAAoB;oBAAAe,QAAA,GAChC,CAAC,MAAM;sBAAEvE,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAE;wBAAChC,cAAc;wBAAEyC,SAAS,EAAE9D,GAAG,CAACuB;sBAAM,CAAC,CAAC;sBAAE,OAAO,IAAI;oBAAE,CAAC,EAAE,CAAC,EAChHxC,OAAO,CAAC,MAAM;sBACb,IAAIkC,aAAa,CAAC4C,MAAM,GAAG,CAAC,EAAE;wBAC5B,OAAO5C,aAAa,CAACuC,GAAG,CAAE2H,OAAO,iBAC/B/L,OAAA;0BAAwByH,KAAK,EAAE;4BAAEC,QAAQ,EAAE,UAAU;4BAAE9E,KAAK,EAAE,EAAE;4BAAEG,MAAM,EAAE;0BAAG,CAAE;0BAAAwF,QAAA,eAC7EvI,OAAA;4BACEgM,GAAG,EAAED,OAAO,CAACzL,GAAI;4BACjB2L,GAAG,EAAE,WAAWF,OAAO,CAAC1I,IAAI,EAAG;4BAC/BT,KAAK,EAAE,EAAG;4BACVG,MAAM,EAAE,EAAG;4BACX0E,KAAK,EAAE;8BAAEe,YAAY,EAAE,CAAC;8BAAE0D,SAAS,EAAE,OAAO;8BAAEnJ,MAAM,EAAE,EAAE;8BAAEH,KAAK,EAAE;4BAAG;0BAAE;4BAAAsG,QAAA,EAAAC,YAAA;4BAAAC,UAAA;4BAAAC,YAAA;0BAAA,OACvE;wBAAC,GAPM0C,OAAO,CAAC1I,IAAI;0BAAA6F,QAAA,EAAAC,YAAA;0BAAAC,UAAA;0BAAAC,YAAA;wBAAA,OAQjB,CACN,CAAC;sBACJ,CAAC,MAAM,IAAIpH,cAAc,CAACwC,MAAM,GAAG,CAAC,EAAE;wBACpC;wBACA,OAAOxC,cAAc,CAClBmC,GAAG,CAAC,CAACC,GAAQ,EAAEwB,GAAW,KAAK;0BAC9B,IAAI,CAACxB,GAAG,CAAC/D,GAAG,EAAE,OAAO,IAAI;0BACzB,IAAI6L,MAAM,GAAG9L,WAAW,CAACgE,GAAG,CAAC/D,GAAG,CAAC;0BACjC,IAAI,CAAC,CAAC6L,MAAM,IAAIA,MAAM,KAAK,EAAE,IAAIA,MAAM,KAAK,WAAW,KAAK,CAAC5J,eAAe,CAAC2I,GAAG,CAACrF,GAAG,CAAC,EAAE;4BACrF,oBACE7F,OAAA;8BAAgDyH,KAAK,EAAE;gCAAEC,QAAQ,EAAE,UAAU;gCAAE9E,KAAK,EAAE,EAAE;gCAAEG,MAAM,EAAE,EAAE;gCAAEgF,OAAO,EAAE,MAAM;gCAAEC,UAAU,EAAE,QAAQ;gCAAEC,cAAc,EAAE,QAAQ;gCAAEmE,UAAU,EAAE,SAAS;gCAAE5D,YAAY,EAAE,CAAC;gCAAEjF,KAAK,EAAE,MAAM;gCAAEgG,QAAQ,EAAE;8BAAG,CAAE;8BAAAhB,QAAA,eAC3OvI,OAAA;gCAAM8L,IAAI,EAAC,KAAK;gCAAC,cAAW,UAAU;gCAAAvD,QAAA,EAAC;8BAAE;gCAAAW,QAAA,EAAAC,YAAA;gCAAAC,UAAA;gCAAAC,YAAA;8BAAA,OAAM;4BAAC,GADxC,CAAChF,GAAG,CAACP,GAAG,GAAGO,GAAG,CAACP,GAAG,GAAG,EAAE,IAAI,GAAG,GAAG+B,GAAG;8BAAAqD,QAAA,EAAAC,YAAA;8BAAAC,UAAA;8BAAAC,YAAA;4BAAA,OAEzC,CAAC;0BAEV;0BACA,IAAI9G,eAAe,CAAC2I,GAAG,CAACrF,GAAG,CAAC,EAAE,OAAO,IAAI;0BACzC,MAAMwG,GAAG,GAAG,CAAChI,GAAG,CAACP,GAAG,GAAGO,GAAG,CAACP,GAAG,GAAG,EAAE,IAAI,GAAG,GAAG+B,GAAG;0BAChD,oBACE7F,OAAA;4BAAeyH,KAAK,EAAE;8BAAEC,QAAQ,EAAE,UAAU;8BAAE9E,KAAK,EAAE,EAAE;8BAAEG,MAAM,EAAE;4BAAG,CAAE;4BAAAwF,QAAA,gBACpEvI,OAAA;8BACEgM,GAAG,EAAEG,MAAO;8BACZF,GAAG,EAAC,aAAa;8BACjBrJ,KAAK,EAAE,EAAG;8BACVG,MAAM,EAAE,EAAG;8BACX0E,KAAK,EAAE;gCAAEe,YAAY,EAAE,CAAC;gCAAE0D,SAAS,EAAE,OAAO;gCAAEnJ,MAAM,EAAE,EAAE;gCAAEH,KAAK,EAAE,EAAE;gCAAE0J,OAAO,EAAElK,gBAAgB,CAAC8I,GAAG,CAACrF,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC;gCAAEuG,UAAU,EAAE;8BAAU,CAAE;8BAC3IG,OAAO,EAAEA,CAAA,KAAM/J,kBAAkB,CAACqI,IAAI,IAAI,IAAIvI,GAAG,CAACuI,IAAI,CAAC,CAAC2B,GAAG,CAAC3G,GAAG,CAAC;4BAAE;8BAAAqD,QAAA,EAAAC,YAAA;8BAAAC,UAAA;8BAAAC,YAAA;4BAAA,OACnE,CAAC,eACFrJ,OAAA;8BACEkK,IAAI,EAAC,UAAU;8BACfC,OAAO,EAAE/H,gBAAgB,CAAC8I,GAAG,CAACrF,GAAG,CAAE;8BACnCgE,QAAQ,EAAE1C,CAAC,IAAI;gCACb9E,mBAAmB,CAACwI,IAAI,IAAI;kCAC1B,MAAM4B,IAAI,GAAG,IAAInK,GAAG,CAACuI,IAAI,CAAC;kCAC1B,IAAI1D,CAAC,CAACkB,MAAM,CAAC8B,OAAO,EAAEsC,IAAI,CAACD,GAAG,CAAC3G,GAAG,CAAC,CAAC,KAC/B4G,IAAI,CAACC,MAAM,CAAC7G,GAAG,CAAC;kCACrB,OAAO4G,IAAI;gCACb,CAAC,CAAC;8BACJ,CAAE;8BACFhF,KAAK,EAAE;gCAAEC,QAAQ,EAAE,UAAU;gCAAEC,GAAG,EAAE,CAAC;gCAAEC,IAAI,EAAE,CAAC;gCAAEE,MAAM,EAAE,CAAC;gCAAElF,KAAK,EAAE,EAAE;gCAAEG,MAAM,EAAE,EAAE;gCAAE4J,WAAW,EAAE,SAAS;gCAAEP,UAAU,EAAE,MAAM;gCAAEpC,MAAM,EAAE,mBAAmB;gCAAExB,YAAY,EAAE,CAAC;gCAAEQ,SAAS,EAAE;8BAA6B,CAAE;8BACtN4D,KAAK,EAAExK,gBAAgB,CAAC8I,GAAG,CAACrF,GAAG,CAAC,GAAG3E,CAAC,CAAC,0BAA0B,CAAC,CAAC+I,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,GAAG/I,CAAC,CAAC,wBAAwB,CAAC,CAAC+I,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,EAAE;4BAAE;8BAAAf,QAAA,EAAAC,YAAA;8BAAAC,UAAA;8BAAAC,YAAA;4BAAA,OAC9L,CAAC,eACFrJ,OAAA;8BACEkK,IAAI,EAAC,QAAQ;8BACbzC,KAAK,EAAE;gCAAEC,QAAQ,EAAE,UAAU;gCAAEC,GAAG,EAAE,CAAC;gCAAE+D,KAAK,EAAE,CAAC;gCAAEU,UAAU,EAAE,SAAS;gCAAE7I,KAAK,EAAE,MAAM;gCAAEyG,MAAM,EAAE,MAAM;gCAAExB,YAAY,EAAE,KAAK;gCAAE5F,KAAK,EAAE,EAAE;gCAAEG,MAAM,EAAE,EAAE;gCAAE8J,QAAQ,EAAE,EAAE;gCAAEhE,SAAS,EAAE,EAAE;gCAAEF,QAAQ,EAAE,EAAE;gCAAEC,SAAS,EAAE,EAAE;gCAAEkE,MAAM,EAAE,SAAS;gCAAEtD,UAAU,EAAE,MAAM;gCAAED,QAAQ,EAAE,EAAE;gCAAEwD,UAAU,EAAE,MAAM;gCAAE7E,OAAO,EAAE,CAAC;gCAAEH,OAAO,EAAE,MAAM;gCAAEC,UAAU,EAAE,QAAQ;gCAAEC,cAAc,EAAE,QAAQ;gCAAEe,SAAS,EAAE;8BAA6B,CAAE;8BAC7YZ,OAAO,EAAEA,CAAA,KAAM;gCACblG,iBAAiB,CAACD,cAAc,CAACgJ,MAAM,CAAC,CAAC+B,CAAC,EAAEC,CAAC,KAAKA,CAAC,KAAKpH,GAAG,CAAC,CAAC;gCAC7DxD,mBAAmB,CAACwI,IAAI,IAAI;kCAC1B,MAAM4B,IAAI,GAAG,IAAInK,GAAG,CAACuI,IAAI,CAAC;kCAC1B4B,IAAI,CAACC,MAAM,CAAC7G,GAAG,CAAC;kCAChB;kCACA,MAAMqH,OAAO,GAAG,IAAI5K,GAAG,CAAS,CAAC;kCACjCmK,IAAI,CAACpH,OAAO,CAAC4H,CAAC,IAAIC,OAAO,CAACV,GAAG,CAACS,CAAC,GAAGpH,GAAG,GAAGoH,CAAC,GAAG,CAAC,GAAGA,CAAC,CAAC,CAAC;kCACnD,OAAOC,OAAO;gCAChB,CAAC,CAAC;8BACJ,CAAE;8BACFN,KAAK,EAAE1L,CAAC,CAAC,yBAAyB,CAAC,CAAC+I,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,EAAE,CAAE;8BAAA1B,QAAA,EACpF;4BAED;8BAAAW,QAAA,EAAAC,YAAA;8BAAAC,UAAA;8BAAAC,YAAA;4BAAA,OAAQ,CAAC;0BAAA,GAxCDgD,GAAG;4BAAAnD,QAAA,EAAAC,YAAA;4BAAAC,UAAA;4BAAAC,YAAA;0BAAA,OAyCR,CAAC;wBAEV,CAAC,CAAC,CACD4B,MAAM,CAACkC,OAAO,CAAC;sBACpB;sBACA,OAAO,IAAI;oBACb,CAAC,EAAE,CAACtL,aAAa,EAAEI,cAAc,EAAEG,gBAAgB,EAAElB,CAAC,CAAC,CAAC;kBAAA;oBAAAgI,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACrD;gBAAC;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACH,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACH,CAAC,EAEPxH,aAAa,CAAC4C,MAAM,KAAK,CAAC,IAAIxC,cAAc,CAACwC,MAAM,GAAG,CAAC,iBACtDzE,OAAA;gBAAKyH,KAAK,EAAE;kBAAEC,QAAQ,EAAE,UAAU;kBAAE0F,MAAM,EAAE,CAAC;kBAAExF,IAAI,EAAE,CAAC;kBAAEhF,KAAK,EAAE,MAAM;kBAAEyK,SAAS,EAAE,CAAC;kBAAEtF,OAAO,EAAE,MAAM;kBAAE4B,GAAG,EAAE,CAAC;kBAAEyC,UAAU,EAAE,OAAO;kBAAEtE,MAAM,EAAE;gBAAE,CAAE;gBAAAS,QAAA,gBAC7IvI,OAAA;kBACEkK,IAAI,EAAC,QAAQ;kBACbzC,KAAK,EAAE;oBAAE2E,UAAU,EAAE,SAAS;oBAAE7I,KAAK,EAAE,MAAM;oBAAEyG,MAAM,EAAE,MAAM;oBAAExB,YAAY,EAAE,CAAC;oBAAEN,OAAO,EAAE,aAAa;oBAAE4E,MAAM,EAAE,SAAS;oBAAEtD,UAAU,EAAE;kBAAO,CAAE;kBAChJ8D,QAAQ,EAAElL,gBAAgB,CAACwB,IAAI,KAAK,CAAE;kBACtCwE,OAAO,EAAEA,CAAA,KAAM;oBACblG,iBAAiB,CAACD,cAAc,CAACgJ,MAAM,CAAC,CAAC+B,CAAC,EAAEC,CAAC,KAAK,CAAC7K,gBAAgB,CAAC8I,GAAG,CAAC+B,CAAC,CAAC,CAAC,CAAC;oBAC5E5K,mBAAmB,CAAC,IAAIC,GAAG,CAAC,CAAC,CAAC;kBAChC,CAAE;kBAAAiG,QAAA,EAEDrH,CAAC,CAAC,wBAAwB,CAAC,CAAC+I,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,EAAE;gBAAC;kBAAAf,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACrE,CAAC,eACTrJ,OAAA;kBACEkK,IAAI,EAAC,QAAQ;kBACbzC,KAAK,EAAE;oBAAE2E,UAAU,EAAE,SAAS;oBAAE7I,KAAK,EAAE,MAAM;oBAAEyG,MAAM,EAAE,MAAM;oBAAExB,YAAY,EAAE,CAAC;oBAAEN,OAAO,EAAE,aAAa;oBAAE4E,MAAM,EAAE,SAAS;oBAAEtD,UAAU,EAAE;kBAAO,CAAE;kBAChJpB,OAAO,EAAEA,CAAA,KAAM;oBACblG,iBAAiB,CAAC,EAAE,CAAC;oBACrBG,mBAAmB,CAAC,IAAIC,GAAG,CAAC,CAAC,CAAC;kBAChC,CAAE;kBAAAiG,QAAA,EAEDrH,CAAC,CAAC,mBAAmB,CAAC,CAAC+I,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,EAAE;gBAAC;kBAAAf,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAChE,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACN,CACN;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACH;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACD,CAAC,eACNrJ,OAAA;UAAKyH,KAAK,EAAE;YACVM,OAAO,EAAE,MAAM;YACfE,cAAc,EAAE,UAAU;YAC1BoF,SAAS,EAAErM,WAAW,GAAG,CAAC,GAAG,EAAE;YAC/B0G,QAAQ,EAAE1G,WAAW,IAAI2B,UAAU,CAACC,KAAK,GAAG,GAAG,GAAG,QAAQ,GAAG,QAAQ;YACrEwK,MAAM,EAAEpM,WAAW,IAAI2B,UAAU,CAACC,KAAK,GAAG,GAAG,GAAG,CAAC,GAAGc,SAAS;YAC7D0I,UAAU,EAAEpL,WAAW,IAAI2B,UAAU,CAACC,KAAK,GAAG,GAAG,GAAG,OAAO,GAAGc,SAAS;YACvEoE,MAAM,EAAE,EAAE;YACVY,aAAa,EAAE1H,WAAW,IAAI2B,UAAU,CAACC,KAAK,GAAG,GAAG,GAAG,CAAC,GAAG;UAC7D,CAAE;UAAA2F,QAAA,eACAvI,OAAA;YACEkK,IAAI,EAAC,QAAQ;YACbzC,KAAK,EAAE;cACL2E,UAAU,EAAE,SAAS;cACrB7I,KAAK,EAAE,MAAM;cACbyG,MAAM,EAAE,MAAM;cACdxB,YAAY,EAAE,CAAC;cACfN,OAAO,EAAElH,WAAW,IAAI2B,UAAU,CAACC,KAAK,GAAG,GAAG,GAAG,gBAAgB,GAAG,cAAc;cAClF4G,UAAU,EAAE,MAAM;cAClBD,QAAQ,EAAEvI,WAAW,IAAI2B,UAAU,CAACC,KAAK,GAAG,GAAG,GAAG,SAAS,GAAG,QAAQ;cACtEkK,MAAM,EAAE,SAAS;cACjB9D,SAAS,EAAE;YACb,CAAE;YAAAT,QAAA,EAEDrH,CAAC,CAAC,cAAc,CAAC,CAAC+I,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,IAAI;UAAM;YAAAf,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACrE;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACF,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACJ;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAAApI,EAAA,CArkBKN,YAAY;EAAA,QACFd,cAAc,EACVC,OAAO,EAgBiBF,OAAO;AAAA;AAAA2N,EAAA,GAlB7C5M,YAAY;AAukBlB,eAAeA,YAAY;AAAC,IAAA4M,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}