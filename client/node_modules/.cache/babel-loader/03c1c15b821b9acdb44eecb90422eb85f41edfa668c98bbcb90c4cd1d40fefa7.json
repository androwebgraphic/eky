{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/eky/client/src/components/pages/EditDogModal.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\nimport { useAuth } from '../../contexts/AuthContext';\nimport '../../css/edit-modal.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\nconst getImageUrl = url => {\n  if (!url) return '';\n  if (url.startsWith('/uploads/')) {\n    return `${API_URL}${url}`;\n  }\n  return url;\n};\nfunction EditDogModal({\n  dog,\n  onClose,\n  onSave,\n  modalPosition\n}) {\n  _s();\n  const isMounted = useRef(true);\n  const {\n    t\n  } = useTranslation();\n  const {\n    token\n  } = useAuth();\n  const [mediaFiles, setMediaFiles] = useState([]);\n  const [mediaPreviews, setMediaPreviews] = useState([]);\n  const [existingImages, setExistingImages] = useState(dog.images ? [...dog.images] : []);\n  const [selectedToDelete, setSelectedToDelete] = useState(new Set());\n  const [submitting, setSubmitting] = useState(false);\n  const [submitError, setSubmitError] = useState(null);\n  const {\n    register,\n    handleSubmit,\n    formState: {\n      errors\n    },\n    reset\n  } = useForm({\n    defaultValues: {\n      ...dog,\n      gender: dog.gender === 'male' || dog.gender === 'female' ? dog.gender : undefined\n    }\n  });\n\n  // Removed unused modalTop logic\n\n  useEffect(() => {\n    isMounted.current = true;\n    // Reset the form with the new dog data, ensuring gender is set correctly\n    reset({\n      ...dog,\n      gender: dog.gender === 'male' || dog.gender === 'female' ? dog.gender : undefined\n    });\n    setExistingImages(dog.images ? [...dog.images] : []);\n    return () => {\n      isMounted.current = false;\n    };\n  }, [dog, reset]);\n  const onSubmit = async fields => {\n    try {\n      if (!isMounted.current) return;\n      setSubmitting(true);\n      setSubmitError(null);\n      let resp;\n      const hasNewFiles = mediaFiles.length > 0;\n      const hasRemovedImages = existingImages.length !== (dog.images ? dog.images.length : 0);\n      const hasPhotoChanges = hasNewFiles || hasRemovedImages;\n      if (hasPhotoChanges) {\n        const formData = new FormData();\n        Object.entries(fields).forEach(([k, v]) => {\n          if (typeof v !== 'undefined' && v !== '') formData.append(k, v);\n        });\n        const keepImagesData = JSON.stringify(existingImages.map(img => img.url));\n        formData.append('keepImages', keepImagesData);\n        mediaFiles.forEach(file => {\n          formData.append('media', file, file.name);\n        });\n        const headers = {};\n        if (token) {\n          headers['Authorization'] = `Bearer ${token}`;\n        }\n        try {\n          resp = await fetch(`${API_URL}/api/dogs/${dog._id}`, {\n            method: 'PATCH',\n            body: formData,\n            headers\n          });\n        } catch (fetchErr) {\n          if (isMounted.current) {\n            setSubmitError('Failed to upload images. Please check your connection or try again.');\n            setSubmitting(false);\n          }\n          return;\n        }\n      } else {\n        const bodyData = {};\n        Object.entries(fields).forEach(([k, v]) => {\n          if (typeof v !== 'undefined' && v !== '') bodyData[k] = v;\n        });\n        const headers = {\n          'Content-Type': 'application/json'\n        };\n        if (token) {\n          headers['Authorization'] = `Bearer ${token}`;\n        }\n        resp = await fetch(`${API_URL}/api/dogs/${dog._id}`, {\n          method: 'PATCH',\n          headers,\n          body: JSON.stringify(bodyData)\n        });\n      }\n      if (!resp.ok) {\n        const errData = await resp.json().catch(() => ({}));\n        throw new Error(errData.message || 'Failed to update dog');\n      }\n      if (isMounted.current) {\n        setMediaFiles([]);\n        setMediaPreviews([]);\n      }\n    } catch (err) {\n      if (isMounted.current) {\n        setSubmitError(err.message || 'Failed to update dog');\n        setSubmitting(false);\n      }\n    }\n    // No return here, just logic\n  };\n\n  // Return the modal JSX\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"editdog-modal-overlay\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editdog-modal-content\",\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(onSubmit)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 130,\n    columnNumber: 5\n  }, this);\n}\n_s(EditDogModal, \"hfe1F1p1t9lRvY7g4TwYqj5/x20=\", false, function () {\n  return [useTranslation, useAuth, useForm];\n});\n_c = EditDogModal;\nexport default EditDogModal;\nvar _c;\n$RefreshReg$(_c, \"EditDogModal\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useForm","useTranslation","useAuth","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","getImageUrl","url","startsWith","EditDogModal","dog","onClose","onSave","modalPosition","_s","isMounted","t","token","mediaFiles","setMediaFiles","mediaPreviews","setMediaPreviews","existingImages","setExistingImages","images","selectedToDelete","setSelectedToDelete","Set","submitting","setSubmitting","submitError","setSubmitError","register","handleSubmit","formState","errors","reset","defaultValues","gender","undefined","current","onSubmit","fields","resp","hasNewFiles","length","hasRemovedImages","hasPhotoChanges","formData","FormData","Object","entries","forEach","k","v","append","keepImagesData","JSON","stringify","map","img","file","name","headers","fetch","_id","method","body","fetchErr","bodyData","ok","errData","json","catch","Error","message","err","className","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Applications/MAMP/htdocs/eky/client/src/components/pages/EditDogModal.tsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\nimport { useForm, SubmitHandler } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\nimport { useAuth } from '../../contexts/AuthContext';\nimport '../../css/edit-modal.css';\n\ninterface EditDogFormData {\n  name: string;\n  breed?: string;\n  color?: string;\n  location?: string;\n  age?: number;\n  description?: string;\n  size?: 'small' | 'medium' | 'large';\n  gender?: 'male' | 'female';\n  vaccinated?: boolean;\n  neutered?: boolean;\n}\n\ninterface EditDogModalProps {\n  dog: any;\n  onClose: () => void;\n  onSave: (updatedDog: any) => void;\n  modalPosition?: {x: number, y: number};\n}\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';\nconst getImageUrl = (url: string) => {\n  if (!url) return '';\n  if (url.startsWith('/uploads/')) {\n    return `${API_URL}${url}`;\n  }\n  return url;\n};\n\nfunction EditDogModal({ dog, onClose, onSave, modalPosition }: EditDogModalProps) {\n  const isMounted = useRef(true);\n  const { t } = useTranslation();\n  const { token } = useAuth();\n  const [mediaFiles, setMediaFiles] = useState<File[]>([]);\n  const [mediaPreviews, setMediaPreviews] = useState<string[]>([]);\n  const [existingImages, setExistingImages] = useState<any[]>(dog.images ? [...dog.images] : []);\n  const [selectedToDelete, setSelectedToDelete] = useState<Set<number>>(new Set());\n  const [submitting, setSubmitting] = useState(false);\n  const [submitError, setSubmitError] = useState<string | null>(null);\n  const { register, handleSubmit, formState: { errors }, reset } = useForm<EditDogFormData>({ defaultValues: { ...dog, gender: dog.gender === 'male' || dog.gender === 'female' ? dog.gender : undefined } });\n\n  // Removed unused modalTop logic\n\n  useEffect(() => {\n    isMounted.current = true;\n    // Reset the form with the new dog data, ensuring gender is set correctly\n    reset({ ...dog, gender: dog.gender === 'male' || dog.gender === 'female' ? dog.gender : undefined });\n    setExistingImages(dog.images ? [...dog.images] : []);\n    return () => {\n      isMounted.current = false;\n    };\n  }, [dog, reset]);\n\n  const onSubmit: SubmitHandler<EditDogFormData> = async (fields) => {\n    try {\n      if (!isMounted.current) return;\n      setSubmitting(true);\n      setSubmitError(null);\n      let resp;\n      const hasNewFiles = mediaFiles.length > 0;\n      const hasRemovedImages = existingImages.length !== (dog.images ? dog.images.length : 0);\n      const hasPhotoChanges = hasNewFiles || hasRemovedImages;\n      if (hasPhotoChanges) {\n        const formData = new FormData();\n        Object.entries(fields).forEach(([k, v]) => {\n          if (typeof v !== 'undefined' && v !== '') formData.append(k, v as any);\n        });\n        const keepImagesData = JSON.stringify(existingImages.map(img => img.url));\n        formData.append('keepImages', keepImagesData);\n        mediaFiles.forEach((file) => {\n          formData.append('media', file, file.name);\n        });\n        const headers: any = {};\n        if (token) {\n          headers['Authorization'] = `Bearer ${token}`;\n        }\n        try {\n          resp = await fetch(`${API_URL}/api/dogs/${dog._id}`, {\n            method: 'PATCH',\n            body: formData,\n            headers\n          });\n        } catch (fetchErr) {\n          if (isMounted.current) {\n            setSubmitError('Failed to upload images. Please check your connection or try again.');\n            setSubmitting(false);\n          }\n          return;\n        }\n      } else {\n        const bodyData: any = {};\n        Object.entries(fields).forEach(([k, v]) => {\n          if (typeof v !== 'undefined' && v !== '') bodyData[k] = v;\n        });\n        const headers: any = { 'Content-Type': 'application/json' };\n        if (token) {\n          headers['Authorization'] = `Bearer ${token}`;\n        }\n        resp = await fetch(`${API_URL}/api/dogs/${dog._id}`, {\n          method: 'PATCH',\n          headers,\n          body: JSON.stringify(bodyData)\n        });\n      }\n      if (!resp.ok) {\n        const errData = await resp.json().catch(() => ({}));\n        throw new Error(errData.message || 'Failed to update dog');\n      }\n      if (isMounted.current) {\n        setMediaFiles([]);\n        setMediaPreviews([]);\n      }\n    } catch (err) {\n      if (isMounted.current) {\n        setSubmitError((err as Error).message || 'Failed to update dog');\n        setSubmitting(false);\n      }\n    }\n    // No return here, just logic\n  };\n\n  // Return the modal JSX\n  return (\n    <div className=\"editdog-modal-overlay\">\n      <div className=\"editdog-modal-content\">\n        <form onSubmit={handleSubmit(onSubmit)}>\n          {/* ...existing form fields and layout... */}\n          {/* You may want to restore the form fields here if they were lost in previous edits. */}\n        </form>\n      </div>\n    </div>\n  );\n}\n\nexport default EditDogModal;\n\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}