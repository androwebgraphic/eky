{"ast":null,"code":"import _objectSpread from\"/Applications/MAMP/htdocs/eky/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useForm}from'react-hook-form';import{useTranslation}from'react-i18next';import{useNavigate}from'react-router-dom';import{useAuth}from'../../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";// Simple, reliable API URL for mobile\nconst API_URL=process.env.REACT_APP_API_URL||(window.location.protocol==='https:'?\"https://\".concat(window.location.hostname):window.location.hostname==='localhost'||window.location.hostname==='127.0.0.1'?'http://localhost:3001':'http://172.20.10.2:3001');const AdddogForm=()=>{const{t}=useTranslation();const{token,isAuthenticated}=useAuth();const{register,handleSubmit,formState:{errors}}=useForm({defaultValues:{vaccinated:false,neutered:false}});const navigate=useNavigate();const isMountedRef=useRef(true);useEffect(()=>{console.log('ðŸ” AddDogForm auth state:',{isAuthenticated,hasToken:!!token,tokenLength:token===null||token===void 0?void 0:token.length});if(!isAuthenticated||!token){console.warn('âš ï¸ User not authenticated, redirecting to login');navigate('/logiranje');}},[isAuthenticated,token,navigate]);useEffect(()=>{return()=>{isMountedRef.current=false;};},[]);const[mediaFiles,setMediaFiles]=useState([]);const[mediaPreviews,setMediaPreviews]=useState([]);const[smallPreviews,setSmallPreviews]=useState([]);const[isVideo,setIsVideo]=useState(false);// Only for single video, not for images\nconst[posterBlob,setPosterBlob]=useState(null);// create poster image for a video file by capturing first frame in browser\nconst createVideoPoster=file=>{return new Promise((resolve,reject)=>{const url=URL.createObjectURL(file);const video=document.createElement('video');video.preload='metadata';video.muted=true;video.src=url;// attempt to jump to 1s so a frame is available\nvideo.currentTime=1;const cleanup=()=>URL.revokeObjectURL(url);video.onloadeddata=function(){const canvas=document.createElement('canvas');canvas.width=video.videoWidth||640;canvas.height=video.videoHeight||360;const ctx=canvas.getContext('2d');if(!ctx)return reject(new Error('Canvas not supported'));ctx.drawImage(video,0,0,canvas.width,canvas.height);canvas.toBlob(blob=>{cleanup();if(blob)resolve(blob);else reject(new Error('Could not create poster'));},'image/jpeg',0.8);};video.onerror=e=>{cleanup();reject(e);};});};// create a small thumbnail for image preview (data URL)\nconst createImageThumbnail=function(file){let size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:64;return new Promise((resolve,reject)=>{const img=new Image();const url=URL.createObjectURL(file);img.onload=()=>{const ratio=img.width/img.height||1;let width=size;let height=Math.round(size/ratio);if(ratio<1){// portrait\nheight=size;width=Math.round(size*ratio);}const canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;const ctx=canvas.getContext('2d');if(!ctx){URL.revokeObjectURL(url);return reject(new Error('Canvas not supported'));}ctx.drawImage(img,0,0,width,height);const dataUrl=canvas.toDataURL('image/jpeg',0.7);URL.revokeObjectURL(url);resolve(dataUrl);};img.onerror=e=>{URL.revokeObjectURL(url);reject(e);};img.src=url;});};const onFileChange=async e=>{const files=e.target.files?Array.from(e.target.files):[];if(!files.length)return;setMediaFiles(files);// Clean up previous previews\nmediaPreviews.forEach(url=>{if(url.startsWith('blob:'))URL.revokeObjectURL(url);});setMediaPreviews([]);setSmallPreviews([]);const previews=[];const thumbs=[];for(const f of files){const url=URL.createObjectURL(f);previews.push(url);if(f.type.startsWith('image/')){try{const thumb=await createImageThumbnail(f,64);thumbs.push(thumb);}catch(err){thumbs.push('');}}else{thumbs.push('');}}setMediaPreviews(previews);setSmallPreviews(thumbs);setIsVideo(files.length===1&&files[0].type.startsWith('video/'));// Poster logic for video can be added if needed\n};const[submitting,setSubmitting]=useState(false);const[submitError,setSubmitError]=useState(null);const[successMessage,setSuccessMessage]=useState(null);const abortControllerRef=useRef(null);useEffect(()=>{return()=>{isMountedRef.current=false;// Cancel any pending fetch requests\nif(abortControllerRef.current){abortControllerRef.current.abort();}};},[]);const onSubmit=async fields=>{var _fields$name,_fields$location;console.log('Form submit triggered with fields:',fields);// Basic validation\nif(!((_fields$name=fields.name)!==null&&_fields$name!==void 0&&_fields$name.trim())){setSubmitError(t('adddog.nameRequired'));return;}if(!((_fields$location=fields.location)!==null&&_fields$location!==void 0&&_fields$location.trim())){setSubmitError(t('adddog.locationRequired'));return;}try{setSubmitting(true);setSubmitError(null);console.log('Form data will be sent to:',API_URL);console.log('Current hostname:',window.location.hostname);console.log('Window location:',window.location.href);const formData=new FormData();formData.append('name',fields.name);if(fields.breed)formData.append('breed',fields.breed);if(fields.color)formData.append('color',fields.color);if(fields.age!==undefined)formData.append('age',String(fields.age));if(fields.description)formData.append('description',fields.description);if(fields.size)formData.append('size',fields.size);if(fields.location)formData.append('location',fields.location);// Always send boolean values for checkboxes\nformData.append('vaccinated',fields.vaccinated?'true':'false');formData.append('neutered',fields.neutered?'true':'false');if(mediaFiles.length){mediaFiles.forEach((file,idx)=>{formData.append('media',file,file.name);});// Poster logic for video can be added here if needed\n}console.log('Submitting to:',\"\".concat(API_URL,\"/api/dogs\"));console.log('Form data fields:',Object.fromEntries(formData.entries()));console.log('Media files present:',mediaFiles.length);console.log('ðŸ”‘ Token present:',!!token);console.log('ðŸ”‘ Token value:',token?\"\".concat(token.substring(0,20),\"...\"):'NO TOKEN');abortControllerRef.current=new AbortController();const headers={// Don't set Content-Type for FormData, let browser set it with boundary\n};if(token){headers['Authorization']=\"Bearer \".concat(token);console.log('âœ… Authorization header set');}else{console.error('âŒ NO TOKEN - Authorization header NOT set');}const resp=await fetch(\"\".concat(API_URL,\"/api/dogs\"),{method:'POST',body:formData,signal:abortControllerRef.current.signal,headers}).catch(async firstError=>{// If initial fetch fails on mobile, try fallback URLs\nconsole.warn('First fetch failed, trying fallback:',firstError.message);const fallbackUrls=['http://172.20.10.2:3001/api/dogs',// Direct IP\n'http://localhost:3001/api/dogs'// Localhost fallback\n];for(const fallbackUrl of fallbackUrls){try{console.log('Trying fallback URL:',fallbackUrl);const fallbackResp=await fetch(fallbackUrl,{method:'POST',body:formData,signal:abortControllerRef.current.signal,headers});console.log('Fallback succeeded:',fallbackUrl);return fallbackResp;}catch(fallbackError){console.warn('Fallback failed:',fallbackUrl,fallbackError.message);}}// If all fallbacks fail, throw the original error\nthrow firstError;});if(!resp.ok){// try to get JSON message\nlet errMsg=\"Upload failed with status \".concat(resp.status,\" (\").concat(resp.statusText,\")\");console.error('Response not OK:',resp.status,resp.statusText);try{const body=await resp.json();console.error('Error body:',body);errMsg=body.message||JSON.stringify(body);}catch(e){console.error('Could not parse error as JSON:',e);const txt=await resp.text();console.error('Error text:',txt);if(txt)errMsg=txt.substring(0,200);// limit error message length\n}console.error('API error:',errMsg);setSubmitError(errMsg);throw new Error(errMsg);}// success â†’ show confirmation and then go to list\nif(isMountedRef.current){setSuccessMessage(t('adddog.added'));// keep message visible briefly before navigating\nsetTimeout(()=>{if(isMountedRef.current)navigate('/psi');},1400);}}catch(err){// Ignore abort errors (expected when component unmounts)\nif(err.name==='AbortError'){console.log('Request was aborted (component unmounted)');return;}console.error('Add dog failed:',err);console.error('Error type:',err.name);console.error('Error message:',err.message);console.error('Full error:',err);let errorMessage=t('adddog.failed');if(err.message){errorMessage+=\": \".concat(err.message);}if(isMountedRef.current&&!submitError){setSubmitError(errorMessage);}}finally{if(isMountedRef.current)setSubmitting(false);}};return/*#__PURE__*/_jsxs(\"main\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:t('adddog.title')}),/*#__PURE__*/_jsxs(\"form\",{id:\"adddog-form\",onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"adddog-name\",children:t('adddog.name')}),/*#__PURE__*/_jsx(\"input\",_objectSpread({type:\"text\",id:\"adddog-name\",name:\"name\",autoComplete:\"name\",placeholder:t('adddog.name')},register('name',{required:true}))),errors.name&&/*#__PURE__*/_jsxs(\"div\",{className:\"error\",role:\"alert\",children:[t('adddog.name'),\" is required\"]}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"adddog-breed\",children:t('adddog.breed')}),/*#__PURE__*/_jsx(\"input\",_objectSpread({type:\"text\",id:\"adddog-breed\",name:\"breed\",autoComplete:\"off\",placeholder:t('adddog.breed')},register('breed'))),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"adddog-color\",children:t('adddog.color')}),/*#__PURE__*/_jsx(\"input\",_objectSpread({type:\"text\",id:\"adddog-color\",name:\"color\",autoComplete:\"off\",placeholder:t('adddog.color')},register('color'))),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"adddog-location\",children:t('adddog.location')}),/*#__PURE__*/_jsx(\"input\",_objectSpread({type:\"text\",id:\"adddog-location\",name:\"location\",autoComplete:\"address-level2\",placeholder:t('adddog.location')},register('location',{required:true}))),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"adddog-age\",children:t('adddog.age')}),/*#__PURE__*/_jsx(\"small\",{children:t('adddogExtra.ageNote')}),/*#__PURE__*/_jsx(\"input\",_objectSpread({type:\"number\",id:\"adddog-age\",name:\"age\",autoComplete:\"off\",placeholder:t('adddog.age'),step:\"0.1\"},register('age',{valueAsNumber:true}))),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"adddog-media\",children:t('adddog.photos')}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"adddog-media\",name:\"media\",accept:\"image/*,video/*\",multiple:true,onChange:onFileChange}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexWrap:'wrap',gap:8,margin:'8px 0'},children:mediaPreviews.map((url,idx)=>/*#__PURE__*/_jsx(\"img\",{src:url,alt:\"preview-\".concat(idx),style:{width:64,height:64,objectFit:'cover',borderRadius:8,border:'1px solid #ccc'}},url))}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"adddog-description\",children:t('adddog.description')}),/*#__PURE__*/_jsx(\"textarea\",_objectSpread({id:\"adddog-description\",name:\"description\",rows:3,cols:30,autoComplete:\"off\",placeholder:t('adddog.description')},register('description'))),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"adddog-size\",children:t('adddog.size')}),/*#__PURE__*/_jsxs(\"select\",_objectSpread(_objectSpread({},register('size')),{},{id:\"adddog-size\",name:\"size\",autoComplete:\"off\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"small\",children:t('size.small')}),/*#__PURE__*/_jsx(\"option\",{value:\"medium\",children:t('size.medium')}),/*#__PURE__*/_jsx(\"option\",{value:\"large\",children:t('size.large')})]})),/*#__PURE__*/_jsxs(\"div\",{id:\"gender\",children:[/*#__PURE__*/_jsx(\"label\",{children:t('adddog.gender')}),/*#__PURE__*/_jsxs(\"div\",{className:\"gender-options\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"adddog-gender-male\",children:[/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({type:\"radio\"},register('gender')),{},{id:\"adddog-gender-male\",name:\"gender\",value:\"male\"})),/*#__PURE__*/_jsx(\"span\",{children:t('gender.male')})]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"adddog-gender-female\",children:[/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({type:\"radio\"},register('gender')),{},{id:\"adddog-gender-female\",name:\"gender\",value:\"female\"})),/*#__PURE__*/_jsx(\"span\",{children:t('gender.female')})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{id:\"health\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"adddog-vaccinated\",children:[/*#__PURE__*/_jsx(\"span\",{children:t('adddog.vaccinated')}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({type:\"checkbox\"},register('vaccinated')),{},{id:\"adddog-vaccinated\",name:\"vaccinated\"}))]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"adddog-neutered\",children:[/*#__PURE__*/_jsx(\"span\",{children:t('adddog.neutered')}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({type:\"checkbox\"},register('neutered')),{},{id:\"adddog-neutered\",name:\"neutered\"}))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:submitting,children:submitting?t('adddog.saving'):t('button.addDog')}),submitError&&/*#__PURE__*/_jsx(\"div\",{className:\"error\",role:\"alert\",children:submitError}),successMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"notification success\",role:\"status\",children:successMessage})]})]})]});};export default AdddogForm;","map":{"version":3,"names":["React","useState","useEffect","useRef","useForm","useTranslation","useNavigate","useAuth","jsx","_jsx","jsxs","_jsxs","API_URL","process","env","REACT_APP_API_URL","window","location","protocol","concat","hostname","AdddogForm","t","token","isAuthenticated","register","handleSubmit","formState","errors","defaultValues","vaccinated","neutered","navigate","isMountedRef","console","log","hasToken","tokenLength","length","warn","current","mediaFiles","setMediaFiles","mediaPreviews","setMediaPreviews","smallPreviews","setSmallPreviews","isVideo","setIsVideo","posterBlob","setPosterBlob","createVideoPoster","file","Promise","resolve","reject","url","URL","createObjectURL","video","document","createElement","preload","muted","src","currentTime","cleanup","revokeObjectURL","onloadeddata","canvas","width","videoWidth","height","videoHeight","ctx","getContext","Error","drawImage","toBlob","blob","onerror","e","createImageThumbnail","size","arguments","undefined","img","Image","onload","ratio","Math","round","dataUrl","toDataURL","onFileChange","files","target","Array","from","forEach","startsWith","previews","thumbs","f","push","type","thumb","err","submitting","setSubmitting","submitError","setSubmitError","successMessage","setSuccessMessage","abortControllerRef","abort","onSubmit","fields","_fields$name","_fields$location","name","trim","href","formData","FormData","append","breed","color","age","String","description","idx","Object","fromEntries","entries","substring","AbortController","headers","error","resp","fetch","method","body","signal","catch","firstError","message","fallbackUrls","fallbackUrl","fallbackResp","fallbackError","ok","errMsg","status","statusText","json","JSON","stringify","txt","text","setTimeout","errorMessage","children","id","htmlFor","_objectSpread","autoComplete","placeholder","required","className","role","step","valueAsNumber","accept","multiple","onChange","style","display","flexWrap","gap","margin","map","alt","objectFit","borderRadius","border","rows","cols","value","disabled"],"sources":["/Applications/MAMP/htdocs/eky/client/src/components/pages/AdddogForm.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useForm, SubmitHandler } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../../contexts/AuthContext';\n\ninterface AddDogFormData {\n  name: string;\n  breed: string;\n  color?: string;\n  location: string;\n  age: number;\n  description: string;\n  size: 'small' | 'medium' | 'large';\n  gender?: 'male' | 'female';\n  vaccinated?: boolean;\n  neutered?: boolean;\n}\n\n// Simple, reliable API URL for mobile\nconst API_URL = process.env.REACT_APP_API_URL ||\n  (window.location.protocol === 'https:'\n    ? `https://${window.location.hostname}`\n    : (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'\n      ? 'http://localhost:3001'\n      : 'http://172.20.10.2:3001'));\n\nconst AdddogForm: React.FC = () => {\n  const { t } = useTranslation();\n  const { token, isAuthenticated } = useAuth();\n  const { register, handleSubmit, formState: { errors } } = useForm<AddDogFormData>({\n    defaultValues: {\n      vaccinated: false,\n      neutered: false,\n    }\n  });\n  const navigate = useNavigate();\n  const isMountedRef = useRef(true);\n\n  useEffect(() => {\n    console.log('ðŸ” AddDogForm auth state:', { isAuthenticated, hasToken: !!token, tokenLength: token?.length });\n    \n    if (!isAuthenticated || !token) {\n      console.warn('âš ï¸ User not authenticated, redirecting to login');\n      navigate('/logiranje');\n    }\n  }, [isAuthenticated, token, navigate]);\n\n  useEffect(() => {\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, []);\n\n  const [mediaFiles, setMediaFiles] = useState<File[]>([]);\n  const [mediaPreviews, setMediaPreviews] = useState<string[]>([]);\n  const [smallPreviews, setSmallPreviews] = useState<string[]>([]);\n  const [isVideo, setIsVideo] = useState(false); // Only for single video, not for images\n  const [posterBlob, setPosterBlob] = useState<Blob | null>(null);\n\n  // create poster image for a video file by capturing first frame in browser\n  const createVideoPoster = (file: File): Promise<Blob> => {\n    return new Promise((resolve, reject) => {\n      const url = URL.createObjectURL(file);\n      const video = document.createElement('video');\n      video.preload = 'metadata';\n      video.muted = true;\n      video.src = url;\n      // attempt to jump to 1s so a frame is available\n      video.currentTime = 1;\n      const cleanup = () => URL.revokeObjectURL(url);\n\n      video.onloadeddata = function () {\n        const canvas = document.createElement('canvas');\n        canvas.width = video.videoWidth || 640;\n        canvas.height = video.videoHeight || 360;\n        const ctx = canvas.getContext('2d');\n        if (!ctx) return reject(new Error('Canvas not supported'));\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n        canvas.toBlob((blob) => {\n          cleanup();\n          if (blob) resolve(blob);\n          else reject(new Error('Could not create poster'));\n        }, 'image/jpeg', 0.8);\n      };\n      video.onerror = (e) => {\n        cleanup();\n        reject(e);\n      };\n    });\n  };\n\n  // create a small thumbnail for image preview (data URL)\n  const createImageThumbnail = (file: File, size = 64): Promise<string> => {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      const url = URL.createObjectURL(file);\n      img.onload = () => {\n        const ratio = img.width / img.height || 1;\n        let width = size;\n        let height = Math.round(size / ratio);\n        if (ratio < 1) {\n          // portrait\n          height = size;\n          width = Math.round(size * ratio);\n        }\n        const canvas = document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n          URL.revokeObjectURL(url);\n          return reject(new Error('Canvas not supported'));\n        }\n        ctx.drawImage(img, 0, 0, width, height);\n        const dataUrl = canvas.toDataURL('image/jpeg', 0.7);\n        URL.revokeObjectURL(url);\n        resolve(dataUrl);\n      };\n      img.onerror = (e) => {\n        URL.revokeObjectURL(url);\n        reject(e);\n      };\n      img.src = url;\n    });\n  };\n\n  const onFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files ? Array.from(e.target.files) : [];\n    if (!files.length) return;\n    setMediaFiles(files);\n\n    // Clean up previous previews\n    mediaPreviews.forEach(url => { if (url.startsWith('blob:')) URL.revokeObjectURL(url); });\n    setMediaPreviews([]);\n    setSmallPreviews([]);\n\n    const previews: string[] = [];\n    const thumbs: string[] = [];\n    for (const f of files) {\n      const url = URL.createObjectURL(f);\n      previews.push(url);\n      if (f.type.startsWith('image/')) {\n        try {\n          const thumb = await createImageThumbnail(f, 64);\n          thumbs.push(thumb);\n        } catch (err) {\n          thumbs.push('');\n        }\n      } else {\n        thumbs.push('');\n      }\n    }\n    setMediaPreviews(previews);\n    setSmallPreviews(thumbs);\n    setIsVideo(files.length === 1 && files[0].type.startsWith('video/'));\n    // Poster logic for video can be added if needed\n  };\n\n  const [submitting, setSubmitting] = useState(false);\n  const [submitError, setSubmitError] = useState<string | null>(null);\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n  const abortControllerRef = useRef<AbortController | null>(null);\n\n  useEffect(() => {\n    return () => {\n      isMountedRef.current = false;\n      // Cancel any pending fetch requests\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    };\n  }, []);\n\n  const onSubmit: SubmitHandler<AddDogFormData> = async (fields) => {\n    console.log('Form submit triggered with fields:', fields);\n    \n    // Basic validation\n    if (!fields.name?.trim()) {\n      setSubmitError(t('adddog.nameRequired'));\n      return;\n    }\n    if (!fields.location?.trim()) {\n      setSubmitError(t('adddog.locationRequired'));\n      return;\n    }\n    \n    try {\n      setSubmitting(true);\n      setSubmitError(null);\n\n      console.log('Form data will be sent to:', API_URL);\n      console.log('Current hostname:', window.location.hostname);\n      console.log('Window location:', window.location.href);\n\n      const formData = new FormData();\n      formData.append('name', fields.name);\n      if (fields.breed) formData.append('breed', fields.breed);\n      if (fields.color) formData.append('color', fields.color);\n      if (fields.age !== undefined) formData.append('age', String(fields.age));\n      if (fields.description) formData.append('description', fields.description);\n      if (fields.size) formData.append('size', fields.size);\n      if (fields.location) formData.append('location', fields.location);\n\n      // Always send boolean values for checkboxes\n      formData.append('vaccinated', fields.vaccinated ? 'true' : 'false');\n      formData.append('neutered', fields.neutered ? 'true' : 'false');\n\n      if (mediaFiles.length) {\n        mediaFiles.forEach((file, idx) => {\n          formData.append('media', file, file.name);\n        });\n        // Poster logic for video can be added here if needed\n      }\n\n      console.log('Submitting to:', `${API_URL}/api/dogs`);\n      console.log('Form data fields:', Object.fromEntries(formData.entries()));\n      console.log('Media files present:', mediaFiles.length);\n      console.log('ðŸ”‘ Token present:', !!token);\n      console.log('ðŸ”‘ Token value:', token ? `${token.substring(0, 20)}...` : 'NO TOKEN');\n      \n      abortControllerRef.current = new AbortController();\n      \n      const headers: any = {\n        // Don't set Content-Type for FormData, let browser set it with boundary\n      };\n      \n      if (token) {\n        headers['Authorization'] = `Bearer ${token}`;\n        console.log('âœ… Authorization header set');\n      } else {\n        console.error('âŒ NO TOKEN - Authorization header NOT set');\n      }\n      \n      const resp = await fetch(`${API_URL}/api/dogs`, {\n        method: 'POST',\n        body: formData,\n        signal: abortControllerRef.current.signal,\n        headers\n      }).catch(async (firstError) => {\n        // If initial fetch fails on mobile, try fallback URLs\n        console.warn('First fetch failed, trying fallback:', firstError.message);\n        \n        const fallbackUrls = [\n          'http://172.20.10.2:3001/api/dogs',  // Direct IP\n          'http://localhost:3001/api/dogs'      // Localhost fallback\n        ];\n        \n        for (const fallbackUrl of fallbackUrls) {\n          try {\n            console.log('Trying fallback URL:', fallbackUrl);\n            const fallbackResp = await fetch(fallbackUrl, {\n              method: 'POST',\n              body: formData,\n              signal: abortControllerRef.current.signal,\n              headers\n            });\n            console.log('Fallback succeeded:', fallbackUrl);\n            return fallbackResp;\n          } catch (fallbackError) {\n            console.warn('Fallback failed:', fallbackUrl, fallbackError.message);\n          }\n        }\n        \n        // If all fallbacks fail, throw the original error\n        throw firstError;\n      });\n\n      if (!resp.ok) {\n        // try to get JSON message\n        let errMsg = `Upload failed with status ${resp.status} (${resp.statusText})`;\n        console.error('Response not OK:', resp.status, resp.statusText);\n        try {\n          const body = await resp.json();\n          console.error('Error body:', body);\n          errMsg = body.message || JSON.stringify(body);\n        } catch (e) {\n          console.error('Could not parse error as JSON:', e);\n          const txt = await resp.text();\n          console.error('Error text:', txt);\n          if (txt) errMsg = txt.substring(0, 200); // limit error message length\n        }\n        console.error('API error:', errMsg);\n        setSubmitError(errMsg);\n        throw new Error(errMsg);\n      }\n\n      // success â†’ show confirmation and then go to list\n      if (isMountedRef.current) {\n        setSuccessMessage(t('adddog.added'));\n        // keep message visible briefly before navigating\n        setTimeout(() => { \n          if (isMountedRef.current) navigate('/psi'); \n        }, 1400);\n      }\n    } catch (err: any) {\n      // Ignore abort errors (expected when component unmounts)\n      if (err.name === 'AbortError') {\n        console.log('Request was aborted (component unmounted)');\n        return;\n      }\n      \n      console.error('Add dog failed:', err);\n      console.error('Error type:', err.name);\n      console.error('Error message:', err.message);\n      console.error('Full error:', err);\n      \n      let errorMessage = t('adddog.failed');\n      if (err.message) {\n        errorMessage += `: ${err.message}`;\n      }\n      \n      if (isMountedRef.current && !submitError) {\n        setSubmitError(errorMessage);\n      }\n    } finally {\n      if (isMountedRef.current) setSubmitting(false);\n    }\n  };\n\n  return (\n    <main>\n      <h2>{t('adddog.title')}</h2>\n      <form id=\"adddog-form\" onSubmit={handleSubmit(onSubmit)}>\n        <label htmlFor=\"adddog-name\">{t('adddog.name')}</label>\n        <input type=\"text\" id=\"adddog-name\" name=\"name\" autoComplete=\"name\" placeholder={t('adddog.name')} {...register('name', { required: true })} />\n        {errors.name && <div className=\"error\" role=\"alert\">{t('adddog.name')} is required</div> }\n\n        <label htmlFor=\"adddog-breed\">{t('adddog.breed')}</label>\n        <input type=\"text\" id=\"adddog-breed\" name=\"breed\" autoComplete=\"off\" placeholder={t('adddog.breed')} {...register('breed')} />\n\n        <label htmlFor=\"adddog-color\">{t('adddog.color')}</label>\n        <input type=\"text\" id=\"adddog-color\" name=\"color\" autoComplete=\"off\" placeholder={t('adddog.color')} {...register('color')} />\n\n        <label htmlFor=\"adddog-location\">{t('adddog.location')}</label>\n        <input type=\"text\" id=\"adddog-location\" name=\"location\" autoComplete=\"address-level2\" placeholder={t('adddog.location')} {...register('location', { required: true })} />\n\n        <label htmlFor=\"adddog-age\">{t('adddog.age')}</label>\n        <small>{t('adddogExtra.ageNote')}</small>\n        <input type=\"number\" id=\"adddog-age\" name=\"age\" autoComplete=\"off\" placeholder={t('adddog.age')} step=\"0.1\" {...register('age', { valueAsNumber: true })} />\n\n        <label htmlFor=\"adddog-media\">{t('adddog.photos')}</label>\n        <input type=\"file\" id=\"adddog-media\" name=\"media\" accept=\"image/*,video/*\" multiple onChange={onFileChange} />\n        <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8, margin: '8px 0' }}>\n          {mediaPreviews.map((url, idx) => (\n            <img key={url} src={url} alt={`preview-${idx}`} style={{ width: 64, height: 64, objectFit: 'cover', borderRadius: 8, border: '1px solid #ccc' }} />\n          ))}\n        </div>\n\n\n        <label htmlFor=\"adddog-description\">{t('adddog.description')}</label>\n        <textarea id=\"adddog-description\" name=\"description\" rows={3} cols={30} autoComplete=\"off\" placeholder={t('adddog.description')} {...register('description')} />\n\n        <label htmlFor=\"adddog-size\">{t('adddog.size')}</label>\n        <select {...register('size')} id=\"adddog-size\" name=\"size\" autoComplete=\"off\">\n          <option value=\"small\">{t('size.small')}</option>\n          <option value=\"medium\">{t('size.medium')}</option>\n          <option value=\"large\">{t('size.large')}</option>\n        </select>\n\n        <div id=\"gender\">\n          <label>{t('adddog.gender')}</label>\n          <div className=\"gender-options\">\n            <label htmlFor=\"adddog-gender-male\">\n              <input type=\"radio\" {...register('gender')} id=\"adddog-gender-male\" name=\"gender\" value=\"male\" />\n              <span>{t('gender.male')}</span>\n            </label>\n            <label htmlFor=\"adddog-gender-female\">\n              <input type=\"radio\" {...register('gender')} id=\"adddog-gender-female\" name=\"gender\" value=\"female\" />\n              <span>{t('gender.female')}</span>\n            </label>\n          </div>\n        </div>\n\n        <div id=\"health\">\n          <label htmlFor=\"adddog-vaccinated\">\n            <span>{t('adddog.vaccinated')}</span>\n            <input type=\"checkbox\" {...register('vaccinated')} id=\"adddog-vaccinated\" name=\"vaccinated\" />\n          </label>\n\n          <label htmlFor=\"adddog-neutered\">\n            <span>{t('adddog.neutered')}</span>\n            <input type=\"checkbox\" {...register('neutered')} id=\"adddog-neutered\" name=\"neutered\" />\n          </label>\n        </div>\n\n        <div className=\"form-actions\">\n          <button type=\"submit\" disabled={submitting}>{submitting ? t('adddog.saving') : t('button.addDog')}</button>\n          {submitError && <div className=\"error\" role=\"alert\">{submitError}</div>}\n          {successMessage && <div className=\"notification success\" role=\"status\">{successMessage}</div>}\n        </div>\n      </form>\n    </main>\n  );\n};\n\nexport default AdddogForm;\n"],"mappings":"yHAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAC1D,OAASC,OAAO,KAAuB,iBAAiB,CACxD,OAASC,cAAc,KAAQ,eAAe,CAC9C,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,OAAO,KAAQ,4BAA4B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAerD;AACA,KAAM,CAAAC,OAAO,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,GAC1CC,MAAM,CAACC,QAAQ,CAACC,QAAQ,GAAK,QAAQ,YAAAC,MAAA,CACvBH,MAAM,CAACC,QAAQ,CAACG,QAAQ,EAClCJ,MAAM,CAACC,QAAQ,CAACG,QAAQ,GAAK,WAAW,EAAIJ,MAAM,CAACC,QAAQ,CAACG,QAAQ,GAAK,WAAW,CACnF,uBAAuB,CACvB,yBAA0B,CAAC,CAEnC,KAAM,CAAAC,UAAoB,CAAGA,CAAA,GAAM,CACjC,KAAM,CAAEC,CAAE,CAAC,CAAGjB,cAAc,CAAC,CAAC,CAC9B,KAAM,CAAEkB,KAAK,CAAEC,eAAgB,CAAC,CAAGjB,OAAO,CAAC,CAAC,CAC5C,KAAM,CAAEkB,QAAQ,CAAEC,YAAY,CAAEC,SAAS,CAAE,CAAEC,MAAO,CAAE,CAAC,CAAGxB,OAAO,CAAiB,CAChFyB,aAAa,CAAE,CACbC,UAAU,CAAE,KAAK,CACjBC,QAAQ,CAAE,KACZ,CACF,CAAC,CAAC,CACF,KAAM,CAAAC,QAAQ,CAAG1B,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAA2B,YAAY,CAAG9B,MAAM,CAAC,IAAI,CAAC,CAEjCD,SAAS,CAAC,IAAM,CACdgC,OAAO,CAACC,GAAG,CAAC,2BAA2B,CAAE,CAAEX,eAAe,CAAEY,QAAQ,CAAE,CAAC,CAACb,KAAK,CAAEc,WAAW,CAAEd,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEe,MAAO,CAAC,CAAC,CAE5G,GAAI,CAACd,eAAe,EAAI,CAACD,KAAK,CAAE,CAC9BW,OAAO,CAACK,IAAI,CAAC,iDAAiD,CAAC,CAC/DP,QAAQ,CAAC,YAAY,CAAC,CACxB,CACF,CAAC,CAAE,CAACR,eAAe,CAAED,KAAK,CAAES,QAAQ,CAAC,CAAC,CAEtC9B,SAAS,CAAC,IAAM,CACd,MAAO,IAAM,CACX+B,YAAY,CAACO,OAAO,CAAG,KAAK,CAC9B,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAACC,UAAU,CAAEC,aAAa,CAAC,CAAGzC,QAAQ,CAAS,EAAE,CAAC,CACxD,KAAM,CAAC0C,aAAa,CAAEC,gBAAgB,CAAC,CAAG3C,QAAQ,CAAW,EAAE,CAAC,CAChE,KAAM,CAAC4C,aAAa,CAAEC,gBAAgB,CAAC,CAAG7C,QAAQ,CAAW,EAAE,CAAC,CAChE,KAAM,CAAC8C,OAAO,CAAEC,UAAU,CAAC,CAAG/C,QAAQ,CAAC,KAAK,CAAC,CAAE;AAC/C,KAAM,CAACgD,UAAU,CAAEC,aAAa,CAAC,CAAGjD,QAAQ,CAAc,IAAI,CAAC,CAE/D;AACA,KAAM,CAAAkD,iBAAiB,CAAIC,IAAU,EAAoB,CACvD,MAAO,IAAI,CAAAC,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACtC,KAAM,CAAAC,GAAG,CAAGC,GAAG,CAACC,eAAe,CAACN,IAAI,CAAC,CACrC,KAAM,CAAAO,KAAK,CAAGC,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAC,CAC7CF,KAAK,CAACG,OAAO,CAAG,UAAU,CAC1BH,KAAK,CAACI,KAAK,CAAG,IAAI,CAClBJ,KAAK,CAACK,GAAG,CAAGR,GAAG,CACf;AACAG,KAAK,CAACM,WAAW,CAAG,CAAC,CACrB,KAAM,CAAAC,OAAO,CAAGA,CAAA,GAAMT,GAAG,CAACU,eAAe,CAACX,GAAG,CAAC,CAE9CG,KAAK,CAACS,YAAY,CAAG,UAAY,CAC/B,KAAM,CAAAC,MAAM,CAAGT,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC,CAC/CQ,MAAM,CAACC,KAAK,CAAGX,KAAK,CAACY,UAAU,EAAI,GAAG,CACtCF,MAAM,CAACG,MAAM,CAAGb,KAAK,CAACc,WAAW,EAAI,GAAG,CACxC,KAAM,CAAAC,GAAG,CAAGL,MAAM,CAACM,UAAU,CAAC,IAAI,CAAC,CACnC,GAAI,CAACD,GAAG,CAAE,MAAO,CAAAnB,MAAM,CAAC,GAAI,CAAAqB,KAAK,CAAC,sBAAsB,CAAC,CAAC,CAC1DF,GAAG,CAACG,SAAS,CAAClB,KAAK,CAAE,CAAC,CAAE,CAAC,CAAEU,MAAM,CAACC,KAAK,CAAED,MAAM,CAACG,MAAM,CAAC,CACvDH,MAAM,CAACS,MAAM,CAAEC,IAAI,EAAK,CACtBb,OAAO,CAAC,CAAC,CACT,GAAIa,IAAI,CAAEzB,OAAO,CAACyB,IAAI,CAAC,CAAC,IACnB,CAAAxB,MAAM,CAAC,GAAI,CAAAqB,KAAK,CAAC,yBAAyB,CAAC,CAAC,CACnD,CAAC,CAAE,YAAY,CAAE,GAAG,CAAC,CACvB,CAAC,CACDjB,KAAK,CAACqB,OAAO,CAAIC,CAAC,EAAK,CACrBf,OAAO,CAAC,CAAC,CACTX,MAAM,CAAC0B,CAAC,CAAC,CACX,CAAC,CACH,CAAC,CAAC,CACJ,CAAC,CAED;AACA,KAAM,CAAAC,oBAAoB,CAAG,QAAAA,CAAC9B,IAAU,CAAiC,IAA/B,CAAA+B,IAAI,CAAAC,SAAA,CAAA9C,MAAA,IAAA8C,SAAA,MAAAC,SAAA,CAAAD,SAAA,IAAG,EAAE,CACjD,MAAO,IAAI,CAAA/B,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACtC,KAAM,CAAA+B,GAAG,CAAG,GAAI,CAAAC,KAAK,CAAC,CAAC,CACvB,KAAM,CAAA/B,GAAG,CAAGC,GAAG,CAACC,eAAe,CAACN,IAAI,CAAC,CACrCkC,GAAG,CAACE,MAAM,CAAG,IAAM,CACjB,KAAM,CAAAC,KAAK,CAAGH,GAAG,CAAChB,KAAK,CAAGgB,GAAG,CAACd,MAAM,EAAI,CAAC,CACzC,GAAI,CAAAF,KAAK,CAAGa,IAAI,CAChB,GAAI,CAAAX,MAAM,CAAGkB,IAAI,CAACC,KAAK,CAACR,IAAI,CAAGM,KAAK,CAAC,CACrC,GAAIA,KAAK,CAAG,CAAC,CAAE,CACb;AACAjB,MAAM,CAAGW,IAAI,CACbb,KAAK,CAAGoB,IAAI,CAACC,KAAK,CAACR,IAAI,CAAGM,KAAK,CAAC,CAClC,CACA,KAAM,CAAApB,MAAM,CAAGT,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC,CAC/CQ,MAAM,CAACC,KAAK,CAAGA,KAAK,CACpBD,MAAM,CAACG,MAAM,CAAGA,MAAM,CACtB,KAAM,CAAAE,GAAG,CAAGL,MAAM,CAACM,UAAU,CAAC,IAAI,CAAC,CACnC,GAAI,CAACD,GAAG,CAAE,CACRjB,GAAG,CAACU,eAAe,CAACX,GAAG,CAAC,CACxB,MAAO,CAAAD,MAAM,CAAC,GAAI,CAAAqB,KAAK,CAAC,sBAAsB,CAAC,CAAC,CAClD,CACAF,GAAG,CAACG,SAAS,CAACS,GAAG,CAAE,CAAC,CAAE,CAAC,CAAEhB,KAAK,CAAEE,MAAM,CAAC,CACvC,KAAM,CAAAoB,OAAO,CAAGvB,MAAM,CAACwB,SAAS,CAAC,YAAY,CAAE,GAAG,CAAC,CACnDpC,GAAG,CAACU,eAAe,CAACX,GAAG,CAAC,CACxBF,OAAO,CAACsC,OAAO,CAAC,CAClB,CAAC,CACDN,GAAG,CAACN,OAAO,CAAIC,CAAC,EAAK,CACnBxB,GAAG,CAACU,eAAe,CAACX,GAAG,CAAC,CACxBD,MAAM,CAAC0B,CAAC,CAAC,CACX,CAAC,CACDK,GAAG,CAACtB,GAAG,CAAGR,GAAG,CACf,CAAC,CAAC,CACJ,CAAC,CAED,KAAM,CAAAsC,YAAY,CAAG,KAAO,CAAAb,CAAsC,EAAK,CACrE,KAAM,CAAAc,KAAK,CAAGd,CAAC,CAACe,MAAM,CAACD,KAAK,CAAGE,KAAK,CAACC,IAAI,CAACjB,CAAC,CAACe,MAAM,CAACD,KAAK,CAAC,CAAG,EAAE,CAC9D,GAAI,CAACA,KAAK,CAACzD,MAAM,CAAE,OACnBI,aAAa,CAACqD,KAAK,CAAC,CAEpB;AACApD,aAAa,CAACwD,OAAO,CAAC3C,GAAG,EAAI,CAAE,GAAIA,GAAG,CAAC4C,UAAU,CAAC,OAAO,CAAC,CAAE3C,GAAG,CAACU,eAAe,CAACX,GAAG,CAAC,CAAE,CAAC,CAAC,CACxFZ,gBAAgB,CAAC,EAAE,CAAC,CACpBE,gBAAgB,CAAC,EAAE,CAAC,CAEpB,KAAM,CAAAuD,QAAkB,CAAG,EAAE,CAC7B,KAAM,CAAAC,MAAgB,CAAG,EAAE,CAC3B,IAAK,KAAM,CAAAC,CAAC,GAAI,CAAAR,KAAK,CAAE,CACrB,KAAM,CAAAvC,GAAG,CAAGC,GAAG,CAACC,eAAe,CAAC6C,CAAC,CAAC,CAClCF,QAAQ,CAACG,IAAI,CAAChD,GAAG,CAAC,CAClB,GAAI+C,CAAC,CAACE,IAAI,CAACL,UAAU,CAAC,QAAQ,CAAC,CAAE,CAC/B,GAAI,CACF,KAAM,CAAAM,KAAK,CAAG,KAAM,CAAAxB,oBAAoB,CAACqB,CAAC,CAAE,EAAE,CAAC,CAC/CD,MAAM,CAACE,IAAI,CAACE,KAAK,CAAC,CACpB,CAAE,MAAOC,GAAG,CAAE,CACZL,MAAM,CAACE,IAAI,CAAC,EAAE,CAAC,CACjB,CACF,CAAC,IAAM,CACLF,MAAM,CAACE,IAAI,CAAC,EAAE,CAAC,CACjB,CACF,CACA5D,gBAAgB,CAACyD,QAAQ,CAAC,CAC1BvD,gBAAgB,CAACwD,MAAM,CAAC,CACxBtD,UAAU,CAAC+C,KAAK,CAACzD,MAAM,GAAK,CAAC,EAAIyD,KAAK,CAAC,CAAC,CAAC,CAACU,IAAI,CAACL,UAAU,CAAC,QAAQ,CAAC,CAAC,CACpE;AACF,CAAC,CAED,KAAM,CAACQ,UAAU,CAAEC,aAAa,CAAC,CAAG5G,QAAQ,CAAC,KAAK,CAAC,CACnD,KAAM,CAAC6G,WAAW,CAAEC,cAAc,CAAC,CAAG9G,QAAQ,CAAgB,IAAI,CAAC,CACnE,KAAM,CAAC+G,cAAc,CAAEC,iBAAiB,CAAC,CAAGhH,QAAQ,CAAgB,IAAI,CAAC,CACzE,KAAM,CAAAiH,kBAAkB,CAAG/G,MAAM,CAAyB,IAAI,CAAC,CAE/DD,SAAS,CAAC,IAAM,CACd,MAAO,IAAM,CACX+B,YAAY,CAACO,OAAO,CAAG,KAAK,CAC5B;AACA,GAAI0E,kBAAkB,CAAC1E,OAAO,CAAE,CAC9B0E,kBAAkB,CAAC1E,OAAO,CAAC2E,KAAK,CAAC,CAAC,CACpC,CACF,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,QAAuC,CAAG,KAAO,CAAAC,MAAM,EAAK,KAAAC,YAAA,CAAAC,gBAAA,CAChErF,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAEkF,MAAM,CAAC,CAEzD;AACA,GAAI,GAAAC,YAAA,CAACD,MAAM,CAACG,IAAI,UAAAF,YAAA,WAAXA,YAAA,CAAaG,IAAI,CAAC,CAAC,EAAE,CACxBV,cAAc,CAACzF,CAAC,CAAC,qBAAqB,CAAC,CAAC,CACxC,OACF,CACA,GAAI,GAAAiG,gBAAA,CAACF,MAAM,CAACpG,QAAQ,UAAAsG,gBAAA,WAAfA,gBAAA,CAAiBE,IAAI,CAAC,CAAC,EAAE,CAC5BV,cAAc,CAACzF,CAAC,CAAC,yBAAyB,CAAC,CAAC,CAC5C,OACF,CAEA,GAAI,CACFuF,aAAa,CAAC,IAAI,CAAC,CACnBE,cAAc,CAAC,IAAI,CAAC,CAEpB7E,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAEvB,OAAO,CAAC,CAClDsB,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAEnB,MAAM,CAACC,QAAQ,CAACG,QAAQ,CAAC,CAC1Dc,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAEnB,MAAM,CAACC,QAAQ,CAACyG,IAAI,CAAC,CAErD,KAAM,CAAAC,QAAQ,CAAG,GAAI,CAAAC,QAAQ,CAAC,CAAC,CAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,CAAER,MAAM,CAACG,IAAI,CAAC,CACpC,GAAIH,MAAM,CAACS,KAAK,CAAEH,QAAQ,CAACE,MAAM,CAAC,OAAO,CAAER,MAAM,CAACS,KAAK,CAAC,CACxD,GAAIT,MAAM,CAACU,KAAK,CAAEJ,QAAQ,CAACE,MAAM,CAAC,OAAO,CAAER,MAAM,CAACU,KAAK,CAAC,CACxD,GAAIV,MAAM,CAACW,GAAG,GAAK3C,SAAS,CAAEsC,QAAQ,CAACE,MAAM,CAAC,KAAK,CAAEI,MAAM,CAACZ,MAAM,CAACW,GAAG,CAAC,CAAC,CACxE,GAAIX,MAAM,CAACa,WAAW,CAAEP,QAAQ,CAACE,MAAM,CAAC,aAAa,CAAER,MAAM,CAACa,WAAW,CAAC,CAC1E,GAAIb,MAAM,CAAClC,IAAI,CAAEwC,QAAQ,CAACE,MAAM,CAAC,MAAM,CAAER,MAAM,CAAClC,IAAI,CAAC,CACrD,GAAIkC,MAAM,CAACpG,QAAQ,CAAE0G,QAAQ,CAACE,MAAM,CAAC,UAAU,CAAER,MAAM,CAACpG,QAAQ,CAAC,CAEjE;AACA0G,QAAQ,CAACE,MAAM,CAAC,YAAY,CAAER,MAAM,CAACvF,UAAU,CAAG,MAAM,CAAG,OAAO,CAAC,CACnE6F,QAAQ,CAACE,MAAM,CAAC,UAAU,CAAER,MAAM,CAACtF,QAAQ,CAAG,MAAM,CAAG,OAAO,CAAC,CAE/D,GAAIU,UAAU,CAACH,MAAM,CAAE,CACrBG,UAAU,CAAC0D,OAAO,CAAC,CAAC/C,IAAI,CAAE+E,GAAG,GAAK,CAChCR,QAAQ,CAACE,MAAM,CAAC,OAAO,CAAEzE,IAAI,CAAEA,IAAI,CAACoE,IAAI,CAAC,CAC3C,CAAC,CAAC,CACF;AACF,CAEAtF,OAAO,CAACC,GAAG,CAAC,gBAAgB,IAAAhB,MAAA,CAAKP,OAAO,aAAW,CAAC,CACpDsB,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAEiG,MAAM,CAACC,WAAW,CAACV,QAAQ,CAACW,OAAO,CAAC,CAAC,CAAC,CAAC,CACxEpG,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAEM,UAAU,CAACH,MAAM,CAAC,CACtDJ,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAE,CAAC,CAACZ,KAAK,CAAC,CACzCW,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAEZ,KAAK,IAAAJ,MAAA,CAAMI,KAAK,CAACgH,SAAS,CAAC,CAAC,CAAE,EAAE,CAAC,QAAQ,UAAU,CAAC,CAEnFrB,kBAAkB,CAAC1E,OAAO,CAAG,GAAI,CAAAgG,eAAe,CAAC,CAAC,CAElD,KAAM,CAAAC,OAAY,CAAG,CACnB;AAAA,CACD,CAED,GAAIlH,KAAK,CAAE,CACTkH,OAAO,CAAC,eAAe,CAAC,WAAAtH,MAAA,CAAaI,KAAK,CAAE,CAC5CW,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC,CAC3C,CAAC,IAAM,CACLD,OAAO,CAACwG,KAAK,CAAC,2CAA2C,CAAC,CAC5D,CAEA,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAC,KAAK,IAAAzH,MAAA,CAAIP,OAAO,cAAa,CAC9CiI,MAAM,CAAE,MAAM,CACdC,IAAI,CAAEnB,QAAQ,CACdoB,MAAM,CAAE7B,kBAAkB,CAAC1E,OAAO,CAACuG,MAAM,CACzCN,OACF,CAAC,CAAC,CAACO,KAAK,CAAC,KAAO,CAAAC,UAAU,EAAK,CAC7B;AACA/G,OAAO,CAACK,IAAI,CAAC,sCAAsC,CAAE0G,UAAU,CAACC,OAAO,CAAC,CAExE,KAAM,CAAAC,YAAY,CAAG,CACnB,kCAAkC,CAAG;AACrC,gCAAsC;AAAA,CACvC,CAED,IAAK,KAAM,CAAAC,WAAW,GAAI,CAAAD,YAAY,CAAE,CACtC,GAAI,CACFjH,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAEiH,WAAW,CAAC,CAChD,KAAM,CAAAC,YAAY,CAAG,KAAM,CAAAT,KAAK,CAACQ,WAAW,CAAE,CAC5CP,MAAM,CAAE,MAAM,CACdC,IAAI,CAAEnB,QAAQ,CACdoB,MAAM,CAAE7B,kBAAkB,CAAC1E,OAAO,CAACuG,MAAM,CACzCN,OACF,CAAC,CAAC,CACFvG,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAEiH,WAAW,CAAC,CAC/C,MAAO,CAAAC,YAAY,CACrB,CAAE,MAAOC,aAAa,CAAE,CACtBpH,OAAO,CAACK,IAAI,CAAC,kBAAkB,CAAE6G,WAAW,CAAEE,aAAa,CAACJ,OAAO,CAAC,CACtE,CACF,CAEA;AACA,KAAM,CAAAD,UAAU,CAClB,CAAC,CAAC,CAEF,GAAI,CAACN,IAAI,CAACY,EAAE,CAAE,CACZ;AACA,GAAI,CAAAC,MAAM,8BAAArI,MAAA,CAAgCwH,IAAI,CAACc,MAAM,OAAAtI,MAAA,CAAKwH,IAAI,CAACe,UAAU,KAAG,CAC5ExH,OAAO,CAACwG,KAAK,CAAC,kBAAkB,CAAEC,IAAI,CAACc,MAAM,CAAEd,IAAI,CAACe,UAAU,CAAC,CAC/D,GAAI,CACF,KAAM,CAAAZ,IAAI,CAAG,KAAM,CAAAH,IAAI,CAACgB,IAAI,CAAC,CAAC,CAC9BzH,OAAO,CAACwG,KAAK,CAAC,aAAa,CAAEI,IAAI,CAAC,CAClCU,MAAM,CAAGV,IAAI,CAACI,OAAO,EAAIU,IAAI,CAACC,SAAS,CAACf,IAAI,CAAC,CAC/C,CAAE,MAAO7D,CAAC,CAAE,CACV/C,OAAO,CAACwG,KAAK,CAAC,gCAAgC,CAAEzD,CAAC,CAAC,CAClD,KAAM,CAAA6E,GAAG,CAAG,KAAM,CAAAnB,IAAI,CAACoB,IAAI,CAAC,CAAC,CAC7B7H,OAAO,CAACwG,KAAK,CAAC,aAAa,CAAEoB,GAAG,CAAC,CACjC,GAAIA,GAAG,CAAEN,MAAM,CAAGM,GAAG,CAACvB,SAAS,CAAC,CAAC,CAAE,GAAG,CAAC,CAAE;AAC3C,CACArG,OAAO,CAACwG,KAAK,CAAC,YAAY,CAAEc,MAAM,CAAC,CACnCzC,cAAc,CAACyC,MAAM,CAAC,CACtB,KAAM,IAAI,CAAA5E,KAAK,CAAC4E,MAAM,CAAC,CACzB,CAEA;AACA,GAAIvH,YAAY,CAACO,OAAO,CAAE,CACxByE,iBAAiB,CAAC3F,CAAC,CAAC,cAAc,CAAC,CAAC,CACpC;AACA0I,UAAU,CAAC,IAAM,CACf,GAAI/H,YAAY,CAACO,OAAO,CAAER,QAAQ,CAAC,MAAM,CAAC,CAC5C,CAAC,CAAE,IAAI,CAAC,CACV,CACF,CAAE,MAAO2E,GAAQ,CAAE,CACjB;AACA,GAAIA,GAAG,CAACa,IAAI,GAAK,YAAY,CAAE,CAC7BtF,OAAO,CAACC,GAAG,CAAC,2CAA2C,CAAC,CACxD,OACF,CAEAD,OAAO,CAACwG,KAAK,CAAC,iBAAiB,CAAE/B,GAAG,CAAC,CACrCzE,OAAO,CAACwG,KAAK,CAAC,aAAa,CAAE/B,GAAG,CAACa,IAAI,CAAC,CACtCtF,OAAO,CAACwG,KAAK,CAAC,gBAAgB,CAAE/B,GAAG,CAACuC,OAAO,CAAC,CAC5ChH,OAAO,CAACwG,KAAK,CAAC,aAAa,CAAE/B,GAAG,CAAC,CAEjC,GAAI,CAAAsD,YAAY,CAAG3I,CAAC,CAAC,eAAe,CAAC,CACrC,GAAIqF,GAAG,CAACuC,OAAO,CAAE,CACfe,YAAY,OAAA9I,MAAA,CAASwF,GAAG,CAACuC,OAAO,CAAE,CACpC,CAEA,GAAIjH,YAAY,CAACO,OAAO,EAAI,CAACsE,WAAW,CAAE,CACxCC,cAAc,CAACkD,YAAY,CAAC,CAC9B,CACF,CAAC,OAAS,CACR,GAAIhI,YAAY,CAACO,OAAO,CAAEqE,aAAa,CAAC,KAAK,CAAC,CAChD,CACF,CAAC,CAED,mBACElG,KAAA,SAAAuJ,QAAA,eACEzJ,IAAA,OAAAyJ,QAAA,CAAK5I,CAAC,CAAC,cAAc,CAAC,CAAK,CAAC,cAC5BX,KAAA,SAAMwJ,EAAE,CAAC,aAAa,CAAC/C,QAAQ,CAAE1F,YAAY,CAAC0F,QAAQ,CAAE,CAAA8C,QAAA,eACtDzJ,IAAA,UAAO2J,OAAO,CAAC,aAAa,CAAAF,QAAA,CAAE5I,CAAC,CAAC,aAAa,CAAC,CAAQ,CAAC,cACvDb,IAAA,SAAA4J,aAAA,EAAO5D,IAAI,CAAC,MAAM,CAAC0D,EAAE,CAAC,aAAa,CAAC3C,IAAI,CAAC,MAAM,CAAC8C,YAAY,CAAC,MAAM,CAACC,WAAW,CAAEjJ,CAAC,CAAC,aAAa,CAAE,EAAKG,QAAQ,CAAC,MAAM,CAAE,CAAE+I,QAAQ,CAAE,IAAK,CAAC,CAAC,CAAG,CAAC,CAC9I5I,MAAM,CAAC4F,IAAI,eAAI7G,KAAA,QAAK8J,SAAS,CAAC,OAAO,CAACC,IAAI,CAAC,OAAO,CAAAR,QAAA,EAAE5I,CAAC,CAAC,aAAa,CAAC,CAAC,cAAY,EAAK,CAAC,cAExFb,IAAA,UAAO2J,OAAO,CAAC,cAAc,CAAAF,QAAA,CAAE5I,CAAC,CAAC,cAAc,CAAC,CAAQ,CAAC,cACzDb,IAAA,SAAA4J,aAAA,EAAO5D,IAAI,CAAC,MAAM,CAAC0D,EAAE,CAAC,cAAc,CAAC3C,IAAI,CAAC,OAAO,CAAC8C,YAAY,CAAC,KAAK,CAACC,WAAW,CAAEjJ,CAAC,CAAC,cAAc,CAAE,EAAKG,QAAQ,CAAC,OAAO,CAAC,CAAG,CAAC,cAE9HhB,IAAA,UAAO2J,OAAO,CAAC,cAAc,CAAAF,QAAA,CAAE5I,CAAC,CAAC,cAAc,CAAC,CAAQ,CAAC,cACzDb,IAAA,SAAA4J,aAAA,EAAO5D,IAAI,CAAC,MAAM,CAAC0D,EAAE,CAAC,cAAc,CAAC3C,IAAI,CAAC,OAAO,CAAC8C,YAAY,CAAC,KAAK,CAACC,WAAW,CAAEjJ,CAAC,CAAC,cAAc,CAAE,EAAKG,QAAQ,CAAC,OAAO,CAAC,CAAG,CAAC,cAE9HhB,IAAA,UAAO2J,OAAO,CAAC,iBAAiB,CAAAF,QAAA,CAAE5I,CAAC,CAAC,iBAAiB,CAAC,CAAQ,CAAC,cAC/Db,IAAA,SAAA4J,aAAA,EAAO5D,IAAI,CAAC,MAAM,CAAC0D,EAAE,CAAC,iBAAiB,CAAC3C,IAAI,CAAC,UAAU,CAAC8C,YAAY,CAAC,gBAAgB,CAACC,WAAW,CAAEjJ,CAAC,CAAC,iBAAiB,CAAE,EAAKG,QAAQ,CAAC,UAAU,CAAE,CAAE+I,QAAQ,CAAE,IAAK,CAAC,CAAC,CAAG,CAAC,cAEzK/J,IAAA,UAAO2J,OAAO,CAAC,YAAY,CAAAF,QAAA,CAAE5I,CAAC,CAAC,YAAY,CAAC,CAAQ,CAAC,cACrDb,IAAA,UAAAyJ,QAAA,CAAQ5I,CAAC,CAAC,qBAAqB,CAAC,CAAQ,CAAC,cACzCb,IAAA,SAAA4J,aAAA,EAAO5D,IAAI,CAAC,QAAQ,CAAC0D,EAAE,CAAC,YAAY,CAAC3C,IAAI,CAAC,KAAK,CAAC8C,YAAY,CAAC,KAAK,CAACC,WAAW,CAAEjJ,CAAC,CAAC,YAAY,CAAE,CAACqJ,IAAI,CAAC,KAAK,EAAKlJ,QAAQ,CAAC,KAAK,CAAE,CAAEmJ,aAAa,CAAE,IAAK,CAAC,CAAC,CAAG,CAAC,cAE5JnK,IAAA,UAAO2J,OAAO,CAAC,cAAc,CAAAF,QAAA,CAAE5I,CAAC,CAAC,eAAe,CAAC,CAAQ,CAAC,cAC1Db,IAAA,UAAOgG,IAAI,CAAC,MAAM,CAAC0D,EAAE,CAAC,cAAc,CAAC3C,IAAI,CAAC,OAAO,CAACqD,MAAM,CAAC,iBAAiB,CAACC,QAAQ,MAACC,QAAQ,CAAEjF,YAAa,CAAE,CAAC,cAC9GrF,IAAA,QAAKuK,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEC,QAAQ,CAAE,MAAM,CAAEC,GAAG,CAAE,CAAC,CAAEC,MAAM,CAAE,OAAQ,CAAE,CAAAlB,QAAA,CACxEvH,aAAa,CAAC0I,GAAG,CAAC,CAAC7H,GAAG,CAAE2E,GAAG,gBAC1B1H,IAAA,QAAeuD,GAAG,CAAER,GAAI,CAAC8H,GAAG,YAAAnK,MAAA,CAAagH,GAAG,CAAG,CAAC6C,KAAK,CAAE,CAAE1G,KAAK,CAAE,EAAE,CAAEE,MAAM,CAAE,EAAE,CAAE+G,SAAS,CAAE,OAAO,CAAEC,YAAY,CAAE,CAAC,CAAEC,MAAM,CAAE,gBAAiB,CAAE,EAAtIjI,GAAwI,CACnJ,CAAC,CACC,CAAC,cAGN/C,IAAA,UAAO2J,OAAO,CAAC,oBAAoB,CAAAF,QAAA,CAAE5I,CAAC,CAAC,oBAAoB,CAAC,CAAQ,CAAC,cACrEb,IAAA,YAAA4J,aAAA,EAAUF,EAAE,CAAC,oBAAoB,CAAC3C,IAAI,CAAC,aAAa,CAACkE,IAAI,CAAE,CAAE,CAACC,IAAI,CAAE,EAAG,CAACrB,YAAY,CAAC,KAAK,CAACC,WAAW,CAAEjJ,CAAC,CAAC,oBAAoB,CAAE,EAAKG,QAAQ,CAAC,aAAa,CAAC,CAAG,CAAC,cAEhKhB,IAAA,UAAO2J,OAAO,CAAC,aAAa,CAAAF,QAAA,CAAE5I,CAAC,CAAC,aAAa,CAAC,CAAQ,CAAC,cACvDX,KAAA,UAAA0J,aAAA,CAAAA,aAAA,IAAY5I,QAAQ,CAAC,MAAM,CAAC,MAAE0I,EAAE,CAAC,aAAa,CAAC3C,IAAI,CAAC,MAAM,CAAC8C,YAAY,CAAC,KAAK,CAAAJ,QAAA,eAC3EzJ,IAAA,WAAQmL,KAAK,CAAC,OAAO,CAAA1B,QAAA,CAAE5I,CAAC,CAAC,YAAY,CAAC,CAAS,CAAC,cAChDb,IAAA,WAAQmL,KAAK,CAAC,QAAQ,CAAA1B,QAAA,CAAE5I,CAAC,CAAC,aAAa,CAAC,CAAS,CAAC,cAClDb,IAAA,WAAQmL,KAAK,CAAC,OAAO,CAAA1B,QAAA,CAAE5I,CAAC,CAAC,YAAY,CAAC,CAAS,CAAC,GAC1C,CAAC,cAETX,KAAA,QAAKwJ,EAAE,CAAC,QAAQ,CAAAD,QAAA,eACdzJ,IAAA,UAAAyJ,QAAA,CAAQ5I,CAAC,CAAC,eAAe,CAAC,CAAQ,CAAC,cACnCX,KAAA,QAAK8J,SAAS,CAAC,gBAAgB,CAAAP,QAAA,eAC7BvJ,KAAA,UAAOyJ,OAAO,CAAC,oBAAoB,CAAAF,QAAA,eACjCzJ,IAAA,SAAA4J,aAAA,CAAAA,aAAA,EAAO5D,IAAI,CAAC,OAAO,EAAKhF,QAAQ,CAAC,QAAQ,CAAC,MAAE0I,EAAE,CAAC,oBAAoB,CAAC3C,IAAI,CAAC,QAAQ,CAACoE,KAAK,CAAC,MAAM,EAAE,CAAC,cACjGnL,IAAA,SAAAyJ,QAAA,CAAO5I,CAAC,CAAC,aAAa,CAAC,CAAO,CAAC,EAC1B,CAAC,cACRX,KAAA,UAAOyJ,OAAO,CAAC,sBAAsB,CAAAF,QAAA,eACnCzJ,IAAA,SAAA4J,aAAA,CAAAA,aAAA,EAAO5D,IAAI,CAAC,OAAO,EAAKhF,QAAQ,CAAC,QAAQ,CAAC,MAAE0I,EAAE,CAAC,sBAAsB,CAAC3C,IAAI,CAAC,QAAQ,CAACoE,KAAK,CAAC,QAAQ,EAAE,CAAC,cACrGnL,IAAA,SAAAyJ,QAAA,CAAO5I,CAAC,CAAC,eAAe,CAAC,CAAO,CAAC,EAC5B,CAAC,EACL,CAAC,EACH,CAAC,cAENX,KAAA,QAAKwJ,EAAE,CAAC,QAAQ,CAAAD,QAAA,eACdvJ,KAAA,UAAOyJ,OAAO,CAAC,mBAAmB,CAAAF,QAAA,eAChCzJ,IAAA,SAAAyJ,QAAA,CAAO5I,CAAC,CAAC,mBAAmB,CAAC,CAAO,CAAC,cACrCb,IAAA,SAAA4J,aAAA,CAAAA,aAAA,EAAO5D,IAAI,CAAC,UAAU,EAAKhF,QAAQ,CAAC,YAAY,CAAC,MAAE0I,EAAE,CAAC,mBAAmB,CAAC3C,IAAI,CAAC,YAAY,EAAE,CAAC,EACzF,CAAC,cAER7G,KAAA,UAAOyJ,OAAO,CAAC,iBAAiB,CAAAF,QAAA,eAC9BzJ,IAAA,SAAAyJ,QAAA,CAAO5I,CAAC,CAAC,iBAAiB,CAAC,CAAO,CAAC,cACnCb,IAAA,SAAA4J,aAAA,CAAAA,aAAA,EAAO5D,IAAI,CAAC,UAAU,EAAKhF,QAAQ,CAAC,UAAU,CAAC,MAAE0I,EAAE,CAAC,iBAAiB,CAAC3C,IAAI,CAAC,UAAU,EAAE,CAAC,EACnF,CAAC,EACL,CAAC,cAEN7G,KAAA,QAAK8J,SAAS,CAAC,cAAc,CAAAP,QAAA,eAC3BzJ,IAAA,WAAQgG,IAAI,CAAC,QAAQ,CAACoF,QAAQ,CAAEjF,UAAW,CAAAsD,QAAA,CAAEtD,UAAU,CAAGtF,CAAC,CAAC,eAAe,CAAC,CAAGA,CAAC,CAAC,eAAe,CAAC,CAAS,CAAC,CAC1GwF,WAAW,eAAIrG,IAAA,QAAKgK,SAAS,CAAC,OAAO,CAACC,IAAI,CAAC,OAAO,CAAAR,QAAA,CAAEpD,WAAW,CAAM,CAAC,CACtEE,cAAc,eAAIvG,IAAA,QAAKgK,SAAS,CAAC,sBAAsB,CAACC,IAAI,CAAC,QAAQ,CAAAR,QAAA,CAAElD,cAAc,CAAM,CAAC,EAC1F,CAAC,EACF,CAAC,EACH,CAAC,CAEX,CAAC,CAED,cAAe,CAAA3F,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}