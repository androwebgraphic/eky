{"ast":null,"code":"import React,{useState,useEffect,useRef,useCallback}from'react';import'../css/chat-app.css';import io from'socket.io-client';import{useAuth}from'../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const getApiUrl=()=>{if(process.env.REACT_APP_API_URL)return process.env.REACT_APP_API_URL;if(window.location.protocol==='https:'){// Use same host, but https\nreturn\"https://\".concat(window.location.hostname);}if(window.location.hostname==='localhost'||window.location.hostname==='127.0.0.1'){return\"http://\".concat(window.location.hostname,\":3001\");}// For mobile/network access, use the network IP (dev only)\nreturn\"http://172.20.10.2:3001\";};const ChatApp=()=>{const selectedConvoRef=useRef(null);const[onlineUsers,setOnlineUsers]=useState([]);const{user,token,updateUser}=useAuth();const userWithBlocks=user;console.log('[ChatApp] user:',user);// Profile picture logic\nconst getProfilePictureUrl=()=>{if(user&&user.profilePicture){return\"\".concat(getApiUrl()).concat(user.profilePicture);}return'../img/androcolored-80x80.jpg';// Default profile picture\n};const[conversations,setConversations]=useState([]);const[convoUsernames,setConvoUsernames]=useState({});const[selectedConvo,setSelectedConvo]=useState(null);useEffect(()=>{selectedConvoRef.current=selectedConvo;},[selectedConvo]);const[messages,setMessages]=useState([]);const[input,setInput]=useState('');// Remove otherUserId, use only user search and searchResults\nconst[typing,setTyping]=useState(false);const[notification,setNotification]=useState(null);const[userSearch,setUserSearch]=useState('');const[searchResults,setSearchResults]=useState([]);const[pendingAdoptions,setPendingAdoptions]=useState([]);useEffect(()=>{console.log('[ChatApp] onlineUsers state updated:',onlineUsers);},[onlineUsers]);const socketRef=useRef(null);const fetchPendingAdoptions=useCallback(async()=>{if(!token)return;try{const res=await fetch(\"\".concat(getApiUrl(),\"/api/dogs/pending-adoptions\"),{headers:{'Authorization':\"Bearer \".concat(token)}});if(res.ok){const data=await res.json();setPendingAdoptions(data);}}catch(err){console.error('Failed to fetch pending adoptions:',err);}},[token]);// Setup socket connection and listeners only once per user/token\nuseEffect(()=>{if(user!==null&&user!==void 0&&user._id&&token){console.log('[ChatApp] Connecting socket for user:',user._id);fetch(\"\".concat(getApiUrl(),\"/api/chat/conversations/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(async data=>{setConversations(Array.isArray(data)?data:[]);// Fetch usernames for each conversation's other participant\nconst usernames={};for(const convo of Array.isArray(data)?data:[]){const otherId=convo.participants.find(id=>id!==user._id);if(otherId){const res=await fetch(\"\".concat(getApiUrl(),\"/api/users/\").concat(otherId));if(res.ok){const u=await res.json();usernames[convo._id]=u.username||u.name||otherId;}else{usernames[convo._id]=otherId;}}}setConvoUsernames(usernames);}).then(()=>fetchPendingAdoptions());if(!socketRef.current){socketRef.current=io(getApiUrl());console.log('[ChatApp] Socket.IO connecting to',getApiUrl());socketRef.current.emit('join',user._id);console.log('[ChatApp] Emitted join for user:',user._id);socketRef.current.emit('getOnlineUsers');socketRef.current.on('onlineUsers',users=>{console.log('[ChatApp] Received onlineUsers:',users);setOnlineUsers(users.filter(u=>u._id!==user._id));});socketRef.current.on('userOnline',userOnline=>{console.log('[ChatApp] userOnline event:',userOnline);setOnlineUsers(prev=>{if(prev.some(u=>u._id===userOnline._id))return prev;return[...prev,userOnline].filter(u=>u._id!==user._id);});});socketRef.current.on('userOffline',userOffline=>{console.log('[ChatApp] userOffline event:',userOffline);setOnlineUsers(prev=>prev.filter(u=>u._id!==userOffline._id));});socketRef.current.on('receiveMessage',msg=>{// Always refresh conversations list\nfetch(\"\".concat(getApiUrl(),\"/api/chat/conversations/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(async data=>{setConversations(Array.isArray(data)?data:[]);// Fetch usernames for each conversation's other participant\nconst usernames={};for(const convo of Array.isArray(data)?data:[]){const otherId=convo.participants.find(id=>id!==user._id);if(otherId){const res=await fetch(\"\".concat(getApiUrl(),\"/api/users/\").concat(otherId));if(res.ok){const u=await res.json();usernames[convo._id]=u.username||u.name||otherId;}else{usernames[convo._id]=otherId;}}}setConvoUsernames(usernames);// Always refresh messages for the currently selected conversation\nif(selectedConvoRef.current){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvoRef.current._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}});});socketRef.current.on('typing',_ref=>{let{from}=_ref;setTyping(true);setTimeout(()=>setTyping(false),1500);});socketRef.current.on('notification',_ref2=>{let{from,message}=_ref2;setNotification(\"New message from \".concat(from,\": \").concat(message));setTimeout(()=>setNotification(null),3000);});socketRef.current.on('refreshConversations',()=>{fetch(\"\".concat(getApiUrl(),\"/api/chat/conversations/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(data=>setConversations(Array.isArray(data)?data:[]));if(selectedConvo){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}fetchPendingAdoptions();});}}return()=>{var _socketRef$current;(_socketRef$current=socketRef.current)===null||_socketRef$current===void 0?void 0:_socketRef$current.disconnect();socketRef.current=null;};},[user,token,selectedConvo,fetchPendingAdoptions]);useEffect(()=>{if(selectedConvo&&token){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}},[selectedConvo,token]);useEffect(()=>{if(selectedConvo&&token){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}},[user,token,selectedConvo]);const startConversation=async otherUserId=>{if(!otherUserId||!token)return;const res=await fetch(\"\".concat(getApiUrl(),\"/api/chat/conversation\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({userId:user._id,otherUserId})});const convo=await res.json();setSelectedConvo(convo);setConversations(prev=>[...prev,convo]);setUserSearch('');setSearchResults([]);};const sendMessage=async()=>{var _socketRef$current2;if(!input||!selectedConvo||!token)return;const recipient=selectedConvo.participants.find(id=>id!==user._id);(_socketRef$current2=socketRef.current)===null||_socketRef$current2===void 0?void 0:_socketRef$current2.emit('sendMessage',{conversationId:selectedConvo._id,sender:user._id,recipient,message:input});await fetch(\"\".concat(getApiUrl(),\"/api/chat/message\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({conversationId:selectedConvo._id,sender:user._id,recipient,message:input})});// Do not update messages here; wait for real-time event\nsetInput('');};// Typing indicator\nconst handleInputChange=e=>{setInput(e.target.value);if(selectedConvo){var _socketRef$current3;const recipient=selectedConvo.participants.find(id=>id!==user._id);(_socketRef$current3=socketRef.current)===null||_socketRef$current3===void 0?void 0:_socketRef$current3.emit('typing',{recipient,sender:user._id});}};// User search\nconst handleUserSearch=async e=>{setUserSearch(e.target.value);if(e.target.value.length>1){try{const res=await fetch(\"\".concat(getApiUrl(),\"/api/users/search?query=\").concat(encodeURIComponent(e.target.value)));if(!res.ok){console.error('User search failed:',res.status,await res.text());setSearchResults([]);return;}const results=await res.json();setSearchResults(results);}catch(err){console.error('User search error:',err);setSearchResults([]);}}else{setSearchResults([]);}};// Handler for deleting conversation\nconst handleDeleteConversation=async()=>{if(!selectedConvo||!token)return;if(!window.confirm('Delete this conversation? This cannot be undone.'))return;await fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{method:'DELETE',headers:{'Authorization':\"Bearer \".concat(token)}});setConversations(conversations.filter(c=>c._id!==selectedConvo._id));setSelectedConvo(null);setMessages([]);};// Handler for block/unblock user\nconst isBlocked=selectedConvo&&userWithBlocks&&userWithBlocks.blockedUsers&&selectedConvo.participants.some(id=>id!==userWithBlocks._id&&userWithBlocks.blockedUsers.includes(id));const otherUserId=selectedConvo&&userWithBlocks?selectedConvo.participants.find(id=>id!==userWithBlocks._id):null;const handleBlockUnblock=async()=>{if(!otherUserId||!token)return;const url=isBlocked?'/api/chat/unblock':'/api/chat/block';await fetch(\"\".concat(getApiUrl()).concat(url),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({userId:user._id,blockId:otherUserId})});// Fetch updated user and update AuthContext state\nconst userRes=await fetch(\"\".concat(getApiUrl(),\"/api/users/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}});if(userRes.ok){const updatedUser=await userRes.json();updateUser(updatedUser);}// Emit a socket event to update both users' conversations in real time\nif(socketRef.current){socketRef.current.emit('refreshConversations',{userId:user._id,otherUserId});}// Refetch conversations for this user\nfetch(\"\".concat(getApiUrl(),\"/api/chat/conversations/\").concat(user._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(data=>setConversations(Array.isArray(data)?data:[]));// Optionally, refetch selected conversation if still valid\nif(selectedConvo){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}};// Handler for confirming adoption\nconst handleConfirmAdoption=async(dogId,isOwner)=>{if(!token)return;try{const res=await fetch(\"\".concat(getApiUrl(),\"/api/dogs/confirm-adoption\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({dogId,isOwner})});if(res.ok){fetchPendingAdoptions();// Refresh pending adoptions\n// Refresh messages to show confirmation message\nif(selectedConvo){fetch(\"\".concat(getApiUrl(),\"/api/chat/messages/\").concat(selectedConvo._id),{headers:{'Authorization':\"Bearer \".concat(token)}}).then(res=>res.json()).then(setMessages);}}}catch(err){console.error('Confirm adoption error:',err);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-profile-row\",style:{display:'flex',flexDirection:'column',alignItems:'center',gap:12,marginBottom:16},children:[/*#__PURE__*/_jsx(\"img\",{src:getProfilePictureUrl(),alt:\"Profile\",style:{width:40,height:40,borderRadius:'50%',objectFit:'cover',border:'2px solid #ddd',minWidth:'40px',minHeight:'40px',maxWidth:'60px',maxHeight:'60px'}}),/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:500,fontSize:16},children:(user===null||user===void 0?void 0:user.username)||'Me'}),/*#__PURE__*/_jsx(\"span\",{style:{color:'#4CAF50',fontSize:13,marginTop:4},children:\"Online\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-sidebar\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"chat-app-search\",type:\"text\",value:userSearch,onChange:handleUserSearch,placeholder:\"Search users by name or username...\"}),searchResults.length>0&&/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,marginBottom:4},children:searchResults.map(u=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-convo-btn\",onClick:()=>startConversation(u._id),children:u.userName})},u._id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-online-users\",children:[/*#__PURE__*/_jsx(\"b\",{style:{fontSize:13,color:'#43b581'},children:\"Online Users\"}),/*#__PURE__*/_jsxs(\"ul\",{style:{listStyle:'none',padding:0,minHeight:40},children:[onlineUsers.length===0&&/*#__PURE__*/_jsx(\"li\",{style:{color:'#aaa',fontSize:12},children:\"No users online\"}),onlineUsers.map(u=>/*#__PURE__*/_jsxs(\"li\",{style:{display:'flex',alignItems:'center',gap:6},children:[/*#__PURE__*/_jsx(\"span\",{className:\"chat-app-online-dot\"}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-convo-btn\",onClick:()=>startConversation(u._id),children:u.userName})]},u._id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-convos\",children:[/*#__PURE__*/_jsx(\"b\",{style:{fontSize:13,color:'#2196f3'},children:\"Conversations\"}),/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0},children:conversations.map(convo=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-convo-btn\".concat((selectedConvo===null||selectedConvo===void 0?void 0:selectedConvo._id)===convo._id?' selected':''),onClick:()=>setSelectedConvo(convo),children:convoUsernames[convo._id]||convo.participants.filter(id=>id!==user._id).join(', ')})},convo._id))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-main\",children:[selectedConvo&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-actions-row\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn delete\",onClick:handleDeleteConversation,children:\"Delete\"}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-action-btn \".concat(isBlocked?'unblock':'block'),onClick:handleBlockUnblock,children:isBlocked?'Unblock':'Block'}),pendingAdoptions.filter(dog=>{var _dog$adoptionQueue,_dog$adoptionQueue$ad;const otherUserId=selectedConvo.participants.find(id=>id!==user._id);return dog.user._id===otherUserId||((_dog$adoptionQueue=dog.adoptionQueue)===null||_dog$adoptionQueue===void 0?void 0:(_dog$adoptionQueue$ad=_dog$adoptionQueue.adopter)===null||_dog$adoptionQueue$ad===void 0?void 0:_dog$adoptionQueue$ad._id)===otherUserId;}).map(dog=>/*#__PURE__*/_jsxs(\"button\",{className:\"chat-app-action-btn confirm\",onClick:()=>handleConfirmAdoption(dog._id,dog.user._id===user._id),children:[\"Confirm Adoption: \",dog.name]},dog._id))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-messages\",children:[messages.map(msg=>/*#__PURE__*/_jsx(\"div\",{className:\"chat-app-message\".concat(user&&msg.sender===user._id?' self':''),children:/*#__PURE__*/_jsx(\"span\",{className:\"chat-app-bubble\".concat(user&&msg.sender===user._id?' self':''),children:msg.message})},msg._id)),typing&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-app-typing\",children:\"Typing...\"})]}),selectedConvo&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-input-row\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"chat-app-input\",type:\"text\",value:input,onChange:handleInputChange,onKeyDown:e=>{if(e.key==='Enter')sendMessage();},placeholder:\"Type a message...\"}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-app-send-btn\",onClick:sendMessage,disabled:!input.trim(),children:\"Send\"})]}),notification&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-app-notification\",children:notification})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.dispatchEvent(new CustomEvent('closeChatModal')),style:{position:'absolute',top:10,right:10,width:56,height:56,backgroundColor:'#e74c3c',color:'#fff',border:'none',borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center',boxShadow:'0 4px 12px rgba(0,0,0,0.3)',cursor:'pointer',zIndex:2147483647,padding:0},title:\"Close\",\"aria-label\":\"Close\",children:/*#__PURE__*/_jsx(\"span\",{style:{fontSize:40,fontWeight:900,lineHeight:'56px',width:'100%',textAlign:'center',display:'block',userSelect:'none',letterSpacing:2},children:\"\\xD7\"})})]});};export default ChatApp;","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","io","useAuth","jsx","_jsx","jsxs","_jsxs","getApiUrl","process","env","REACT_APP_API_URL","window","location","protocol","concat","hostname","ChatApp","selectedConvoRef","onlineUsers","setOnlineUsers","user","token","updateUser","userWithBlocks","console","log","getProfilePictureUrl","profilePicture","conversations","setConversations","convoUsernames","setConvoUsernames","selectedConvo","setSelectedConvo","current","messages","setMessages","input","setInput","typing","setTyping","notification","setNotification","userSearch","setUserSearch","searchResults","setSearchResults","pendingAdoptions","setPendingAdoptions","socketRef","fetchPendingAdoptions","res","fetch","headers","ok","data","json","err","error","_id","then","Array","isArray","usernames","convo","otherId","participants","find","id","u","username","name","emit","on","users","filter","userOnline","prev","some","userOffline","msg","_ref","from","setTimeout","_ref2","message","_socketRef$current","disconnect","startConversation","otherUserId","method","body","JSON","stringify","userId","sendMessage","_socketRef$current2","recipient","conversationId","sender","handleInputChange","e","target","value","_socketRef$current3","handleUserSearch","length","encodeURIComponent","status","text","results","handleDeleteConversation","confirm","c","isBlocked","blockedUsers","includes","handleBlockUnblock","url","blockId","userRes","updatedUser","handleConfirmAdoption","dogId","isOwner","className","children","style","display","flexDirection","alignItems","gap","marginBottom","src","alt","width","height","borderRadius","objectFit","border","minWidth","minHeight","maxWidth","maxHeight","fontWeight","fontSize","color","marginTop","type","onChange","placeholder","listStyle","padding","map","onClick","userName","join","dog","_dog$adoptionQueue","_dog$adoptionQueue$ad","adoptionQueue","adopter","onKeyDown","key","disabled","trim","dispatchEvent","CustomEvent","position","top","right","backgroundColor","justifyContent","boxShadow","cursor","zIndex","title","lineHeight","textAlign","userSelect","letterSpacing"],"sources":["/Applications/MAMP/htdocs/eky/client/src/components/ChatApp.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport '../css/chat-app.css';\nimport io from 'socket.io-client';\nimport { useAuth } from '../contexts/AuthContext';\n\ninterface UserWithBlocks {\n  _id: string;\n  blockedUsers?: string[];\n}\n\ninterface Message {\n  _id: string;\n  sender: string;\n  recipient: string;\n  message: string;\n  sentAt: string;\n}\n\n\ninterface Conversation {\n  _id: string;\n  participants: string[];\n}\n\ninterface UserWithBlocks {\n  _id: string;\n  blockedUsers?: string[];\n}\n\nconst getApiUrl = () => {\n  if (process.env.REACT_APP_API_URL) return process.env.REACT_APP_API_URL;\n  if (window.location.protocol === 'https:') {\n    // Use same host, but https\n    return `https://${window.location.hostname}`;\n  }\n  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n    return `http://${window.location.hostname}:3001`;\n  }\n  // For mobile/network access, use the network IP (dev only)\n  return `http://172.20.10.2:3001`;\n};\n\nconst ChatApp: React.FC = () => {\n  const selectedConvoRef = useRef<Conversation | null>(null);\n  const [onlineUsers, setOnlineUsers] = useState<{_id: string, userName: string}[]>([]);\n\n  const { user, token, updateUser } = useAuth();\n  const userWithBlocks = user as UserWithBlocks | null;\n  console.log('[ChatApp] user:', user);\n  // Profile picture logic\n  const getProfilePictureUrl = () => {\n    if (user && (user as any).profilePicture) {\n      return `${getApiUrl()}${(user as any).profilePicture}`;\n    }\n    return '../img/androcolored-80x80.jpg'; // Default profile picture\n  };\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [convoUsernames, setConvoUsernames] = useState<{[key: string]: string}>({});\n  const [selectedConvo, setSelectedConvo] = useState<Conversation | null>(null);\n  useEffect(() => {\n    selectedConvoRef.current = selectedConvo;\n  }, [selectedConvo]);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  // Remove otherUserId, use only user search and searchResults\n  const [typing, setTyping] = useState(false);\n  const [notification, setNotification] = useState<string | null>(null);\n  const [userSearch, setUserSearch] = useState('');\n  const [searchResults, setSearchResults] = useState<{_id: string, userName: string}[]>([]);\n  const [pendingAdoptions, setPendingAdoptions] = useState<any[]>([]);\n  useEffect(() => {\n    console.log('[ChatApp] onlineUsers state updated:', onlineUsers);\n  }, [onlineUsers]);\n  const socketRef = useRef<ReturnType<typeof io> | null>(null);\n\n  const fetchPendingAdoptions = useCallback(async () => {\n    if (!token) return;\n    try {\n      const res = await fetch(`${getApiUrl()}/api/dogs/pending-adoptions`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      if (res.ok) {\n        const data = await res.json();\n        setPendingAdoptions(data);\n      }\n    } catch (err) {\n      console.error('Failed to fetch pending adoptions:', err);\n    }\n  }, [token]);\n\n  // Setup socket connection and listeners only once per user/token\n  useEffect(() => {\n    if (user?._id && token) {\n      console.log('[ChatApp] Connecting socket for user:', user._id);\n      fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(async data => {\n          setConversations(Array.isArray(data) ? data : []);\n          // Fetch usernames for each conversation's other participant\n          const usernames: {[key: string]: string} = {};\n          for (const convo of Array.isArray(data) ? data : []) {\n            const otherId = convo.participants.find((id: string) => id !== user._id);\n            if (otherId) {\n              const res = await fetch(`${getApiUrl()}/api/users/${otherId}`);\n              if (res.ok) {\n                const u = await res.json();\n                usernames[convo._id] = u.username || u.name || otherId;\n              } else {\n                usernames[convo._id] = otherId;\n              }\n            }\n          }\n          setConvoUsernames(usernames);\n        })\n        .then(() => fetchPendingAdoptions());\n      if (!socketRef.current) {\n        socketRef.current = io(getApiUrl());\n        console.log('[ChatApp] Socket.IO connecting to', getApiUrl());\n        socketRef.current.emit('join', user._id);\n        console.log('[ChatApp] Emitted join for user:', user._id);\n        socketRef.current.emit('getOnlineUsers');\n        socketRef.current.on('onlineUsers', (users) => {\n          console.log('[ChatApp] Received onlineUsers:', users);\n          setOnlineUsers(users.filter((u: any) => u._id !== user._id));\n        });\n        socketRef.current.on('userOnline', (userOnline) => {\n          console.log('[ChatApp] userOnline event:', userOnline);\n          setOnlineUsers(prev => {\n            if (prev.some(u => u._id === userOnline._id)) return prev;\n            return [...prev, userOnline].filter(u => u._id !== user._id);\n          });\n        });\n        socketRef.current.on('userOffline', (userOffline) => {\n          console.log('[ChatApp] userOffline event:', userOffline);\n          setOnlineUsers(prev => prev.filter(u => u._id !== userOffline._id));\n        });\n        socketRef.current.on('receiveMessage', (msg) => {\n          // Always refresh conversations list\n          fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n          })\n            .then(res => res.json())\n            .then(async data => {\n              setConversations(Array.isArray(data) ? data : []);\n              // Fetch usernames for each conversation's other participant\n              const usernames: {[key: string]: string} = {};\n              for (const convo of Array.isArray(data) ? data : []) {\n                const otherId = convo.participants.find((id: string) => id !== user._id);\n                if (otherId) {\n                  const res = await fetch(`${getApiUrl()}/api/users/${otherId}`);\n                  if (res.ok) {\n                    const u = await res.json();\n                    usernames[convo._id] = u.username || u.name || otherId;\n                  } else {\n                    usernames[convo._id] = otherId;\n                  }\n                }\n              }\n              setConvoUsernames(usernames);\n              // Always refresh messages for the currently selected conversation\n              if (selectedConvoRef.current) {\n                fetch(`${getApiUrl()}/api/chat/messages/${selectedConvoRef.current._id}`, {\n                  headers: { 'Authorization': `Bearer ${token}` }\n                })\n                  .then(res => res.json())\n                  .then(setMessages);\n              }\n            });\n        });\n        socketRef.current.on('typing', ({ from }) => {\n          setTyping(true);\n          setTimeout(() => setTyping(false), 1500);\n        });\n        socketRef.current.on('notification', ({ from, message }) => {\n          setNotification(`New message from ${from}: ${message}`);\n          setTimeout(() => setNotification(null), 3000);\n        });\n        socketRef.current.on('refreshConversations', () => {\n          fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n          })\n            .then(res => res.json())\n            .then(data => setConversations(Array.isArray(data) ? data : []));\n          if (selectedConvo) {\n            fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n              headers: { 'Authorization': `Bearer ${token}` }\n            })\n              .then(res => res.json())\n              .then(setMessages);\n          }\n          fetchPendingAdoptions();\n        });\n      }\n    }\n    return () => {\n      socketRef.current?.disconnect();\n      socketRef.current = null;\n    };\n  }, [user, token, selectedConvo, fetchPendingAdoptions]);\n\n  useEffect(() => {\n    if (selectedConvo && token) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  }, [selectedConvo, token]);\n  useEffect(() => {\n    if (selectedConvo && token) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  }, [user, token, selectedConvo]);\n\n  const startConversation = async (otherUserId: string) => {\n    if (!otherUserId || !token) return;\n    const res = await fetch(`${getApiUrl()}/api/chat/conversation`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({ userId: user._id, otherUserId })\n    });\n    const convo = await res.json();\n    setSelectedConvo(convo);\n    setConversations(prev => [...prev, convo]);\n    setUserSearch('');\n    setSearchResults([]);\n  };\n\n  const sendMessage = async () => {\n    if (!input || !selectedConvo || !token) return;\n    const recipient = selectedConvo.participants.find(id => id !== user._id);\n    socketRef.current?.emit('sendMessage', {\n      conversationId: selectedConvo._id,\n      sender: user._id,\n      recipient,\n      message: input\n    });\n    await fetch(`${getApiUrl()}/api/chat/message`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        conversationId: selectedConvo._id,\n        sender: user._id,\n        recipient,\n        message: input\n      })\n    });\n    // Do not update messages here; wait for real-time event\n    setInput('');\n  };\n\n  // Typing indicator\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setInput(e.target.value);\n    if (selectedConvo) {\n      const recipient = selectedConvo.participants.find(id => id !== user._id);\n      socketRef.current?.emit('typing', { recipient, sender: user._id });\n    }\n  };\n\n  // User search\n  const handleUserSearch = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    setUserSearch(e.target.value);\n    if (e.target.value.length > 1) {\n      try {\n        const res = await fetch(`${getApiUrl()}/api/users/search?query=${encodeURIComponent(e.target.value)}`);\n        if (!res.ok) {\n          console.error('User search failed:', res.status, await res.text());\n          setSearchResults([]);\n          return;\n        }\n        const results = await res.json();\n        setSearchResults(results);\n      } catch (err) {\n        console.error('User search error:', err);\n        setSearchResults([]);\n      }\n    } else {\n      setSearchResults([]);\n    }\n  };\n\n  // Handler for deleting conversation\n  const handleDeleteConversation = async () => {\n    if (!selectedConvo || !token) return;\n    if (!window.confirm('Delete this conversation? This cannot be undone.')) return;\n    await fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n      method: 'DELETE',\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    setConversations(conversations.filter(c => c._id !== selectedConvo._id));\n    setSelectedConvo(null);\n    setMessages([]);\n  };\n\n  // Handler for block/unblock user\n  const isBlocked = selectedConvo && userWithBlocks && userWithBlocks.blockedUsers && selectedConvo.participants.some(\n    id => id !== userWithBlocks._id && userWithBlocks.blockedUsers!.includes(id)\n  );\n  const otherUserId = selectedConvo && userWithBlocks ? selectedConvo.participants.find(id => id !== userWithBlocks._id) : null;\n  const handleBlockUnblock = async () => {\n    if (!otherUserId || !token) return;\n    const url = isBlocked ? '/api/chat/unblock' : '/api/chat/block';\n    await fetch(`${getApiUrl()}${url}`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n      body: JSON.stringify({ userId: user._id, blockId: otherUserId })\n    });\n    // Fetch updated user and update AuthContext state\n    const userRes = await fetch(`${getApiUrl()}/api/users/${user._id}`, {\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    if (userRes.ok) {\n      const updatedUser = await userRes.json();\n      updateUser(updatedUser);\n    }\n    // Emit a socket event to update both users' conversations in real time\n    if (socketRef.current) {\n      socketRef.current.emit('refreshConversations', { userId: user._id, otherUserId });\n    }\n    // Refetch conversations for this user\n    fetch(`${getApiUrl()}/api/chat/conversations/${user._id}`, {\n      headers: { 'Authorization': `Bearer ${token}` }\n    })\n      .then(res => res.json())\n      .then(data => setConversations(Array.isArray(data) ? data : []));\n    // Optionally, refetch selected conversation if still valid\n    if (selectedConvo) {\n      fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n        .then(res => res.json())\n        .then(setMessages);\n    }\n  };\n\n  // Handler for confirming adoption\n  const handleConfirmAdoption = async (dogId: string, isOwner: boolean) => {\n    if (!token) return;\n    try {\n      const res = await fetch(`${getApiUrl()}/api/dogs/confirm-adoption`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n        body: JSON.stringify({ dogId, isOwner })\n      });\n      if (res.ok) {\n        fetchPendingAdoptions(); // Refresh pending adoptions\n        // Refresh messages to show confirmation message\n        if (selectedConvo) {\n          fetch(`${getApiUrl()}/api/chat/messages/${selectedConvo._id}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n          })\n            .then(res => res.json())\n            .then(setMessages);\n        }\n      }\n    } catch (err) {\n      console.error('Confirm adoption error:', err);\n    }\n  };\n\n  return (\n    <div className=\"chat-app-container\">\n      {/* User profile at top */}\n      <div className=\"chat-app-profile-row\" style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 12, marginBottom: 16 }}>\n        <img\n          src={getProfilePictureUrl()}\n          alt=\"Profile\"\n          style={{ width: 40, height: 40, borderRadius: '50%', objectFit: 'cover', border: '2px solid #ddd', minWidth: '40px', minHeight: '40px', maxWidth: '60px', maxHeight: '60px' }}\n        />\n        <span style={{ fontWeight: 500, fontSize: 16 }}>{user?.username || 'Me'}</span>\n        <span style={{ color: '#4CAF50', fontSize: 13, marginTop: 4 }}>Online</span>\n      </div>\n      <div className=\"chat-app-sidebar\">\n        <input\n          className=\"chat-app-search\"\n          type=\"text\"\n          value={userSearch}\n          onChange={handleUserSearch}\n          placeholder=\"Search users by name or username...\"\n        />\n        {searchResults.length > 0 && (\n          <ul style={{ listStyle: 'none', padding: 0, marginBottom: 4 }}>\n            {searchResults.map(u => (\n              <li key={u._id}>\n                <button className=\"chat-app-convo-btn\" onClick={() => startConversation(u._id)}>{u.userName}</button>\n              </li>\n            ))}\n          </ul>\n        )}\n\n        {/* Active/Online Users List */}\n        <div className=\"chat-app-online-users\">\n          <b style={{ fontSize: 13, color: '#43b581' }}>Online Users</b>\n          <ul style={{ listStyle: 'none', padding: 0, minHeight: 40 }}>\n            {onlineUsers.length === 0 && (\n              <li style={{ color: '#aaa', fontSize: 12 }}>No users online</li>\n            )}\n            {onlineUsers.map(u => (\n              <li key={u._id} style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\n                <span className=\"chat-app-online-dot\" />\n                <button className=\"chat-app-convo-btn\" onClick={() => startConversation(u._id)}>{u.userName}</button>\n              </li>\n            ))}\n          </ul>\n        </div>\n\n        <div className=\"chat-app-convos\">\n          <b style={{ fontSize: 13, color: '#2196f3' }}>Conversations</b>\n          <ul style={{ listStyle: 'none', padding: 0 }}>\n            {conversations.map(convo => (\n              <li key={convo._id}>\n                <button\n                  className={`chat-app-convo-btn${selectedConvo?._id === convo._id ? ' selected' : ''}`}\n                  onClick={() => setSelectedConvo(convo)}\n                >\n                  {convoUsernames[convo._id] || convo.participants.filter(id => id !== user._id).join(', ')}\n                </button>\n              </li>\n            ))}\n          </ul>\n        </div>\n      </div>\n      <div className=\"chat-app-main\">\n        {/* Conversation actions always at top for all devices */}\n        {selectedConvo && (\n          <div className=\"chat-app-actions-row\">\n            <button className=\"chat-app-action-btn delete\" onClick={handleDeleteConversation}>Delete</button>\n            <button className={`chat-app-action-btn ${isBlocked ? 'unblock' : 'block'}`} onClick={handleBlockUnblock}>{isBlocked ? 'Unblock' : 'Block'}</button>\n            {pendingAdoptions.filter(dog => {\n              const otherUserId = selectedConvo.participants.find(id => id !== user._id);\n              return dog.user._id === otherUserId || dog.adoptionQueue?.adopter?._id === otherUserId;\n            }).map(dog => (\n              <button\n                key={dog._id}\n                className=\"chat-app-action-btn confirm\"\n                onClick={() => handleConfirmAdoption(dog._id, dog.user._id === user._id)}\n              >\n                Confirm Adoption: {dog.name}\n              </button>\n            ))}\n          </div>\n        )}\n        <div className=\"chat-app-messages\">\n          {messages.map(msg => (\n              <div key={msg._id} className={`chat-app-message${user && msg.sender === user._id ? ' self' : ''}`}>\n                <span className={`chat-app-bubble${user && msg.sender === user._id ? ' self' : ''}`}>{msg.message}</span>\n              </div>\n            ))}\n          {typing && <div className=\"chat-app-typing\">Typing...</div>}\n        </div>\n        {selectedConvo && (\n          <div className=\"chat-app-input-row\">\n            <input\n              className=\"chat-app-input\"\n              type=\"text\"\n              value={input}\n              onChange={handleInputChange}\n              onKeyDown={e => { if (e.key === 'Enter') sendMessage(); }}\n              placeholder=\"Type a message...\"\n            />\n            <button\n              className=\"chat-app-send-btn\"\n              onClick={sendMessage}\n              disabled={!input.trim()}\n            >Send</button>\n          </div>\n        )}\n        {notification && (\n          <div className=\"chat-app-notification\">{notification}</div>\n        )}\n      </div>\n      {/* Close button at top right (desktop), static on mobile) */}\n      <button\n        onClick={() => window.dispatchEvent(new CustomEvent('closeChatModal'))}\n        style={{\n          position: 'absolute',\n          top: 10,\n          right: 10,\n          width: 56,\n          height: 56,\n          backgroundColor: '#e74c3c',\n          color: '#fff',\n          border: 'none',\n          borderRadius: '50%',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          boxShadow: '0 4px 12px rgba(0,0,0,0.3)',\n          cursor: 'pointer',\n          zIndex: 2147483647,\n          padding: 0\n        }}\n        title=\"Close\"\n        aria-label=\"Close\"\n      >\n        <span style={{\n          fontSize: 40,\n          fontWeight: 900,\n          lineHeight: '56px',\n          width: '100%',\n          textAlign: 'center',\n          display: 'block',\n          userSelect: 'none',\n          letterSpacing: 2\n        }}>Ã—</span>\n      </button>\n    </div>\n  );\n};\n\nexport default ChatApp;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}