{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/eky/client/src/components/OrientedImage.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet EXIF;\ntry {\n  EXIF = require('exif-js');\n} catch (e) {\n  EXIF = window.EXIF;\n}\nfunction getOrientedImageUrl(imgUrl, callback) {\n  const img = new window.Image();\n  img.crossOrigin = 'Anonymous';\n  img.onload = function () {\n    if (!EXIF || !EXIF.getData) {\n      callback(imgUrl);\n      return;\n    }\n    EXIF.getData(img, function () {\n      const orientation = EXIF.getTag(this, 'Orientation');\n      if (!orientation || orientation === 1) {\n        callback(imgUrl);\n        return;\n      }\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      if (!ctx) {\n        callback(imgUrl);\n        return;\n      }\n      let width = img.width;\n      let height = img.height;\n      if ([5, 6, 7, 8].includes(orientation)) {\n        canvas.width = height;\n        canvas.height = width;\n      } else {\n        canvas.width = width;\n        canvas.height = height;\n      }\n      switch (orientation) {\n        case 2:\n          ctx.transform(-1, 0, 0, 1, width, 0);\n          break;\n        case 3:\n          ctx.transform(-1, 0, 0, -1, width, height);\n          break;\n        case 4:\n          ctx.transform(1, 0, 0, -1, 0, height);\n          break;\n        case 5:\n          ctx.transform(0, 1, 1, 0, 0, 0);\n          break;\n        case 6:\n          ctx.transform(0, 1, -1, 0, height, 0);\n          break;\n        case 7:\n          ctx.transform(0, -1, -1, 0, height, width);\n          break;\n        case 8:\n          ctx.transform(0, -1, 1, 0, 0, width);\n          break;\n        default:\n          break;\n      }\n      ctx.drawImage(img, 0, 0);\n      callback(canvas.toDataURL());\n    });\n  };\n  img.onerror = function () {\n    callback(imgUrl);\n  };\n  img.src = imgUrl;\n}\nconst OrientedImage = ({\n  src,\n  alt,\n  style,\n  fallback\n}) => {\n  _s();\n  const [orientedUrl, setOrientedUrl] = useState(src);\n  const [error, setError] = useState(false);\n  useEffect(() => {\n    if (!src) return;\n    getOrientedImageUrl(src, setOrientedUrl);\n  }, [src]);\n  if (!src) return null;\n  if (error) return /*#__PURE__*/_jsxDEV(\"img\", {\n    src: fallback,\n    alt: alt,\n    style: style\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 21\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"img\", {\n    src: orientedUrl,\n    alt: alt,\n    style: style,\n    onError: () => setError(true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 10\n  }, this);\n};\n_s(OrientedImage, \"WAL4N4ulIi+f5ADXEUTs2QbOxAU=\");\n_c = OrientedImage;\nexport default OrientedImage;\nvar _c;\n$RefreshReg$(_c, \"OrientedImage\");","map":{"version":3,"names":["React","useState","useEffect","jsxDEV","_jsxDEV","EXIF","require","e","window","getOrientedImageUrl","imgUrl","callback","img","Image","crossOrigin","onload","getData","orientation","getTag","canvas","document","createElement","ctx","getContext","width","height","includes","transform","drawImage","toDataURL","onerror","src","OrientedImage","alt","style","fallback","_s","orientedUrl","setOrientedUrl","error","setError","fileName","_jsxFileName","lineNumber","columnNumber","onError","_c","$RefreshReg$"],"sources":["/Applications/MAMP/htdocs/eky/client/src/components/OrientedImage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nlet EXIF: any;\ntry {\n  EXIF = require('exif-js');\n} catch (e) {\n  EXIF = (window as any).EXIF;\n}\n\nfunction getOrientedImageUrl(imgUrl: string, callback: (url: string) => void) {\n  const img = new window.Image();\n  img.crossOrigin = 'Anonymous';\n  img.onload = function () {\n    if (!EXIF || !EXIF.getData) {\n      callback(imgUrl);\n      return;\n    }\n    EXIF.getData(img, function () {\n      const orientation = EXIF.getTag(this, 'Orientation');\n      if (!orientation || orientation === 1) {\n        callback(imgUrl);\n        return;\n      }\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      if (!ctx) {\n        callback(imgUrl);\n        return;\n      }\n      let width = img.width;\n      let height = img.height;\n      if ([5,6,7,8].includes(orientation)) {\n        canvas.width = height;\n        canvas.height = width;\n      } else {\n        canvas.width = width;\n        canvas.height = height;\n      }\n      switch (orientation) {\n        case 2: ctx.transform(-1, 0, 0, 1, width, 0); break;\n        case 3: ctx.transform(-1, 0, 0, -1, width, height); break;\n        case 4: ctx.transform(1, 0, 0, -1, 0, height); break;\n        case 5: ctx.transform(0, 1, 1, 0, 0, 0); break;\n        case 6: ctx.transform(0, 1, -1, 0, height, 0); break;\n        case 7: ctx.transform(0, -1, -1, 0, height, width); break;\n        case 8: ctx.transform(0, -1, 1, 0, 0, width); break;\n        default: break;\n      }\n      ctx.drawImage(img, 0, 0);\n      callback(canvas.toDataURL());\n    });\n  };\n  img.onerror = function () {\n    callback(imgUrl);\n  };\n  img.src = imgUrl;\n}\n\nconst OrientedImage: React.FC<{ src?: string; alt?: string; style?: React.CSSProperties; fallback?: string }> = ({ src, alt, style, fallback }) => {\n  const [orientedUrl, setOrientedUrl] = useState<string | undefined>(src);\n  const [error, setError] = useState(false);\n  useEffect(() => {\n    if (!src) return;\n    getOrientedImageUrl(src, setOrientedUrl);\n  }, [src]);\n  if (!src) return null;\n  if (error) return <img src={fallback} alt={alt} style={style} />;\n  return <img src={orientedUrl} alt={alt} style={style} onError={() => setError(true)} />;\n};\n\nexport default OrientedImage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}